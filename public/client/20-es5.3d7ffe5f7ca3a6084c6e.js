function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{"9lfv":function(t,e,a){"use strict";a.r(e),a.d(e,"TicketingModule",(function(){return Je}));var n=a("ofXK"),i=a("3Pt+"),r=a("tyNb"),o=a("R0Ic"),c=[Object(o.m)("fadeIn",[Object(o.l)(":enter",[Object(o.k)({opacity:0}),Object(o.e)("325ms ease-in",Object(o.k)({opacity:1}))])]),Object(o.m)("fadeOut",[Object(o.l)(":leave",[Object(o.k)({opacity:1,position:"absolute",left:"0",right:"0"}),Object(o.e)("325ms ease-out",Object(o.k)({opacity:0}))])])],s=a("lJxs"),l=a("/uUt"),b=a("fXoL"),u=a("wfim"),d=a("VaLf"),p=a("OnlV"),m=a("N2vX"),g=a("vkgz"),h=a("Kj3r"),f=a("eIep"),v=a("JIr8"),k=a("LsVx"),y=a("nYR2"),T=a("0IaG"),x=a("45UC"),U=a("QGXG"),C=a("2hX1"),O=a("Ivca"),I=a("Um6Z"),w=a("Rd8u"),_=a("rcZy"),P=a("bv9b"),B=a("eKg+"),M=a("A5z7");function F(t,e){1&t&&b.Pb(0,"mat-progress-bar",12)}function K(t,e){if(1&t&&(b.Ub(0,"mat-chip",31),b.Kc(1),b.Tb()),2&t){var a=b.fc().$implicit;b.Bb(1),b.Lc(a.display_name)}}function A(t,e){if(1&t&&(b.Sb(0),b.Ic(1,K,2,1,"mat-chip",30),b.Rb()),2&t){var a=e.$implicit;b.Bb(1),b.nc("ngIf","status"!==a.type)}}function L(t,e){if(1&t){var a=b.Vb();b.Ub(0,"tr",13),b.bc("click",(function(){b.zc(a);var t=e.$implicit;return b.fc().openConversation(t)})),b.Pb(1,"td",14),b.Ub(2,"td",15),b.Kc(3),b.Tb(),b.Ub(4,"td",16),b.Pb(5,"img",17),b.Tb(),b.Ub(6,"td",18),b.Ub(7,"div",19),b.Ub(8,"mat-chip-list",20),b.Ic(9,A,2,1,"ng-container",21),b.Tb(),b.Ub(10,"div",22),b.Kc(11),b.Tb(),b.Tb(),b.Ub(12,"div",23),b.Kc(13),b.Tb(),b.Tb(),b.Ub(14,"td",24),b.Ub(15,"span",25),b.Kc(16),b.Tb(),b.Tb(),b.Ub(17,"td",26),b.Ub(18,"div",27),b.Kc(19),b.Tb(),b.Tb(),b.Ub(20,"td",28),b.Kc(21),b.Tb(),b.Ub(22,"td",29),b.Ub(23,"div",27),b.Kc(24),b.Tb(),b.Tb(),b.Tb()}if(2&t){var n=e.$implicit,i=b.fc();b.Fb("not-closed",!n.closed_at)("open","open"===n.status)("selected",i.ticketSelected(n))("fadeIn",n.animated),b.Bb(1),b.nc("table-body-checkbox",n.id),b.Bb(2),b.Lc(null==n||null==n.user?null:n.user.display_name),b.Bb(2),b.oc("src",null==n||null==n.user?null:n.user.avatar,b.Cc),b.Bb(3),b.nc("selectable",!1),b.Bb(1),b.nc("ngForOf",n.tags),b.Bb(2),b.Lc(n.subject),b.Bb(2),b.Lc(i.getTicketBody(n)),b.Bb(3),b.Lc(n.replies_count||1),b.Bb(3),b.Lc(n.assignee?n.assignee.display_name:""),b.Bb(2),b.Lc(n.id),b.Bb(3),b.Lc(n.updated_at_formatted)}}var S,j=["*"],$=((S=function(){function t(e,a,n,i){_classCallCheck(this,t),this.router=e,this.modal=a,this.mailboxTags=n,this.datatable=i,this.openTicketInModal=!1,this.tickets$=this.datatable.data$}return _createClass(t,[{key:"openConversation",value:function(t){this.openTicketInModal?this.modal.open(x.a,{ticketId:t.id},{panelClass:"conversation-modal-container"}):this.router.navigate(["mailbox/tickets",t.id],{queryParams:{tagId:this.mailboxTags.activeTagId$.value}})}},{key:"ticketSelected",value:function(t){return this.datatable.selectedRows$.value.includes(t.id)}},{key:"getTicketBody",value:function(t){return t.latest_reply&&t.latest_reply.body?t.latest_reply.body:t.replies&&t.replies.length?t.replies[0].body:void 0}}]),t}()).\u0275fac=function(t){return new(t||S)(b.Ob(r.f),b.Ob(U.a),b.Ob(u.a),b.Ob(C.a))},S.\u0275cmp=b.Ib({type:S,selectors:[["tickets-list"]],inputs:{openTicketInModal:"openTicketInModal"},ngContentSelectors:j,decls:24,vars:6,consts:[["mode","indeterminate","color","accent",4,"ngIf"],[1,"table-container"],[1,"material-table","responsive-table"],["table-header-checkbox",""],["table-sort-header","user_id","trans","",1,"customer-column"],[1,"avatar-column"],["trans",""],["table-sort-header","replies_count",1,"replies-count-column"],["table-sort-header","","trans","",1,"assigned-to-column"],["table-sort-header","id","trans","",1,"number-column"],["table-sort-header","updated_at","trans","",1,"last-updated-column"],["class","animated",3,"not-closed","open","selected","fadeIn","click",4,"ngFor","ngForOf"],["mode","indeterminate","color","accent"],[1,"animated",3,"click"],[3,"table-body-checkbox"],["data-label","Customer",1,"customer-column"],[1,"avatar-column","hidden-on-mobile"],["alt","customer avatar",3,"src"],[1,"summary-column","mobile-no-label"],[1,"title"],[1,"ticket-tags",3,"selectable"],[4,"ngFor","ngForOf"],[1,"title-text","ticket-subject"],[1,"ellipses","ticket-body"],[1,"replies-count-column","hidden-on-mobile"],["title","Replies count",1,"replies-count-number"],["data-label","Assigned To",1,"assigned-to-column"],[1,"column-text-content"],["data-label","ID",1,"number-column"],["data-label","Last Updated",1,"last-updated-column"],["class","mat-compact-chip ticket-tag",4,"ngIf"],[1,"mat-compact-chip","ticket-tag"]],template:function(t,e){1&t&&(b.mc(),b.Ic(0,F,1,0,"mat-progress-bar",0),b.gc(1,"async"),b.Ub(2,"div",1),b.Ub(3,"table",2),b.Ub(4,"thead"),b.Ub(5,"tr"),b.Pb(6,"th",3),b.Ub(7,"th",4),b.Kc(8,"Customer"),b.Tb(),b.Pb(9,"th",5),b.Ub(10,"th",6),b.Kc(11,"Ticket Summary"),b.Tb(),b.Pb(12,"th",7),b.Ub(13,"th",8),b.Kc(14,"Assigned To"),b.Tb(),b.Ub(15,"th",9),b.Kc(16,"Number"),b.Tb(),b.Ub(17,"th",10),b.Kc(18,"Last Updated"),b.Tb(),b.Tb(),b.Tb(),b.Ub(19,"tbody"),b.Ic(20,L,25,19,"tr",11),b.gc(21,"async"),b.Tb(),b.Tb(),b.lc(22),b.Pb(23,"datatable-footer"),b.Tb()),2&t&&(b.nc("ngIf",b.hc(1,2,e.datatable.paginator.loading$)),b.Bb(20),b.nc("ngForOf",b.hc(21,4,e.tickets$)))},directives:[n.t,O.a,I.a,w.a,n.s,_.a,P.a,B.a,M.d,M.a],pipes:[n.b],styles:["[_nghost-%COMP%]{display:block;overflow:auto;height:100%;position:relative}[_nghost-%COMP%]     .no-results-message{padding:65px 0}mat-progress-bar[_ngcontent-%COMP%]{position:absolute;top:0;left:0}.table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background-color:var(--be-background-alternative)}table[_ngcontent-%COMP%]{table-layout:fixed}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{height:70px;cursor:pointer}tbody[_ngcontent-%COMP%]   tr.open[_ngcontent-%COMP%]   .customer-column[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr.open[_ngcontent-%COMP%]   .last-updated-column[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr.open[_ngcontent-%COMP%]   .number-column[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr.open[_ngcontent-%COMP%]   .title-text[_ngcontent-%COMP%]{font-weight:500;color:var(--be-text)}tbody[_ngcontent-%COMP%]   tr.not-closed[_ngcontent-%COMP%]{background-color:var(--be-background)}tbody[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover:not(.selected){background-color:var(--be-accent-emphasis)}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{height:35px;background-color:var(--be-background)}.table-checkbox[_ngcontent-%COMP%]{width:75px}.customer-column[_ngcontent-%COMP%]{width:130px;font-weight:500;color:var(--be-secondary-text)}.avatar-column[_ngcontent-%COMP%]{width:110px}.avatar-column[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:38px;height:38px;box-shadow:0 0 0 1px #fff,0 0 1px 2px #aaaeb7;border-radius:50%;margin:0 auto}.replies-count-column[_ngcontent-%COMP%]{width:50px;text-align:center}.number-column[_ngcontent-%COMP%]{width:90px;padding-right:10px}.assigned-to-column[_ngcontent-%COMP%], .last-updated-column[_ngcontent-%COMP%]{width:125px}.column-text-content[_ngcontent-%COMP%]{max-width:85%;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.replies-count-number[_ngcontent-%COMP%]{background-color:var(--be-background-alternative);color:var(--be-secondary-text);border-radius:4px;padding:1px 6px 0;font-size:1.1rem;border:1px solid var(--be-divider-default)}.summary-column[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.summary-column[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center}.summary-column[_ngcontent-%COMP%]   .ticket-body[_ngcontent-%COMP%]{color:var(--be-secondary-text);max-width:98%;overflow:hidden;text-overflow:ellipsis;padding-top:5px}.ticket-tags[_ngcontent-%COMP%]{margin-right:7px}.ticket-tag[_ngcontent-%COMP%]{pointer-events:none}datatable-footer[_ngcontent-%COMP%]{height:45px;background-color:var(--be-background);border-top:1px solid var(--be-divider-default);margin-top:auto}datatable-footer[_ngcontent-%COMP%]     .page-size-input{height:25px;padding-top:0;padding-bottom:0}"]}),S),z=a("74SX"),V=a("NFeN"),E=a("i2dy"),R=a("twBr"),Q=a("2qZP"),q=a("Qu3c"),D=a("STbY"),N=a("EzZJ"),G=a("zW5C");function H(t,e){if(1&t){var a=b.Vb();b.Ub(0,"button",10),b.bc("click",(function(){b.zc(a);var t=e.$implicit;return b.fc(2).setStatusForSelectedTickets(t)})),b.Kc(1),b.Tb()}if(2&t){var n=e.$implicit;b.nc("ngClass",n.name),b.Bb(1),b.Mc(" ",n.display_name||n.name," ")}}function J(t,e){if(1&t){var a=b.Vb();b.Sb(0),b.Ub(1,"assign-ticket-dropdown",1),b.bc("assigned",(function(){return b.zc(a),b.fc().ticketsUpdated()})),b.gc(2,"async"),b.gc(3,"trans"),b.Tb(),b.Ub(4,"button",2),b.Pb(5,"mat-icon",3),b.Tb(),b.Ub(6,"mat-menu",4,5),b.Ic(8,H,2,2,"button",6),b.Tb(),b.Ub(9,"add-tag-dropdown",7),b.bc("tagAdded",(function(){return b.zc(a),b.fc().ticketsUpdated()})),b.gc(10,"async"),b.gc(11,"trans"),b.Tb(),b.Ub(12,"button",8),b.bc("click",(function(){return b.zc(a),b.fc().maybeDeleteSelectedTickets()})),b.gc(13,"trans"),b.Pb(14,"mat-icon",9),b.Tb(),b.Rb()}if(2&t){var n=b.wc(7),i=b.fc();b.Bb(1),b.nc("ticketIds",b.hc(2,8,i.datatable.selectedRows$))("matTooltip",b.hc(3,10,"Assign")),b.Bb(3),b.nc("matMenuTriggerFor",n),b.Bb(2),b.nc("overlapTrigger",!1),b.Bb(2),b.nc("ngForOf",i.mailboxTags.statusTags),b.Bb(1),b.nc("ticketIds",b.hc(10,12,i.datatable.selectedRows$))("matTooltip",b.hc(11,14,"Add Tag")),b.Bb(3),b.nc("matTooltip",b.hc(13,16,"Delete"))}}var X,Y=function(){return["tickets.update","replies.create"]},Z=((X=function(){function t(e,a,n,i,r){_classCallCheck(this,t),this.tickets=e,this.mailboxTags=a,this.toast=n,this.currentUser=i,this.datatable=r,this.onTicketsUpdated=new b.n}return _createClass(t,[{key:"setStatusForSelectedTickets",value:function(t){var e=this;this.tickets.changeMultipleTicketsStatus(this.datatable.selectedRows$.value,t).subscribe((function(){e.ticketsUpdated()}))}},{key:"maybeDeleteSelectedTickets",value:function(){var t=this;this.datatable.confirmResourceDeletion("tickets").subscribe((function(){t.tickets.deleteMultiple(t.datatable.selectedRows$.value).subscribe((function(){t.ticketsUpdated(),t.toast.open("Tickets deleted")}))}))}},{key:"ticketsUpdated",value:function(){this.onTicketsUpdated.emit(),this.mailboxTags.refresh(),this.datatable.reset()}},{key:"noTicketsSelected",get:function(){return!this.datatable.selectedRows$.value.length}}]),t}()).\u0275fac=function(t){return new(t||X)(b.Ob(k.a),b.Ob(u.a),b.Ob(E.b),b.Ob(R.a),b.Ob(C.a))},X.\u0275cmp=b.Ib({type:X,selectors:[["ticket-floating-toolbar"]],hostVars:2,hostBindings:function(t,e){2&t&&b.Fb("hidden",e.noTicketsSelected)},outputs:{onTicketsUpdated:"onTicketsUpdated"},decls:1,vars:2,consts:[[4,"ngIf"],[3,"ticketIds","matTooltip","assigned"],[1,"toolbar-item","no-style",3,"matMenuTriggerFor"],["svgIcon","flag-custom"],[1,"status-menu",3,"overlapTrigger"],["ticketStatusMenu","matMenu"],["mat-menu-item","",3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ticketIds","matTooltip","tagAdded"],[1,"no-style","toolbar-item","delete-tickets-button","last",3,"matTooltip","click"],["svgIcon","delete-custom"],["mat-menu-item","",3,"ngClass","click"]],template:function(t,e){1&t&&b.Ic(0,J,15,18,"ng-container",0),2&t&&b.nc("ngIf",e.currentUser.hasPermissions(b.rc(1,Y)))},directives:[n.t,Q.a,q.a,D.d,V.a,D.e,n.s,N.a,D.b,n.q],pipes:[n.b,G.a],styles:["ticket-floating-toolbar{display:flex;position:fixed;top:78px;background-color:var(--be-background);left:calc(50% - 117.5px);min-width:235px;box-shadow:0 3px 3px -2px rgba(0,0,0,.2),0 3px 4px 0 rgba(0,0,0,.14),0 1px 8px 0 rgba(0,0,0,.12);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:10;white-space:nowrap}ticket-floating-toolbar .toolbar-item{position:relative;cursor:pointer;transition:all .2s ease-in-out;padding:15px;border-right:1px solid var(--be-divider-default);line-height:inherit}ticket-floating-toolbar .toolbar-item.last{border-bottom:none}ticket-floating-toolbar .toolbar-item:hover{background-color:var(--be-accent-emphasis)}ticket-floating-toolbar .toolbar-item .mat-icon{color:var(--be-help-center-title-text);vertical-align:bottom;width:28px;height:28px}ticket-floating-toolbar .toolbar-item .status-tag{text-transform:capitalize}"],encapsulation:2}),X),W=a("CH4Q");function tt(t,e){1&t&&(b.Ub(0,"no-results-message"),b.Ub(1,"span",21),b.Kc(2,"Nothing To Display."),b.Tb(),b.Ub(3,"span",22),b.Kc(4,"Could not find any tickets matching this search query."),b.Tb(),b.Tb())}var et=function(t){return["/mailbox/users",t]};function at(t,e){if(1&t&&(b.Ub(0,"a",23),b.Pb(1,"img",24),b.Ub(2,"div",25),b.Ub(3,"div",26),b.Kc(4),b.Tb(),b.Ub(5,"div",27),b.Kc(6),b.Tb(),b.Tb(),b.Tb()),2&t){var a=e.$implicit;b.nc("routerLink",b.sc(4,et,a.id)),b.Bb(1),b.oc("src",a.avatar,b.Cc),b.Bb(3),b.Lc(a.display_name),b.Bb(2),b.Lc(a.email)}}function nt(t,e){if(1&t&&(b.Ub(0,"a",28),b.Pb(1,"mat-icon",29),b.Ub(2,"div",30),b.Ub(3,"div",26),b.Kc(4),b.Tb(),b.Ub(5,"div",27),b.Kc(6),b.Tb(),b.Tb(),b.Tb()),2&t){var a=e.$implicit,n=b.fc();b.nc("routerLink",n.urls.article(a)),b.Bb(4),b.Lc(a.title),b.Bb(2),b.Lc(a.body)}}var it,rt=((it=function(){function t(e,a,n,r,o){_classCallCheck(this,t),this.dialogRef=e,this.data=a,this.tickets=n,this.urls=r,this.datatable=o,this.results={},this.isSearching=!1,this.searchedOnce=!1,this.activeTab="tickets",this.searchQueryControl=new i.i,this.hydrate()}return _createClass(t,[{key:"ngOnInit",value:function(){this.datatable.paginator.dontUpdateQueryParams=!0}},{key:"ngOnDestroy",value:function(){this.datatable.destroy()}},{key:"close",value:function(){this.dialogRef.close()}},{key:"hydrate",value:function(){this.bindToSearchInput(),this.searchQueryControl.setValue(this.data.query)}},{key:"setActiveTab",value:function(t){this.activeTab=t}},{key:"activeTabIs",value:function(t){return this.activeTab===t}},{key:"performSearch",value:function(t){var e=this;this.isSearching=!0,this.tickets.search(t,this.getSearchQueryParams()).pipe(Object(y.a)((function(){e.searchedOnce=!0,e.isSearching=!1}))).subscribe((function(t){e.datatable.config?(e.datatable.paginator.response$.next({pagination:t.results.tickets}),e.datatable.config.staticParams=e.getSearchQueryParams()):e.datatable.init({uri:"search/tickets",staticParams:e.getSearchQueryParams(),initialData:t.results.tickets}),e.results=t.results}))}},{key:"bindToSearchInput",value:function(){var t=this;this.searchQueryControl.valueChanges.pipe(Object(h.a)(400),Object(l.a)()).subscribe((function(e){return t.performSearch(e)}))}},{key:"getSearchQueryParams",value:function(){return{query:this.searchQueryControl.value,perPage:20,detailed:!0}}}]),t}()).\u0275fac=function(t){return new(t||it)(b.Ob(T.h),b.Ob(T.a),b.Ob(k.a),b.Ob(z.a),b.Ob(C.a))},it.\u0275cmp=b.Ib({type:it,selectors:[["agent-search-modal"]],viewQuery:function(t,e){var a;1&t&&b.Gc($,!0),2&t&&b.vc(a=b.cc())&&(e.ticketsList=a.first)},features:[b.Ab([C.a])],decls:33,vars:24,consts:[[1,"modal-header"],["mat-dialog-title","","trans","",1,"modal-title"],["type","button","tabindex","-1",1,"close-button","no-style",3,"click"],["svgIcon","close"],[1,"input-container","search-input"],["type","text","placeholder","Find tickets, articles and users...","trans-placeholder","",3,"formControl"],[1,"search-results"],[1,"tab-menu"],[1,"tab-menu-item","tickets-menu-item",3,"click"],["trans",""],[1,"tab-menu-item","users-menu-item",3,"click"],[1,"tab-menu-item","articles-menu-item",3,"click"],[1,"tabs"],[1,"tab","tickets-tab"],[3,"openTicketInModal"],[4,"ngIf"],[1,"tab","users-tab"],["class","user",3,"routerLink",4,"ngFor","ngForOf"],[1,"tab","articles-tab"],[1,"articles-list"],["class","article",3,"routerLink",4,"ngFor","ngForOf"],["primary-text","","trans",""],["secondary-text","","trans",""],[1,"user",3,"routerLink"],["alt","customer avatar",1,"avatar",3,"src"],[1,"text"],[1,"title"],[1,"body"],[1,"article",3,"routerLink"],["svgIcon","description"],[1,"article-info"]],template:function(t,e){var a;1&t&&(b.Ub(0,"div",0),b.Ub(1,"h2",1),b.Kc(2,"Search"),b.Tb(),b.Ub(3,"button",2),b.bc("click",(function(){return e.close()})),b.Pb(4,"mat-icon",3),b.Tb(),b.Tb(),b.Ub(5,"mat-dialog-content"),b.Ub(6,"div",4),b.Pb(7,"input",5),b.Tb(),b.Ub(8,"div",6),b.Ub(9,"div",7),b.Ub(10,"div",8),b.bc("click",(function(){return e.setActiveTab("tickets")})),b.Kc(11),b.gc(12,"async"),b.Ub(13,"span",9),b.Kc(14,"Tickets"),b.Tb(),b.Tb(),b.Ub(15,"div",10),b.bc("click",(function(){return e.setActiveTab("users")})),b.Kc(16),b.Ub(17,"span",9),b.Kc(18,"Users"),b.Tb(),b.Tb(),b.Ub(19,"div",11),b.bc("click",(function(){return e.setActiveTab("articles")})),b.Kc(20),b.Ub(21,"span",9),b.Kc(22,"Articles"),b.Tb(),b.Tb(),b.Tb(),b.Ub(23,"div",12),b.Ub(24,"div",13),b.Ub(25,"tickets-list",14),b.Ic(26,tt,5,0,"no-results-message",15),b.Tb(),b.Pb(27,"ticket-floating-toolbar"),b.Tb(),b.Ub(28,"div",16),b.Ic(29,at,7,6,"a",17),b.Tb(),b.Ub(30,"div",18),b.Ub(31,"div",19),b.Ic(32,nt,7,3,"a",20),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb()),2&t&&(b.Bb(7),b.nc("formControl",e.searchQueryControl),b.Bb(2),b.Fb("visually-hidden",!e.searchedOnce),b.Bb(1),b.Fb("active",e.activeTabIs("tickets")),b.Bb(1),b.Mc("",null==(a=b.hc(12,22,e.datatable.paginator.response$))||null==a.pagination?null:a.pagination.total," "),b.Bb(4),b.Fb("active",e.activeTabIs("users")),b.Bb(1),b.Mc("",null==e.results.users?null:e.results.users.total," "),b.Bb(3),b.Fb("active",e.activeTabIs("articles")),b.Bb(1),b.Mc("",null==e.results.articles?null:e.results.articles.total," "),b.Bb(4),b.Fb("hidden",!e.activeTabIs("tickets")),b.Bb(1),b.nc("openTicketInModal",!0),b.Bb(1),b.nc("ngIf",!(null!=e.results.tickets&&null!=e.results.tickets.data&&e.results.tickets.data.length||e.isSearching)),b.Bb(2),b.Fb("hidden",!e.activeTabIs("users")),b.Bb(1),b.nc("ngForOf",null==e.results.users?null:e.results.users.data),b.Bb(1),b.Fb("hidden",!e.activeTabIs("articles")),b.Bb(2),b.nc("ngForOf",null==e.results.articles?null:e.results.articles.data))},directives:[T.i,w.a,V.a,T.f,i.d,i.u,i.j,$,n.t,Z,n.s,W.a,r.i],pipes:[n.b],styles:[".agent-search-modal-container{height:100%;width:100%;max-width:none!important}.agent-search-modal-container .mat-dialog-container{border-radius:0}.agent-search-modal-container .mat-dialog-content{max-height:none;min-height:100%}.agent-search-modal-container .modal-header{margin-bottom:5px}.agent-search-modal-container h2{font-size:2.4rem;font-weight:400}.agent-search-modal-container .search-results{border:1px solid var(--be-divider-default);border-radius:4px;background-color:var(--be-background);min-height:calc(100% - 75px)}.agent-search-modal-container .search-results .tab-menu{display:flex;border-bottom:1px solid var(--be-divider-default)}.agent-search-modal-container .search-results .tab-menu .tab-menu-item{padding:15px;border-bottom:2px solid transparent;cursor:pointer}.agent-search-modal-container .search-results .tab-menu .tab-menu-item.active{border-color:var(--be-accent-default)}.agent-search-modal-container .search-results .tabs{border:1px solid var(--be-divider-default);margin:15px}.agent-search-modal-container .search-results .tabs .tab{min-height:50px}.agent-search-modal-container .search-results .tabs .users-tab{padding:8px}.agent-search-modal-container .search-results .tabs .users-tab .user{display:inline-flex;width:300px;height:80px;border:1px solid var(--be-divider-default);padding:15px;margin:8px;color:var(--be-text)}.agent-search-modal-container .search-results .tabs .users-tab .user:hover{background-color:var(--be-accent-emphasis)}.agent-search-modal-container .search-results .tabs .users-tab .user img{margin-right:10px;width:50px;height:50px;-o-object-fit:cover;object-fit:cover}.agent-search-modal-container .search-results .tabs .users-tab .user .text{padding-top:6px}.agent-search-modal-container .search-results .tabs .users-tab .user .text .title{font-size:1.5rem}.agent-search-modal-container .search-results .tabs .users-tab .user .text .body{color:var(--be-secondary-text)}.agent-search-modal-container .search-results .tabs .articles-list .article{display:flex;padding:13px;border-bottom:1px solid var(--be-divider-default);color:var(--be-text)}.agent-search-modal-container .search-results .tabs .articles-list .article:last-of-type{border-bottom:none}.agent-search-modal-container .search-results .tabs .articles-list .article:hover{background-color:var(--be-accent-emphasis)}.agent-search-modal-container .search-results .tabs .articles-list .article .mat-icon{width:35px;height:35px;color:var(--be-secondary-text);margin-right:5px}.agent-search-modal-container .search-results .tabs .articles-list .article .article-info .title{font-size:1.6rem}.agent-search-modal-container .search-results .tabs .articles-list .article .article-info .body{word-wrap:break-word;color:var(--be-secondary-text)}.agent-search-modal-container .search-results .tabs tickets-list{background-color:transparent}.agent-search-modal-container .search-input{height:50px;margin-bottom:25px}.agent-search-modal-container .search-input input{height:100%;border-radius:4px}"],encapsulation:2}),it),ot=a("LRne"),ct=a("/1cH"),st=a("bTqV"),lt=a("YdAL"),bt=a("FKr1");function ut(t,e){if(1&t){var a=b.Vb();b.Ub(0,"div",16),b.bc("click",(function(t){return b.zc(a),b.fc(2).setActiveCategory("tickets"),t.stopPropagation()})),b.Kc(1,"Conversations"),b.Tb()}if(2&t){var n=b.fc(2);b.Fb("active","tickets"===n.activeCategory)}}function dt(t,e){if(1&t){var a=b.Vb();b.Ub(0,"div",17),b.bc("click",(function(t){return b.zc(a),b.fc(2).setActiveCategory("users"),t.stopPropagation()})),b.Kc(1,"Users"),b.Tb()}if(2&t){var n=b.fc(2);b.Fb("active","users"===n.activeCategory)}}function pt(t,e){if(1&t){var a=b.Vb();b.Ub(0,"div",24),b.bc("click",(function(){b.zc(a);var t=b.fc().$implicit;return b.fc(3).navigateToUser(t.user.id)})),b.Kc(1),b.Tb()}if(2&t){var n=b.fc().$implicit;b.Bb(1),b.Lc(n.user.display_name)}}function mt(t,e){if(1&t){var a=b.Vb();b.Ub(0,"mat-option",20),b.bc("click",(function(){b.zc(a);var t=e.$implicit;return b.fc(3).navigateToTicket(t.id)})),b.Ub(1,"div",21),b.Kc(2),b.Tb(),b.Ub(3,"div",22),b.Kc(4),b.Tb(),b.Ic(5,pt,2,1,"div",23),b.Tb()}if(2&t){var n=e.$implicit;b.Bb(2),b.Lc(n.subject),b.Bb(2),b.Lc(n.latest_reply&&n.latest_reply.body),b.Bb(1),b.nc("ngIf",n.user)}}function gt(t,e){if(1&t&&(b.Ub(0,"div",18),b.Ic(1,mt,6,3,"mat-option",19),b.Tb()),2&t){var a=b.fc(2);b.Bb(1),b.nc("ngForOf",a.results.tickets.data)}}function ht(t,e){if(1&t){var a=b.Vb();b.Ub(0,"mat-option",27),b.bc("click",(function(){b.zc(a);var t=e.$implicit;return b.fc(3).navigateToUser(t.id)})),b.Pb(1,"img",28),b.Ub(2,"div",29),b.Ub(3,"div",21),b.Kc(4),b.Tb(),b.Ub(5,"div",22),b.Kc(6),b.Tb(),b.Tb(),b.Tb()}if(2&t){var n=e.$implicit;b.Bb(1),b.oc("src",n.avatar,b.Cc),b.Bb(3),b.Lc(n.email),b.Bb(2),b.Lc(n.display_name)}}function ft(t,e){if(1&t&&(b.Ub(0,"div",25),b.Ic(1,ht,7,3,"mat-option",26),b.Tb()),2&t){var a=b.fc(2);b.Bb(1),b.nc("ngForOf",a.results.users.data)}}function vt(t,e){if(1&t){var a=b.Vb();b.Ub(0,"div",30),b.bc("click",(function(){return b.zc(a),b.fc(2).openSearchModal()})),b.Ub(1,"span",31),b.Kc(2,"View All Results"),b.Tb(),b.Tb()}}function kt(t,e){if(1&t&&(b.Ub(0,"div",9),b.Ub(1,"div",10),b.Ic(2,ut,2,2,"div",11),b.Ic(3,dt,2,2,"div",12),b.Tb(),b.Ic(4,gt,2,1,"div",13),b.Ic(5,ft,2,1,"div",14),b.Ic(6,vt,3,0,"div",15),b.Tb()),2&t){var a=b.fc();b.Bb(2),b.nc("ngIf",a.results.tickets.data.length),b.Bb(1),b.nc("ngIf",a.results.users.data.length),b.Bb(1),b.nc("ngIf","tickets"===a.activeCategory),b.Bb(1),b.nc("ngIf","users"===a.activeCategory),b.Bb(1),b.nc("ngIf",a.searchQuery.value)}}function yt(t,e){1&t&&(b.Ub(0,"div",32),b.Kc(1," No tickets or users matching your search query were found. "),b.Tb())}var Tt,xt={data:{tickets:{},users:{},articles:{}}},Ut=((Tt=function(){function t(e,a,n){_classCallCheck(this,t),this.tickets=e,this.router=a,this.modal=n,this.searchQuery=new i.i,this.activeCategory="tickets",this.hasResults=!1,this.loadedResultsAtLeastOnce=!1,this.isLoading=!1,this.results={tickets:{data:[]},users:{data:[]}}}return _createClass(t,[{key:"ngOnInit",value:function(){this.bindToQueryChangeEvent()}},{key:"setActiveCategory",value:function(t){this.activeCategory=t}},{key:"navigateToTicket",value:function(t){this.reset(),this.router.navigate(["/mailbox/tickets",t])}},{key:"navigateToUser",value:function(t){this.reset(),this.router.navigate(["/mailbox/users",t])}},{key:"openSearchModal",value:function(){if(this.searchQuery.value){var t=this.searchQuery.value;this.reset(),this.modal.open(rt,{query:t},{panelClass:"agent-search-modal-container"})}}},{key:"search",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?(this.isLoading=!0,this.tickets.search(e,{query:e}).pipe(Object(g.a)((function(e){t.hasResults=!(!e.results.tickets.total&&!e.results.users.total),t.loadedResultsAtLeastOnce=!0,t.results=e.results,t.isLoading=!1,t.setActiveCategory(e.results.tickets.total?"tickets":"users")})))):Object(ot.a)(xt)}},{key:"reset",value:function(){this.searchQuery.setValue(null),this.hasResults=!1,this.results=null,this.activeCategory="tickets",this.loadedResultsAtLeastOnce=!1}},{key:"bindToQueryChangeEvent",value:function(){var t=this;this.searchQuery.valueChanges.pipe(Object(h.a)(250),Object(l.a)(),Object(f.a)((function(e){return t.search(e)})),Object(v.a)((function(){return Object(ot.a)(xt)}))).subscribe()}}]),t}()).\u0275fac=function(t){return new(t||Tt)(b.Ob(k.a),b.Ob(r.f),b.Ob(U.a))},Tt.\u0275cmp=b.Ib({type:Tt,selectors:[["ticket-search-dropdown"]],features:[b.Ab([k.a])],decls:9,vars:4,consts:[[1,"input-container",3,"ngSubmit"],["type","text","placeholder","Search...","trans-placeholder","",1,"search-input",3,"matAutocomplete","formControl"],["input",""],["mat-icon-button","",1,"search-button"],["svgIcon","search"],["customScrollbar","",1,"agent-mailbox-autocomplete"],["auto","matAutocomplete"],["class","results-container",4,"ngIf"],["class","no-results","trans","",4,"ngIf"],[1,"results-container"],[1,"header"],["class","header-item tickets-item","trans","",3,"active","click",4,"ngIf"],["class","header-item users-item","trans","",3,"active","click",4,"ngIf"],["class","results-panel tickets-panel",4,"ngIf"],["class","results-panel users-panel",4,"ngIf"],["class","footer",3,"click",4,"ngIf"],["trans","",1,"header-item","tickets-item",3,"click"],["trans","",1,"header-item","users-item",3,"click"],[1,"results-panel","tickets-panel"],["class","result",3,"click",4,"ngFor","ngForOf"],[1,"result",3,"click"],[1,"title"],[1,"body"],["class","user",3,"click",4,"ngIf"],[1,"user",3,"click"],[1,"results-panel","users-panel"],["class","result media",3,"click",4,"ngFor","ngForOf"],[1,"result","media",3,"click"],["alt","customer avatar",1,"avatar",3,"src"],[1,"text"],[1,"footer",3,"click"],["trans",""],["trans","",1,"no-results"]],template:function(t,e){if(1&t&&(b.Ub(0,"form",0),b.bc("ngSubmit",(function(){return e.openSearchModal()})),b.Pb(1,"input",1,2),b.Ub(3,"button",3),b.Pb(4,"mat-icon",4),b.Tb(),b.Tb(),b.Ub(5,"mat-autocomplete",5,6),b.Ic(7,kt,7,5,"div",7),b.Ic(8,yt,2,0,"div",8),b.Tb()),2&t){var a=b.wc(6);b.Bb(1),b.nc("matAutocomplete",a)("formControl",e.searchQuery),b.Bb(6),b.nc("ngIf",e.results),b.Bb(1),b.nc("ngIf",e.searchQuery.value&&!e.isLoading&&!e.hasResults&&e.loadedResultsAtLeastOnce)}},directives:[i.K,i.v,i.w,ct.c,i.d,w.a,i.u,i.j,st.b,V.a,ct.a,lt.a,n.t,n.s,bt.l],styles:["ticket-search-dropdown{display:block;position:relative;max-width:700px;width:100%}ticket-search-dropdown .input-container{position:relative}ticket-search-dropdown .input-container .search-button{position:absolute;top:2px;left:0;z-index:1}ticket-search-dropdown .input-container input{padding-left:36px}ticket-search-dropdown .input-container input::-moz-placeholder{color:var(--be-accent-contrast)}ticket-search-dropdown .input-container input:-ms-input-placeholder{color:var(--be-accent-contrast)}ticket-search-dropdown .input-container input::-ms-input-placeholder{color:var(--be-accent-contrast)}ticket-search-dropdown .input-container input::placeholder{color:var(--be-accent-contrast)}.agent-mailbox-autocomplete.mat-autocomplete-panel{max-height:750px;background-color:var(--be-background)}.agent-mailbox-autocomplete.mat-autocomplete-panel .header{display:flex;background-color:var(--be-background-alternative)}.agent-mailbox-autocomplete.mat-autocomplete-panel .header .header-item{width:50%;flex:0 0 50%;padding:12px;border-bottom:2px solid var(--be-divider-default);cursor:pointer}.agent-mailbox-autocomplete.mat-autocomplete-panel .header .header-item.active{border-color:var(--be-accent-default)}.agent-mailbox-autocomplete.mat-autocomplete-panel .no-results{font-size:1.5rem;text-align:center;width:100%;padding:10px}.agent-mailbox-autocomplete.mat-autocomplete-panel .footer{background-color:var(--be-background-alternative);text-align:center;padding:10px;cursor:pointer}.agent-mailbox-autocomplete.mat-autocomplete-panel .result{border-bottom:1px solid var(--be-divider-default);padding:10px 15px;height:auto;line-height:normal;font-size:1.4rem}.agent-mailbox-autocomplete.mat-autocomplete-panel .result:hover{background-color:var(--be-background-alternative)}.agent-mailbox-autocomplete.mat-autocomplete-panel .title{font-weight:500;color:var(--be-text);overflow:hidden}.agent-mailbox-autocomplete.mat-autocomplete-panel .body{color:var(--be-secondary-text);font-size:1.3rem;word-wrap:break-word;white-space:-webkit-pre-wrap;word-break:break-all;white-space:normal}.agent-mailbox-autocomplete.mat-autocomplete-panel .user{margin-top:5px;font-size:1.25rem;font-weight:500;color:var(--be-secondary-text)}.agent-mailbox-autocomplete.mat-autocomplete-panel .media .mat-option-text{display:flex;align-items:center}.agent-mailbox-autocomplete.mat-autocomplete-panel .media .mat-option-text img{margin-right:10px;width:50px;height:50px;-o-object-fit:cover;object-fit:cover}"],encapsulation:2}),Tt),Ct=a("XhcP"),Ot=a("JxJJ"),It=function(){return["/mailbox/tickets"]},wt=function(t){return{tagId:t}};function _t(t,e){if(1&t&&(b.Ub(0,"div",18),b.Ub(1,"a",19),b.gc(2,"async"),b.Ub(3,"span",20),b.Kc(4),b.gc(5,"trans"),b.Tb(),b.Ub(6,"span",21),b.Kc(7),b.Tb(),b.Tb(),b.Tb()),2&t){var a=e.$implicit,n=b.fc();b.nc("@fadeIn",void 0),b.Bb(1),b.Fb("router-link-active",b.hc(2,10,n.mailboxTags.activeTagId$)==a.id),b.nc("routerLink",b.rc(14,It))("queryParams",b.sc(15,wt,a.id))("ngClass",a.name),b.Bb(3),b.Lc(b.hc(5,12,a.display_name)),b.Bb(2),b.Fb("hidden",!a.tickets_count),b.Bb(1),b.Lc(a.tickets_count)}}function Pt(t,e){1&t&&(b.Ub(0,"div",24),b.Pb(1,"skeleton"),b.Tb())}var Bt=function(){return[1,2,3,4]};function Mt(t,e){1&t&&(b.Ub(0,"div",22),b.Ic(1,Pt,2,0,"div",23),b.Tb()),2&t&&(b.nc("@fadeOut",void 0),b.Bb(1),b.nc("ngForOf",b.rc(2,Bt)))}function Ft(t,e){if(1&t&&(b.Ub(0,"div",25),b.Ub(1,"a",26),b.gc(2,"async"),b.Ub(3,"span",20),b.Kc(4),b.Tb(),b.Ub(5,"span",21),b.Kc(6),b.Tb(),b.Tb(),b.Tb()),2&t){var a=e.$implicit,n=b.fc();b.nc("@fadeIn",void 0),b.Bb(1),b.Fb("router-link-active",b.hc(2,9,n.mailboxTags.activeTagId$)==a.id),b.nc("routerLink",b.rc(11,It))("queryParams",b.sc(12,wt,a.id)),b.Bb(3),b.Lc(a.display_name),b.Bb(1),b.Fb("hidden",!a.tickets_count),b.Bb(1),b.Lc(a.tickets_count)}}function Kt(t,e){1&t&&(b.Ub(0,"div",24),b.Pb(1,"skeleton"),b.Tb())}function At(t,e){1&t&&(b.Ub(0,"div",22),b.Ic(1,Kt,2,0,"div",23),b.Tb()),2&t&&(b.nc("@fadeOut",void 0),b.Bb(1),b.nc("ngForOf",b.rc(2,Bt)))}var Lt,St=((Lt=function(){function t(e,a,n,i){_classCallCheck(this,t),this.mailboxTags=e,this.route=a,this.i18n=n,this.breakpoints=i,this.leftColumnIsHidden=!1,this.trackByFn=function(t,e){return e.id}}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.leftColumnIsHidden=this.breakpoints.isMobile$.value,this.route.queryParams.pipe(Object(s.a)((function(t){return t.tagId})),Object(l.a)()).subscribe((function(e){t.mailboxTags.setActiveTag(e)}))}},{key:"toggleLeftSidebar",value:function(){this.leftColumnIsHidden=!this.leftColumnIsHidden}}]),t}()).\u0275fac=function(t){return new(t||Lt)(b.Ob(u.a),b.Ob(r.a),b.Ob(d.a),b.Ob(p.a))},Lt.\u0275cmp=b.Ib({type:Lt,selectors:[["mailbox"]],decls:31,vars:25,consts:[["menuPosition","agent-mailbox","color","accent",1,"box-shadow",3,"showToggleButton","hideToggleBtnOnDesktop","toggleButtonClick"],[1,"nav-searchbar"],[1,"mailbox-container"],[1,"left-column",3,"opened","mode","fixedInViewport","fixedTopGap"],[1,"aside-container","status-tags"],[1,"aside-container-title"],["svgIcon","inbox-custom",1,"title-icon"],["trans","",1,"aside-container-name"],[1,"aside-container-body"],["class","status-tag",4,"ngFor","ngForOf","ngForTrackBy"],["class","skeletons-container",4,"ngIf"],[1,"aside-container","category-tags"],["svgIcon","box-filled-custom",1,"title-icon"],["class","category-tag",4,"ngFor","ngForOf","ngForTrackBy"],[1,"bottom-action-container"],["mat-icon-button","","routerLink","/mailbox/tickets/new",3,"matTooltip"],["svgIcon","new-ticket-custom"],[1,"right-column"],[1,"status-tag"],[1,"aside-nav-item",3,"routerLink","queryParams","ngClass"],[1,"tag-name"],[1,"label","tickets-count"],[1,"skeletons-container"],["class","aside-nav-item",4,"ngFor","ngForOf"],[1,"aside-nav-item"],[1,"category-tag"],[1,"aside-nav-item",3,"routerLink","queryParams"]],template:function(t,e){1&t&&(b.Ub(0,"material-navbar",0),b.bc("toggleButtonClick",(function(){return e.toggleLeftSidebar()})),b.Pb(1,"ticket-search-dropdown",1),b.Tb(),b.Ub(2,"mat-sidenav-container",2),b.Ub(3,"mat-sidenav",3),b.gc(4,"async"),b.Ub(5,"section",4),b.Ub(6,"div",5),b.Pb(7,"mat-icon",6),b.Ub(8,"span",7),b.Kc(9,"Inbox"),b.Tb(),b.Tb(),b.Ub(10,"div",8),b.Ic(11,_t,8,17,"div",9),b.Ic(12,Mt,2,3,"div",10),b.gc(13,"async"),b.gc(14,"async"),b.Tb(),b.Tb(),b.Ub(15,"section",11),b.Ub(16,"div",5),b.Pb(17,"mat-icon",12),b.Ub(18,"span",7),b.Kc(19,"Folders"),b.Tb(),b.Tb(),b.Ub(20,"div",8),b.Ic(21,Ft,7,14,"div",13),b.Ic(22,At,2,3,"div",10),b.gc(23,"async"),b.gc(24,"async"),b.Tb(),b.Tb(),b.Ub(25,"div",14),b.Ub(26,"a",15),b.gc(27,"trans"),b.Pb(28,"mat-icon",16),b.Tb(),b.Tb(),b.Tb(),b.Ub(29,"mat-sidenav-content",17),b.Pb(30,"router-outlet"),b.Tb(),b.Tb()),2&t&&(b.nc("showToggleButton",!0)("hideToggleBtnOnDesktop",!0),b.Bb(3),b.nc("opened",!e.leftColumnIsHidden)("mode",b.hc(4,13,e.breakpoints.isMobile$)?"over":"side")("fixedInViewport",!0)("fixedTopGap",70),b.Bb(8),b.nc("ngForOf",e.mailboxTags.viewTags)("ngForTrackBy",e.trackByFn),b.Bb(1),b.nc("ngIf",!b.hc(13,15,e.mailboxTags.allTags$).length&&b.hc(14,17,e.mailboxTags.loading$)),b.Bb(9),b.nc("ngForOf",e.mailboxTags.categoryTags)("ngForTrackBy",e.trackByFn),b.Bb(1),b.nc("ngIf",!b.hc(23,19,e.mailboxTags.allTags$).length&&b.hc(24,21,e.mailboxTags.loading$)),b.Bb(4),b.nc("matTooltip",b.hc(27,23,"Create new ticket")))},directives:[m.a,Ut,Ct.b,Ct.a,V.a,w.a,n.s,n.t,st.a,r.i,q.a,Ct.c,r.k,n.q,Ot.a],pipes:[n.b,G.a],styles:["[_nghost-%COMP%]{display:block;position:relative;max-height:100vh;overflow:hidden}material-navbar[_ngcontent-%COMP%]{height:70px}.left-column[_ngcontent-%COMP%]{width:225px;background-color:var(--be-background-alternative);border-right:1px solid var(--be-divider-default)}.aside-container[_ngcontent-%COMP%]{list-style:none;padding-left:0}skeleton[_ngcontent-%COMP%]{max-width:77%}.aside-container-body[_ngcontent-%COMP%]{position:relative;min-height:160px}.skeletons-container[_ngcontent-%COMP%]{position:absolute;top:0;width:100%}.aside-container-title[_ngcontent-%COMP%]{position:relative;padding:20px 15px 15px;text-transform:uppercase;letter-spacing:.03em;color:var(--be-secondary-text);font-weight:500;white-space:nowrap;overflow:hidden}.aside-container-title[_ngcontent-%COMP%]   .title-icon[_ngcontent-%COMP%]{position:absolute;top:17px}.aside-container-title[_ngcontent-%COMP%]   .aside-container-name[_ngcontent-%COMP%]{padding-left:30px}.aside-nav-item[_ngcontent-%COMP%]{display:block;position:relative;padding:10px 0 10px 41px;cursor:pointer;clear:both;text-transform:capitalize;color:#858b94;text-decoration:none;width:100%;border-left:3px solid transparent}.aside-nav-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:1.1rem;text-transform:none;position:absolute;top:12px;right:5px;border-radius:20px;padding:1px 10px;line-height:15px}.aside-nav-item[_ngcontent-%COMP%]   .tag-name[_ngcontent-%COMP%]{display:block;max-width:80%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.aside-nav-item.router-link-active[_ngcontent-%COMP%]{background-color:var(--be-accent-emphasis);border-left-color:var(--be-accent-default)}.aside-nav-item.router-link-active[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{background-color:var(--be-accent-default);color:var(--be-accent-contrast)}.aside-nav-item[_ngcontent-%COMP%]:hover{background-color:var(--be-hover)}.be-dark-mode[_nghost-%COMP%]   .aside-nav-item[_ngcontent-%COMP%], .be-dark-mode   [_nghost-%COMP%]   .aside-nav-item[_ngcontent-%COMP%]{color:var(--be-secondary-text)}.right-column[_ngcontent-%COMP%]{background-color:var(--be-background)}conversation[_ngcontent-%COMP%]{margin-bottom:15px}.bottom-action-container[_ngcontent-%COMP%]{position:absolute;bottom:5px;left:5px;color:var(--be-secondary-text)}"],data:{animation:c}}),Lt),jt=a("9C01");function $t(t,e){1&t&&(b.Ub(0,"no-results-message",1),b.Ub(1,"span",2),b.Kc(2,"There are no tickets in this category yet."),b.Tb(),b.Tb())}var zt,Vt=((zt=function(){function t(e,a,n,i,r,o){_classCallCheck(this,t),this.mailboxTags=e,this.router=a,this.modal=n,this.route=i,this.backendEvents=r,this.datatable=o,this.datatable.paginator.perPageCacheKey="agent-ticket-list-per-page"}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.datatable.init({uri:"tickets",staticParams:{tagId:this.mailboxTags.activeTagId$.value}}),this.mailboxSub=this.mailboxTags.activeTagId$.pipe(Object(l.a)()).subscribe((function(e){t.datatable.reset({tagId:e})})),this.bindToBackendEvents()}},{key:"ngOnDestroy",value:function(){this.datatable.destroy(),this.mailboxSub.unsubscribe()}},{key:"bindToBackendEvents",value:function(){var t=this;this.backendEvents.ticketCreated.subscribe((function(e){e.tags&&e.tags.find((function(e){return e.id===t.mailboxTags.activeTagId$.value}))&&(t.datatable.data.find((function(t){return t.id===e.id}))||(e.animated=!0,t.datatable.data=[e].concat(_toConsumableArray(t.datatable.data)),t.mailboxTags.refresh()))}))}}]),t}()).\u0275fac=function(t){return new(t||zt)(b.Ob(u.a),b.Ob(r.f),b.Ob(U.a),b.Ob(r.a),b.Ob(jt.a),b.Ob(C.a))},zt.\u0275cmp=b.Ib({type:zt,selectors:[["agent-mailbox-ticket-list"]],features:[b.Ab([C.a])],decls:4,vars:3,consts:[["svgImage","opened.svg",4,"ngIf"],["svgImage","opened.svg"],["primary-text","","trans",""]],template:function(t,e){1&t&&(b.Ub(0,"tickets-list"),b.Ic(1,$t,3,0,"no-results-message",0),b.gc(2,"async"),b.Tb(),b.Pb(3,"ticket-floating-toolbar")),2&t&&(b.Bb(1),b.nc("ngIf",b.hc(2,1,e.datatable.paginator.noResults$)))},directives:[$,n.t,Z,W.a,w.a],pipes:[n.b],styles:["agent-mailbox-ticket-list{display:block;height:calc(100vh - 70px)}"],encapsulation:2}),zt),Et=a("9VjZ"),Rt=a("Dbf7"),Qt=a("/33f"),qt=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var a in _classCallCheck(this,t),e)this[a]=e[a]},Dt=a("mWN8");function Nt(t,e){if(1&t&&(b.Ub(0,"div",11),b.Kc(1),b.Tb()),2&t){var a=b.fc();b.Bb(1),b.Lc(a.errors["emails.0"])}}var Gt,Ht=((Gt=function(){function t(e,a,n){_classCallCheck(this,t),this.dialogRef=e,this.data=a,this.users=n,this.errors={}}return _createClass(t,[{key:"close",value:function(t){this.dialogRef.close(t)}},{key:"confirm",value:function(){var t=this;this.users.addEmail(this.data.userId,{emails:[this.emailAddress]}).subscribe((function(){t.close(t.emailAddress)}),(function(e){return t.errors=e.errors}))}}]),t}()).\u0275fac=function(t){return new(t||Gt)(b.Ob(T.h),b.Ob(T.a),b.Ob(Dt.a))},Gt.\u0275cmp=b.Ib({type:Gt,selectors:[["email-address-modal"]],decls:15,vars:2,consts:[[1,"modal-header"],["mat-dialog-title","","trans",""],["type","button","mat-icon-button","","tabindex","-1",1,"close-button",3,"click"],["svgIcon","close"],["ngNativeValidate","","mat-dialog-content","",3,"ngSubmit"],[1,"input-container"],["for","email"],["type","email","name","email","id","email","required","",3,"ngModel","ngModelChange"],["class","error",4,"ngIf"],["type","button","mat-button","","trans","",1,"cancel-button",3,"click"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button"],[1,"error"]],template:function(t,e){1&t&&(b.Ub(0,"div",0),b.Ub(1,"h2",1),b.Kc(2,"Enter Email Address"),b.Tb(),b.Ub(3,"button",2),b.bc("click",(function(){return e.close()})),b.Pb(4,"mat-icon",3),b.Tb(),b.Tb(),b.Ub(5,"form",4),b.bc("ngSubmit",(function(){return e.confirm()})),b.Ub(6,"div",5),b.Pb(7,"label",6),b.Ub(8,"input",7),b.bc("ngModelChange",(function(t){return e.emailAddress=t})),b.Tb(),b.Ic(9,Nt,2,1,"div",8),b.Tb(),b.Ub(10,"mat-dialog-actions"),b.Ub(11,"button",9),b.bc("click",(function(){return e.close()})),b.Kc(12,"Cancel"),b.Tb(),b.Ub(13,"button",10),b.Kc(14,"Confirm"),b.Tb(),b.Tb(),b.Tb()),2&t&&(b.Bb(8),b.nc("ngModel",e.emailAddress),b.Bb(1),b.nc("ngIf",e.errors["emails.0"]))},directives:[T.i,w.a,st.b,V.a,i.v,i.w,T.f,i.d,i.F,i.u,i.x,n.t,T.c],styles:[""],encapsulation:2}),Gt),Jt=a("Lm4C"),Xt=a("QeDF"),Yt=a("2Vo4"),Zt=a("3FDK"),Wt=a("IuoX"),te=a("kmQS"),ee=a("xrwy"),ae=a("wZkO"),ne=a("0rE+"),ie=a("vn70");function re(t,e){if(1&t&&b.Pb(0,"mat-icon",36),2&t){b.fc();var a=b.wc(12);b.nc("matMenuTriggerFor",a)}}function oe(t,e){if(1&t&&(b.Ub(0,"div",19),b.Ub(1,"div",16),b.Kc(2,"Envato"),b.Tb(),b.Ub(3,"div",37),b.Kc(4),b.Tb(),b.Tb()),2&t){var a=b.fc();b.Bb(4),b.Lc(a.user.purchase_codes[0].envato_username)}}function ce(t,e){if(1&t){var a=b.Vb();b.Ub(0,"button",40),b.bc("click",(function(){b.zc(a);var t=b.fc().$implicit;return b.fc().removeEmail(t.address)})),b.Pb(1,"mat-icon",41),b.Tb()}}function se(t,e){if(1&t&&(b.Ub(0,"div",38),b.Ic(1,ce,2,0,"button",39),b.Ub(2,"span"),b.Kc(3),b.Tb(),b.Tb()),2&t){var a=e.$implicit,n=b.fc();b.Bb(1),b.nc("ngIf",n.detailsEditable),b.Bb(2),b.Lc(a.address)}}function le(t,e){if(1&t){var a=b.Vb();b.Ub(0,"div",19),b.Ub(1,"button",42),b.bc("click",(function(){return b.zc(a),b.fc().openAddEmailModal()})),b.Kc(2,"Add Email"),b.Tb(),b.Tb()}}var be,ue,de=((ue=function(){function t(e,a,n,r,o,c,s,l,b){_classCallCheck(this,t),this.users=e,this.route=a,this.toast=n,this.modal=r,this.avatarValidator=o,this.currentUser=c,this.settings=s,this.reports=l,this.datatable=b,this.user=new Qt.a({purchase_codes:[]}),this.detailsEditable=!1,this.userSearches$=new Yt.a(null),this.profile=new i.l({details:new i.i,notes:new i.i}),this.tagsControl=new i.i([])}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.route.data.subscribe((function(e){t.hydrateProfile(e.user),t.bindFormControls(),t.createDataSource()})),this.detailsEditable=this.currentUser.hasPermission("users.update")}},{key:"openAddEmailModal",value:function(){var t=this;this.modal.show(Ht,{userId:this.user.id}).afterClosed().subscribe((function(e){t.user.secondary_emails.push(new qt({address:e}))}))}},{key:"removeEmail",value:function(t){var e=this;this.users.removeEmail(this.user.id,{emails:[t]}).subscribe((function(){var a=e.user.secondary_emails.findIndex((function(e){return e.address===t}));e.user.secondary_emails.splice(a,1)}))}},{key:"openAvatarUploadDialog",value:function(){var t=this;Object(Jt.a)({types:[Xt.a.image]}).then((function(e){t.avatarValidator.validateWithToast(e[0]).failed||t.users.uploadAvatar(t.user.id,e).subscribe((function(e){t.user.avatar=e.user.avatar,t.currentUser.set("avatar",e.user.avatar),t.toast.open("Avatar updated")}),(function(e){var a=Object.keys(e.errors)[0];t.toast.open(e.errors[a])}))}))}},{key:"deleteAvatar",value:function(){var t=this;this.users.deleteAvatar(this.user.id).subscribe((function(e){t.user.avatar=e.avatar,t.toast.open("Avatar removed.")}))}},{key:"hydrateProfile",value:function(t){this.user=t,t.details&&this.profile.setValue({details:t.details.details,notes:t.details.notes}),this.tagsControl.setValue(t.tags.map((function(t){return t.name})))}},{key:"createDataSource",value:function(){this.datatable.paginator.dontUpdateQueryParams=!0,this.datatable.init({uri:"tickets",staticParams:{userId:this.user.id}})}},{key:"bindFormControls",value:function(){var t=this;this.profile.valueChanges.pipe(Object(h.a)(600),Object(l.a)()).subscribe((function(e){t.users.updateDetails(t.user.id,e).subscribe((function(){t.toast.open("Updated user details.")}))})),this.tagsControl.valueChanges.subscribe((function(e){t.users.syncTags(t.user.id,{tags:e}).subscribe()}))}},{key:"tabChanged",value:function(t){var e=this;1!==t.index||this.userSearches$.value||this.reports.getUserSearchesReport(this.user.id).subscribe((function(t){e.userSearches$.next(t.report)}))}}]),t}()).\u0275fac=function(t){return new(t||ue)(b.Ob(Dt.a),b.Ob(r.a),b.Ob(E.b),b.Ob(U.a),b.Ob(Wt.a),b.Ob(R.a),b.Ob(te.a),b.Ob(ee.a),b.Ob(C.a))},ue.\u0275cmp=b.Ib({type:ue,selectors:[["user-profile"]],viewQuery:function(t,e){var a;1&t&&b.Gc(Zt.a,!0),2&t&&b.vc(a=b.cc())&&(e.tagsManager=a.first)},features:[b.Ab([C.a])],decls:66,vars:28,consts:[["menuPosition","agent-mailbox"],[1,"nav-searchbar"],[1,"content"],["customScrollbar","lite",1,"sidebar"],[1,"panel"],[1,"panel-body"],[1,"user-info"],[1,"avatar-container"],["alt","user avatar",1,"user-avatar",3,"src"],[1,"hover-overlay"],["svgIcon","edit",3,"matMenuTriggerFor",4,"ngIf"],[1,"update-avatar-menu"],["updateAvatarMenu","matMenu"],["mat-menu-item","","trans","",1,"upload-avatar-item",3,"click"],["mat-menu-item","","trans","",1,"delete-avatar-item",3,"click"],[1,"names"],[1,"name"],[1,"email","primary-email"],[1,"user-details"],[1,"details-row"],["trans","",1,"name"],[1,"input-container","value"],["name","details","id","details",3,"formControl","readonly"],["name","notes","id","notes",3,"formControl","readonly"],["class","details-row",4,"ngIf"],[1,"emails","value"],["class","email secondary-email",4,"ngFor","ngForOf"],["trans","",1,"panel-header"],[3,"formControl","readonly"],["color","accent",3,"selectedTabChange"],[3,"label"],[1,"tickets"],[3,"openTicketInModal"],["primary-text","","trans",""],[3,"data"],["trans",""],["svgIcon","edit",3,"matMenuTriggerFor"],[1,"value"],[1,"email","secondary-email"],["class","remove-email-button","mat-icon-button","",3,"click",4,"ngIf"],["mat-icon-button","",1,"remove-email-button",3,"click"],["svgIcon","close"],["mat-flat-button","","color","accent","trans","",1,"add-email-button",3,"click"]],template:function(t,e){1&t&&(b.Ub(0,"material-navbar",0),b.Pb(1,"ticket-search-dropdown",1),b.Tb(),b.Ub(2,"div",2),b.Ub(3,"aside",3),b.Ub(4,"div",4),b.Ub(5,"div",5),b.Ub(6,"div",6),b.Ub(7,"div",7),b.Pb(8,"img",8),b.Ub(9,"div",9),b.Ic(10,re,1,1,"mat-icon",10),b.Tb(),b.Tb(),b.Ub(11,"mat-menu",11,12),b.Ub(13,"button",13),b.bc("click",(function(){return e.openAvatarUploadDialog()})),b.Kc(14,"Upload"),b.Tb(),b.Ub(15,"button",14),b.bc("click",(function(){return e.deleteAvatar()})),b.Kc(16,"Remove"),b.Tb(),b.Tb(),b.Ub(17,"div",15),b.Ub(18,"div",16),b.Kc(19),b.Tb(),b.Ub(20,"div",17),b.Kc(21),b.Tb(),b.Tb(),b.Tb(),b.Ub(22,"div",18),b.Ub(23,"div",19),b.Ub(24,"div",20),b.Kc(25,"Details"),b.Tb(),b.Ub(26,"div",21),b.Pb(27,"textarea",22),b.Tb(),b.Tb(),b.Ub(28,"div",19),b.Ub(29,"div",20),b.Kc(30,"Notes"),b.Tb(),b.Ub(31,"div",21),b.Pb(32,"textarea",23),b.Tb(),b.Tb(),b.Ic(33,oe,5,1,"div",24),b.Ub(34,"div",19),b.Ub(35,"div",20),b.Kc(36,"Emails"),b.Tb(),b.Ub(37,"div",25),b.Ub(38,"div",17),b.Kc(39),b.Tb(),b.Ic(40,se,4,2,"div",26),b.Tb(),b.Tb(),b.Ic(41,le,3,0,"div",24),b.Tb(),b.Tb(),b.Tb(),b.Ub(42,"div",4),b.Ub(43,"div",27),b.Kc(44,"Tags"),b.Tb(),b.Ub(45,"div",5),b.Pb(46,"tags-manager",28),b.Tb(),b.Tb(),b.Tb(),b.Ub(47,"mat-tab-group",29),b.bc("selectedTabChange",(function(t){return e.tabChanged(t)})),b.Ub(48,"mat-tab",30),b.gc(49,"trans"),b.Ub(50,"div",31),b.Ub(51,"tickets-list",32),b.Ub(52,"no-results-message"),b.gc(53,"async"),b.Ub(54,"span",33),b.Kc(55,"This user did not create any tickets yet."),b.Tb(),b.Tb(),b.Tb(),b.Pb(56,"ticket-floating-toolbar"),b.Tb(),b.Tb(),b.Ub(57,"mat-tab",30),b.gc(58,"trans"),b.Ub(59,"search-report-table",34),b.gc(60,"async"),b.Ub(61,"span",35),b.Kc(62,"Search Term"),b.Tb(),b.Ub(63,"info-popover"),b.Ub(64,"span",35),b.Kc(65,"This report shows what this user searched for recently."),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb()),2&t&&(b.Bb(8),b.oc("src",e.user.avatar,b.Cc),b.Bb(2),b.nc("ngIf",e.detailsEditable),b.Bb(9),b.Lc(e.user.display_name),b.Bb(2),b.Lc(e.user.email),b.Bb(6),b.nc("formControl",e.profile.controls.details)("readonly",!e.detailsEditable),b.Bb(5),b.nc("formControl",e.profile.controls.notes)("readonly",!e.detailsEditable),b.Bb(1),b.nc("ngIf",e.user.purchase_codes&&(null==e.user.purchase_codes[0]?null:e.user.purchase_codes[0].envato_username)),b.Bb(6),b.Lc(e.user.email),b.Bb(1),b.nc("ngForOf",e.user.secondary_emails),b.Bb(1),b.nc("ngIf",e.detailsEditable),b.Bb(5),b.nc("formControl",e.tagsControl)("readonly",!e.detailsEditable),b.Bb(2),b.nc("label",b.hc(49,20,"Tickets")),b.Bb(3),b.nc("openTicketInModal",!0),b.Bb(1),b.Fb("hidden",!b.hc(53,22,e.datatable.paginator.noResults$)),b.Bb(5),b.nc("label",b.hc(58,24,"Searches")),b.Bb(2),b.nc("data",b.hc(60,26,e.userSearches$)))},directives:[m.a,Ut,lt.a,n.t,D.e,D.b,w.a,i.d,i.u,i.j,n.s,Zt.a,ae.c,ae.a,$,W.a,Z,ne.a,ie.a,V.a,D.d,st.b],pipes:[G.a,n.b],styles:["user-profile{display:block;width:100%;height:100%;background-color:var(--be-background-alternative)}user-profile .content{display:flex;padding:25px;width:100%;height:calc(100vh - 70px);overflow:hidden}user-profile .sidebar{flex:0 0 320px;width:320px;margin-right:15px;height:100%;overflow:auto}user-profile .sidebar .panel{margin-bottom:15px;background-color:var(--be-background);border:1px solid var(--be-divider-default);padding:10px}user-profile .sidebar .panel .panel-header{padding:5px}user-profile .sidebar .user-info{display:flex;align-items:center;border-bottom:1px solid var(--be-divider-default);margin-bottom:15px;padding-bottom:15px}user-profile .sidebar .user-info .avatar-container{width:65px;height:65px;position:relative}user-profile .sidebar .user-info .avatar-container:hover .hover-overlay{display:flex}user-profile .sidebar .user-info .avatar-container.disabled{cursor:default}user-profile .sidebar .user-info .avatar-container.disabled>.hover-overlay{display:none}user-profile .sidebar .user-info .avatar-container .hover-overlay{display:none;position:absolute;top:0;bottom:0;width:100%;height:100%;background-color:hsla(0,0%,100%,.5);justify-content:center;align-items:center;cursor:pointer}user-profile .sidebar .user-info .avatar-container .hover-overlay>mat-icon{width:34px;height:34px;color:var(--be-secondary-text)}user-profile .sidebar .user-info .avatar-container>img{width:100%;height:100%;-o-object-fit:cover;object-fit:cover}user-profile .sidebar .user-info>.names{margin-left:10px}user-profile .sidebar .user-info>.names>.name{font-size:1.5rem}user-profile .sidebar .user-info>.names>.email{color:var(--be-secondary-text)}user-profile .sidebar .user-details{margin-top:15px}user-profile .sidebar .user-details .details-row{display:flex;align-items:center;margin-bottom:15px}user-profile .sidebar .user-details .details-row .name{flex:0 0 30%;max-width:40px;margin-right:20px}user-profile .sidebar .user-details .details-row .value{flex:1 1 auto}user-profile .sidebar .user-details .details-row .value.input-container{height:auto}user-profile .sidebar .user-details .details-row .value.input-container>textarea{height:auto;padding:5px;border-radius:3px}user-profile .sidebar .user-details .emails .primary-email{font-weight:500}user-profile .sidebar .user-details .emails .secondary-email{margin-top:8px}user-profile .mat-tab-group{flex:1 1 auto;height:100%;border:1px solid var(--be-divider-default);min-width:0}user-profile .mat-tab-body-wrapper,user-profile .tickets,user-profile search-report-table{height:100%}user-profile search-report-table .material-panel{border:none}"],encapsulation:2}),ue),pe=((be=function(){function t(e,a,n){_classCallCheck(this,t),this.tickets=e,this.users=a,this.router=n}return _createClass(t,[{key:"resolve",value:function(t,e){var a=this;return this.users.get(t.params.id,{with:"tags,purchase_codes,secondary_emails,details"}).pipe(Object(s.a)((function(t){if(t.user)return t.user;a.router.navigate(["/mailbox"])})))}}]),t}()).\u0275fac=function(t){return new(t||be)(b.Yb(k.a),b.Yb(Dt.a),b.Yb(r.f))},be.\u0275prov=b.Kb({token:be,factory:be.\u0275fac,providedIn:"root"}),be),me=a("0QyJ"),ge=a("h586"),he=a("KKQg"),fe=a("rG4v"),ve=a("83jf");function ke(t,e){if(1&t&&(b.Ub(0,"div",26),b.Kc(1),b.Tb()),2&t){var a=b.fc().ngIf;b.Bb(1),b.Lc(a.user_id)}}function ye(t,e){if(1&t&&(b.Ub(0,"mat-option",27),b.Ub(1,"div",28),b.Pb(2,"img",29),b.Ub(3,"div",30),b.Ub(4,"div",31),b.Kc(5),b.Tb(),b.Ub(6,"div",32),b.Kc(7),b.Tb(),b.Tb(),b.Tb(),b.Tb()),2&t){var a=e.$implicit;b.nc("value",a),b.Bb(2),b.nc("src",a.avatar,b.Cc),b.Bb(3),b.Lc(a.display_name),b.Bb(2),b.Lc(a.email)}}function Te(t,e){if(1&t&&(b.Ub(0,"div",33),b.Kc(1),b.Tb()),2&t){var a=b.fc().ngIf;b.Bb(1),b.Lc(a.subject)}}function xe(t,e){if(1&t&&(b.Ub(0,"option",34),b.Kc(1),b.Tb()),2&t){var a=e.$implicit;b.nc("ngValue",a.id),b.Bb(1),b.Lc(a.display_name)}}function Ue(t,e){if(1&t&&(b.Ub(0,"div",35),b.Kc(1),b.Tb()),2&t){var a=b.fc().ngIf;b.Bb(1),b.Lc(a.category)}}function Ce(t,e){if(1&t&&(b.Ub(0,"option",36),b.Kc(1),b.Tb()),2&t){var a=e.$implicit;b.nc("ngValue",a.name),b.Bb(1),b.Lc(a.display_name)}}function Oe(t,e){if(1&t&&(b.Ub(0,"div",37),b.Kc(1),b.Tb()),2&t){var a=b.fc().ngIf;b.Bb(1),b.Lc(a.status)}}function Ie(t,e){if(1&t&&(b.Ub(0,"div",38),b.Kc(1),b.Tb()),2&t){var a=b.fc().ngIf;b.Bb(1),b.Lc(a.body)}}function we(t,e){if(1&t){var a=b.Vb();b.Ub(0,"form",1),b.bc("ngSubmit",(function(){return b.zc(a),b.fc().createTicket()})),b.Ub(1,"div",2),b.Ub(2,"label",3),b.Kc(3,"Customer"),b.Tb(),b.Pb(4,"input",4),b.Ic(5,ke,2,1,"div",5),b.Tb(),b.Ub(6,"mat-autocomplete",6,7),b.Ic(8,ye,8,4,"mat-option",8),b.gc(9,"async"),b.Tb(),b.Ub(10,"div",2),b.Ub(11,"label",9),b.Kc(12,"Subject"),b.Tb(),b.Pb(13,"input",10),b.Ic(14,Te,2,1,"div",11),b.Tb(),b.Ub(15,"div",2),b.Ub(16,"label",12),b.Kc(17,"Category"),b.Tb(),b.Ub(18,"select",13),b.Ic(19,xe,2,2,"option",14),b.Tb(),b.Ic(20,Ue,2,1,"div",15),b.Tb(),b.Ub(21,"div",2),b.Ub(22,"label",16),b.Kc(23,"Status"),b.Tb(),b.Ub(24,"select",17),b.Ic(25,Ce,2,2,"option",18),b.Tb(),b.Ic(26,Oe,2,1,"div",19),b.Tb(),b.Ub(27,"div",20),b.Ub(28,"label",21),b.Kc(29,"Ticket Body"),b.Tb(),b.Ub(30,"text-editor",22),b.bc("onFileUpload",(function(t){return b.zc(a),b.fc().uploadFiles(t)}))("onChange",(function(t){return b.zc(a),b.fc().setBody(t)})),b.Tb(),b.Pb(31,"upload-progress-bar"),b.Ic(32,Ie,2,1,"div",23),b.Tb(),b.Ub(33,"reply-attachment-list",24),b.bc("detached",(function(t){return b.zc(a),b.fc().removeAttachment(t)})),b.gc(34,"async"),b.Tb(),b.Ub(35,"button",25),b.gc(36,"async"),b.Kc(37,"Create"),b.Tb(),b.Tb()}if(2&t){var n=e.ngIf,i=b.wc(7),r=b.fc();b.nc("formGroup",r.ticketForm),b.Bb(4),b.nc("matAutocomplete",i),b.Bb(1),b.nc("ngIf",n.user_id),b.Bb(1),b.nc("displayWith",r.displayUserFn),b.Bb(2),b.nc("ngForOf",b.hc(9,14,r.users$)),b.Bb(6),b.nc("ngIf",n.subject),b.Bb(5),b.nc("ngForOf",r.ticketCategories),b.Bb(1),b.nc("ngIf",n.category),b.Bb(5),b.nc("ngForOf",r.mailboxTags.statusTags),b.Bb(1),b.nc("ngIf",n.status),b.Bb(4),b.nc("minHeight",230),b.Bb(2),b.nc("ngIf",n.body),b.Bb(1),b.nc("attachments",b.hc(34,16,r.attachments$)),b.Bb(2),b.nc("disabled",b.hc(36,18,r.loading$))}}var _e,Pe,Be,Me=((_e=function(){function t(e,a,n,i,r,o,c,s,l){_classCallCheck(this,t),this.fb=e,this.settings=a,this.uploadQueue=n,this.users=i,this.tickets=r,this.toast=o,this.router=c,this.route=s,this.mailboxTags=l,this.errors$=new Yt.a({}),this.attachments$=new Yt.a([]),this.users$=new Yt.a([]),this.loading$=new Yt.a(!1),this.ticketCategories=[],this.ticketForm=this.fb.group({customer:[""],subject:[""],category:[""],body:[""],status:[""]})}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.bindToCustomerControl(),this.ticketForm.patchValue({status:this.mailboxTags.statusTags[0].name}),this.route.data.subscribe((function(e){t.ticketCategories=e.categories,e.categories.length&&t.ticketForm.patchValue({category:t.ticketCategories[0].id})}))}},{key:"createTicket",value:function(){var t=this;this.loading$.next(!0),this.tickets.create(this.getPayload()).pipe(Object(y.a)((function(){return t.loading$.next(!1)}))).subscribe((function(){t.toast.open("Ticket created"),t.mailboxTags.refresh(),t.router.navigateByUrl("/mailbox/tickets")}),(function(e){return t.errors$.next(e.errors)}))}},{key:"getPayload",value:function(){var t=this.ticketForm.value;return t.user_id=t.customer.id,t.uploads=this.uploadQueue.getAllCompleted().map((function(t){return t.id})),t}},{key:"setBody",value:function(t){this.ticketForm.patchValue({body:t})}},{key:"uploadFiles",value:function(t){var e=this;this.uploadQueue.start(t).subscribe((function(t){e.attachments$.next([].concat(_toConsumableArray(e.attachments$.value),[t.fileEntry]))}))}},{key:"removeAttachment",value:function(t){for(var e=this.attachments$.value.slice(),a=0;a<e.length;a++)e[a].id===t.id&&e.splice(a,1);this.attachments$.next(e)}},{key:"bindToCustomerControl",value:function(){var t=this;this.ticketForm.get("customer").valueChanges.pipe(Object(h.a)(250),Object(l.a)(),Object(f.a)((function(e){return t.searchUsers(e)})),Object(v.a)((function(){return Object(ot.a)([])}))).subscribe((function(e){t.users$.next(e)}))}},{key:"searchUsers",value:function(t){return t&&"string"==typeof t?this.users.getAll({query:t}):Object(ot.a)([])}},{key:"displayUserFn",value:function(t){return t?t.email:void 0}}]),t}()).\u0275fac=function(t){return new(t||_e)(b.Ob(i.h),b.Ob(te.a),b.Ob(ge.a),b.Ob(Dt.a),b.Ob(k.a),b.Ob(E.b),b.Ob(r.f),b.Ob(r.a),b.Ob(u.a))},_e.\u0275cmp=b.Ib({type:_e,selectors:[["create-ticket"]],features:[b.Ab([k.a,ge.a])],decls:2,vars:3,consts:[["class","many-inputs","ngNativeValidate","",3,"formGroup","ngSubmit",4,"ngIf"],["ngNativeValidate","",1,"many-inputs",3,"formGroup","ngSubmit"],[1,"input-container"],["for","user","trans",""],["type","text","id","user","formControlName","customer","required","",3,"matAutocomplete"],["class","error user-error",4,"ngIf"],[1,"create-ticket-user-autocomplete",3,"displayWith"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["for","subject","trans",""],["type","text","id","subject","formControlName","subject","required",""],["class","error subject-error",4,"ngIf"],["for","category-select","trans",""],["name","category","id","category-select","formControlName","category","required",""],[3,"ngValue",4,"ngFor","ngForOf"],["class","error category-error",4,"ngIf"],["for","status-select","trans",""],["name","status","id","status-select","formControlName","status","required",""],["class","status-tag-option",3,"ngValue",4,"ngFor","ngForOf"],["class","error status-error",4,"ngIf"],[1,"input-container","body-input-container"],["for","description","trans",""],["id","description","inlineUploadPrefix","ticket_images",3,"minHeight","onFileUpload","onChange"],["class","error body-error",4,"ngIf"],[3,"attachments","detached"],["mat-raised-button","","color","accent","type","submit","trans","",3,"disabled"],[1,"error","user-error"],[3,"value"],[1,"create-ticket-user-option"],[3,"src"],[1,"meta"],[1,"name"],[1,"email"],[1,"error","subject-error"],[3,"ngValue"],[1,"error","category-error"],[1,"status-tag-option",3,"ngValue"],[1,"error","status-error"],[1,"error","body-error"]],template:function(t,e){1&t&&(b.Ic(0,we,38,20,"form",0),b.gc(1,"async")),2&t&&b.nc("ngIf",b.hc(1,1,e.errors$))},directives:[n.t,i.v,i.m,w.a,i.d,ct.c,i.u,i.k,i.F,ct.a,n.s,i.G,he.a,fe.a,ve.a,st.b,bt.l,i.z,i.J],pipes:[n.b],styles:["create-ticket{display:block;padding:25px;overflow:auto;height:calc(100vh - 70px)}create-ticket form{max-width:800px}create-ticket .error{margin-top:7px;color:#f44336}create-ticket option,create-ticket select{text-transform:capitalize}.create-ticket-user-autocomplete .mat-option{height:auto;line-height:normal}.create-ticket-user-option{display:flex;padding:8px 0}.create-ticket-user-option img{width:40px;height:40px;flex-shrink:0;margin-right:10px;border-radius:4px;overflow:hidden}.create-ticket-user-option .name{color:var(--be-text);font-size:1.5rem}.create-ticket-user-option .email{color:var(--be-secondary-text);font-size:1.4rem}"],encapsulation:2,changeDetection:0}),_e),Fe=a("i70M"),Ke=a("vhtE"),Ae=r.j.forChild([{path:"",canActivate:[me.a,Ke.a],canActivateChild:[me.a,Ke.a],data:{permissions:["tickets.view","tickets.create"]},children:[{path:"",redirectTo:"tickets",pathMatch:"full"},{path:"tickets/new",component:St,resolve:{categories:Fe.a},data:{permissions:["tickets.create"]},children:[{path:"",component:Me}]},{path:"tickets",component:St,data:{permissions:["tickets.view"]},children:[{path:"",component:Vt},{path:":ticket_id",component:Et.a,resolve:{ticket:Rt.a}}]},{path:"users/:id",component:de,resolve:{user:pe},data:{permissions:["users.view","tickets.view","tags.view"]}}]}]),Le=a("DldP"),Se=a("YHvm"),je=a("gFpt"),$e=a("6rvT"),ze=a("Iysn"),Ve=a("JZOH"),Ee=a("1ImS"),Re=((Pe=function t(){_classCallCheck(this,t)}).\u0275mod=b.Mb({type:Pe}),Pe.\u0275inj=b.Lb({factory:function(t){return new(t||Pe)},imports:[[n.c,Ee.a,$e.a,r.j,bt.r,P.b,M.g]]}),Pe),Qe=a("GSRO"),qe=a("hD7E"),De=a("y04r"),Ne=a("/enU"),Ge=a("09gM"),He=a("losq"),Je=((Be=function t(){_classCallCheck(this,t)}).\u0275mod=b.Mb({type:Be}),Be.\u0275inj=b.Lb({factory:function(t){return new(t||Be)},providers:[k.a,pe],imports:[[n.c,i.o,i.E,r.j,Le.a,Se.a,je.a,$e.a,ze.a,Ve.a,Ge.a,Re,Qe.a,qe.a,De.a,Ne.a,He.a,Ae,V.b,st.c,q.b,ct.b,D.c,T.g,Ct.d,ae.g]]}),Be)},CZpq:function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));var n=a("fXoL"),i=a("LRXf"),r=function(){var t=function(){function t(e){_classCallCheck(this,t),this.http=e}return _createClass(t,[{key:"index",value:function(e){return this.http.get(t.BASE_URI,e)}},{key:"create",value:function(e){return this.http.post(t.BASE_URI,e)}},{key:"update",value:function(e,a){return this.http.put("".concat(t.BASE_URI,"/").concat(e),a)}},{key:"delete",value:function(e){return this.http.delete("".concat(t.BASE_URI,"/").concat(e))}}]),t}();return t.BASE_URI="tags",t.\u0275fac=function(e){return new(e||t)(n.Yb(i.a))},t.\u0275prov=n.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t}()}}]);