(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{"9lfv":function(t,e,a){"use strict";a.r(e),a.d(e,"TicketingModule",(function(){return je}));var i=a("ofXK"),n=a("3Pt+"),s=a("tyNb"),r=a("R0Ic");const o=[Object(r.m)("fadeIn",[Object(r.l)(":enter",[Object(r.k)({opacity:0}),Object(r.e)("325ms ease-in",Object(r.k)({opacity:1}))])]),Object(r.m)("fadeOut",[Object(r.l)(":leave",[Object(r.k)({opacity:1,position:"absolute",left:"0",right:"0"}),Object(r.e)("325ms ease-out",Object(r.k)({opacity:0}))])])];var c=a("lJxs"),l=a("/uUt"),b=a("fXoL"),d=a("wfim"),u=a("VaLf"),p=a("OnlV"),m=a("N2vX"),g=a("vkgz"),h=a("Kj3r"),f=a("eIep"),v=a("JIr8"),k=a("LsVx"),T=a("nYR2"),x=a("0IaG"),y=a("45UC"),U=a("QGXG"),O=a("2hX1"),I=a("Ivca"),C=a("Um6Z"),w=a("Rd8u"),B=a("rcZy"),P=a("bv9b"),_=a("eKg+"),M=a("A5z7");function F(t,e){1&t&&b.Pb(0,"mat-progress-bar",12)}function K(t,e){if(1&t&&(b.Ub(0,"mat-chip",31),b.Kc(1),b.Tb()),2&t){const t=b.fc().$implicit;b.Bb(1),b.Lc(t.display_name)}}function $(t,e){if(1&t&&(b.Sb(0),b.Ic(1,K,2,1,"mat-chip",30),b.Rb()),2&t){const t=e.$implicit;b.Bb(1),b.nc("ngIf","status"!==t.type)}}function L(t,e){if(1&t){const t=b.Vb();b.Ub(0,"tr",13),b.bc("click",(function(){b.zc(t);const a=e.$implicit;return b.fc().openConversation(a)})),b.Pb(1,"td",14),b.Ub(2,"td",15),b.Kc(3),b.Tb(),b.Ub(4,"td",16),b.Pb(5,"img",17),b.Tb(),b.Ub(6,"td",18),b.Ub(7,"div",19),b.Ub(8,"mat-chip-list",20),b.Ic(9,$,2,1,"ng-container",21),b.Tb(),b.Ub(10,"div",22),b.Kc(11),b.Tb(),b.Tb(),b.Ub(12,"div",23),b.Kc(13),b.Tb(),b.Tb(),b.Ub(14,"td",24),b.Ub(15,"span",25),b.Kc(16),b.Tb(),b.Tb(),b.Ub(17,"td",26),b.Ub(18,"div",27),b.Kc(19),b.Tb(),b.Tb(),b.Ub(20,"td",28),b.Kc(21),b.Tb(),b.Ub(22,"td",29),b.Ub(23,"div",27),b.Kc(24),b.Tb(),b.Tb(),b.Tb()}if(2&t){const t=e.$implicit,a=b.fc();b.Fb("not-closed",!t.closed_at)("open","open"===t.status)("selected",a.ticketSelected(t))("fadeIn",t.animated),b.Bb(1),b.nc("table-body-checkbox",t.id),b.Bb(2),b.Lc(null==t||null==t.user?null:t.user.display_name),b.Bb(2),b.oc("src",null==t||null==t.user?null:t.user.avatar,b.Cc),b.Bb(3),b.nc("selectable",!1),b.Bb(1),b.nc("ngForOf",t.tags),b.Bb(2),b.Lc(t.subject),b.Bb(2),b.Lc(a.getTicketBody(t)),b.Bb(3),b.Lc(t.replies_count||1),b.Bb(3),b.Lc(t.assignee?t.assignee.display_name:""),b.Bb(2),b.Lc(t.id),b.Bb(3),b.Lc(t.updated_at_formatted)}}const S=["*"];let j=(()=>{class t{constructor(t,e,a,i){this.router=t,this.modal=e,this.mailboxTags=a,this.datatable=i,this.openTicketInModal=!1,this.tickets$=this.datatable.data$}openConversation(t){this.openTicketInModal?this.modal.open(y.a,{ticketId:t.id},{panelClass:"conversation-modal-container"}):this.router.navigate(["mailbox/tickets",t.id],{queryParams:{tagId:this.mailboxTags.activeTagId$.value}})}ticketSelected(t){return this.datatable.selectedRows$.value.includes(t.id)}getTicketBody(t){return t.latest_reply&&t.latest_reply.body?t.latest_reply.body:t.replies&&t.replies.length?t.replies[0].body:void 0}}return t.\u0275fac=function(e){return new(e||t)(b.Ob(s.f),b.Ob(U.a),b.Ob(d.a),b.Ob(O.a))},t.\u0275cmp=b.Ib({type:t,selectors:[["tickets-list"]],inputs:{openTicketInModal:"openTicketInModal"},ngContentSelectors:S,decls:24,vars:6,consts:[["mode","indeterminate","color","accent",4,"ngIf"],[1,"table-container"],[1,"material-table","responsive-table"],["table-header-checkbox",""],["table-sort-header","user_id","trans","",1,"customer-column"],[1,"avatar-column"],["trans",""],["table-sort-header","replies_count",1,"replies-count-column"],["table-sort-header","","trans","",1,"assigned-to-column"],["table-sort-header","id","trans","",1,"number-column"],["table-sort-header","updated_at","trans","",1,"last-updated-column"],["class","animated",3,"not-closed","open","selected","fadeIn","click",4,"ngFor","ngForOf"],["mode","indeterminate","color","accent"],[1,"animated",3,"click"],[3,"table-body-checkbox"],["data-label","Customer",1,"customer-column"],[1,"avatar-column","hidden-on-mobile"],["alt","customer avatar",3,"src"],[1,"summary-column","mobile-no-label"],[1,"title"],[1,"ticket-tags",3,"selectable"],[4,"ngFor","ngForOf"],[1,"title-text","ticket-subject"],[1,"ellipses","ticket-body"],[1,"replies-count-column","hidden-on-mobile"],["title","Replies count",1,"replies-count-number"],["data-label","Assigned To",1,"assigned-to-column"],[1,"column-text-content"],["data-label","ID",1,"number-column"],["data-label","Last Updated",1,"last-updated-column"],["class","mat-compact-chip ticket-tag",4,"ngIf"],[1,"mat-compact-chip","ticket-tag"]],template:function(t,e){1&t&&(b.mc(),b.Ic(0,F,1,0,"mat-progress-bar",0),b.gc(1,"async"),b.Ub(2,"div",1),b.Ub(3,"table",2),b.Ub(4,"thead"),b.Ub(5,"tr"),b.Pb(6,"th",3),b.Ub(7,"th",4),b.Kc(8,"Customer"),b.Tb(),b.Pb(9,"th",5),b.Ub(10,"th",6),b.Kc(11,"Ticket Summary"),b.Tb(),b.Pb(12,"th",7),b.Ub(13,"th",8),b.Kc(14,"Assigned To"),b.Tb(),b.Ub(15,"th",9),b.Kc(16,"Number"),b.Tb(),b.Ub(17,"th",10),b.Kc(18,"Last Updated"),b.Tb(),b.Tb(),b.Tb(),b.Ub(19,"tbody"),b.Ic(20,L,25,19,"tr",11),b.gc(21,"async"),b.Tb(),b.Tb(),b.lc(22),b.Pb(23,"datatable-footer"),b.Tb()),2&t&&(b.nc("ngIf",b.hc(1,2,e.datatable.paginator.loading$)),b.Bb(20),b.nc("ngForOf",b.hc(21,4,e.tickets$)))},directives:[i.t,I.a,C.a,w.a,i.s,B.a,P.a,_.a,M.d,M.a],pipes:[i.b],styles:["[_nghost-%COMP%]{display:block;overflow:auto;height:100%;position:relative}[_nghost-%COMP%]     .no-results-message{padding:65px 0}mat-progress-bar[_ngcontent-%COMP%]{position:absolute;top:0;left:0}.table-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background-color:var(--be-background-alternative)}table[_ngcontent-%COMP%]{table-layout:fixed}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{height:70px;cursor:pointer}tbody[_ngcontent-%COMP%]   tr.open[_ngcontent-%COMP%]   .customer-column[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr.open[_ngcontent-%COMP%]   .last-updated-column[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr.open[_ngcontent-%COMP%]   .number-column[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr.open[_ngcontent-%COMP%]   .title-text[_ngcontent-%COMP%]{font-weight:500;color:var(--be-text)}tbody[_ngcontent-%COMP%]   tr.not-closed[_ngcontent-%COMP%]{background-color:var(--be-background)}tbody[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%], tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover:not(.selected){background-color:var(--be-accent-emphasis)}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{height:35px;background-color:var(--be-background)}.table-checkbox[_ngcontent-%COMP%]{width:75px}.customer-column[_ngcontent-%COMP%]{width:130px;font-weight:500;color:var(--be-secondary-text)}.avatar-column[_ngcontent-%COMP%]{width:110px}.avatar-column[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:38px;height:38px;box-shadow:0 0 0 1px #fff,0 0 1px 2px #aaaeb7;border-radius:50%;margin:0 auto}.replies-count-column[_ngcontent-%COMP%]{width:50px;text-align:center}.number-column[_ngcontent-%COMP%]{width:90px;padding-right:10px}.assigned-to-column[_ngcontent-%COMP%], .last-updated-column[_ngcontent-%COMP%]{width:125px}.column-text-content[_ngcontent-%COMP%]{max-width:85%;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.replies-count-number[_ngcontent-%COMP%]{background-color:var(--be-background-alternative);color:var(--be-secondary-text);border-radius:4px;padding:1px 6px 0;font-size:1.1rem;border:1px solid var(--be-divider-default)}.summary-column[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.summary-column[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center}.summary-column[_ngcontent-%COMP%]   .ticket-body[_ngcontent-%COMP%]{color:var(--be-secondary-text);max-width:98%;overflow:hidden;text-overflow:ellipsis;padding-top:5px}.ticket-tags[_ngcontent-%COMP%]{margin-right:7px}.ticket-tag[_ngcontent-%COMP%]{pointer-events:none}datatable-footer[_ngcontent-%COMP%]{height:45px;background-color:var(--be-background);border-top:1px solid var(--be-divider-default);margin-top:auto}datatable-footer[_ngcontent-%COMP%]     .page-size-input{height:25px;padding-top:0;padding-bottom:0}"]}),t})();var A=a("74SX"),z=a("NFeN"),V=a("i2dy"),R=a("twBr"),E=a("2qZP"),Q=a("Qu3c"),q=a("STbY"),D=a("EzZJ"),N=a("zW5C");function G(t,e){if(1&t){const t=b.Vb();b.Ub(0,"button",10),b.bc("click",(function(){b.zc(t);const a=e.$implicit;return b.fc(2).setStatusForSelectedTickets(a)})),b.Kc(1),b.Tb()}if(2&t){const t=e.$implicit;b.nc("ngClass",t.name),b.Bb(1),b.Mc(" ",t.display_name||t.name," ")}}function H(t,e){if(1&t){const t=b.Vb();b.Sb(0),b.Ub(1,"assign-ticket-dropdown",1),b.bc("assigned",(function(){return b.zc(t),b.fc().ticketsUpdated()})),b.gc(2,"async"),b.gc(3,"trans"),b.Tb(),b.Ub(4,"button",2),b.Pb(5,"mat-icon",3),b.Tb(),b.Ub(6,"mat-menu",4,5),b.Ic(8,G,2,2,"button",6),b.Tb(),b.Ub(9,"add-tag-dropdown",7),b.bc("tagAdded",(function(){return b.zc(t),b.fc().ticketsUpdated()})),b.gc(10,"async"),b.gc(11,"trans"),b.Tb(),b.Ub(12,"button",8),b.bc("click",(function(){return b.zc(t),b.fc().maybeDeleteSelectedTickets()})),b.gc(13,"trans"),b.Pb(14,"mat-icon",9),b.Tb(),b.Rb()}if(2&t){const t=b.wc(7),e=b.fc();b.Bb(1),b.nc("ticketIds",b.hc(2,8,e.datatable.selectedRows$))("matTooltip",b.hc(3,10,"Assign")),b.Bb(3),b.nc("matMenuTriggerFor",t),b.Bb(2),b.nc("overlapTrigger",!1),b.Bb(2),b.nc("ngForOf",e.mailboxTags.statusTags),b.Bb(1),b.nc("ticketIds",b.hc(10,12,e.datatable.selectedRows$))("matTooltip",b.hc(11,14,"Add Tag")),b.Bb(3),b.nc("matTooltip",b.hc(13,16,"Delete"))}}const J=function(){return["tickets.update","replies.create"]};let X=(()=>{class t{constructor(t,e,a,i,n){this.tickets=t,this.mailboxTags=e,this.toast=a,this.currentUser=i,this.datatable=n,this.onTicketsUpdated=new b.n}get noTicketsSelected(){return!this.datatable.selectedRows$.value.length}setStatusForSelectedTickets(t){this.tickets.changeMultipleTicketsStatus(this.datatable.selectedRows$.value,t).subscribe(()=>{this.ticketsUpdated()})}maybeDeleteSelectedTickets(){this.datatable.confirmResourceDeletion("tickets").subscribe(()=>{this.tickets.deleteMultiple(this.datatable.selectedRows$.value).subscribe(()=>{this.ticketsUpdated(),this.toast.open("Tickets deleted")})})}ticketsUpdated(){this.onTicketsUpdated.emit(),this.mailboxTags.refresh(),this.datatable.reset()}}return t.\u0275fac=function(e){return new(e||t)(b.Ob(k.a),b.Ob(d.a),b.Ob(V.b),b.Ob(R.a),b.Ob(O.a))},t.\u0275cmp=b.Ib({type:t,selectors:[["ticket-floating-toolbar"]],hostVars:2,hostBindings:function(t,e){2&t&&b.Fb("hidden",e.noTicketsSelected)},outputs:{onTicketsUpdated:"onTicketsUpdated"},decls:1,vars:2,consts:[[4,"ngIf"],[3,"ticketIds","matTooltip","assigned"],[1,"toolbar-item","no-style",3,"matMenuTriggerFor"],["svgIcon","flag-custom"],[1,"status-menu",3,"overlapTrigger"],["ticketStatusMenu","matMenu"],["mat-menu-item","",3,"ngClass","click",4,"ngFor","ngForOf"],[3,"ticketIds","matTooltip","tagAdded"],[1,"no-style","toolbar-item","delete-tickets-button","last",3,"matTooltip","click"],["svgIcon","delete-custom"],["mat-menu-item","",3,"ngClass","click"]],template:function(t,e){1&t&&b.Ic(0,H,15,18,"ng-container",0),2&t&&b.nc("ngIf",e.currentUser.hasPermissions(b.rc(1,J)))},directives:[i.t,E.a,Q.a,q.d,z.a,q.e,i.s,D.a,q.b,i.q],pipes:[i.b,N.a],styles:["ticket-floating-toolbar{display:flex;position:fixed;top:78px;background-color:var(--be-background);left:calc(50% - 117.5px);min-width:235px;box-shadow:0 3px 3px -2px rgba(0,0,0,.2),0 3px 4px 0 rgba(0,0,0,.14),0 1px 8px 0 rgba(0,0,0,.12);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:10;white-space:nowrap}ticket-floating-toolbar .toolbar-item{position:relative;cursor:pointer;transition:all .2s ease-in-out;padding:15px;border-right:1px solid var(--be-divider-default);line-height:inherit}ticket-floating-toolbar .toolbar-item.last{border-bottom:none}ticket-floating-toolbar .toolbar-item:hover{background-color:var(--be-accent-emphasis)}ticket-floating-toolbar .toolbar-item .mat-icon{color:var(--be-help-center-title-text);vertical-align:bottom;width:28px;height:28px}ticket-floating-toolbar .toolbar-item .status-tag{text-transform:capitalize}"],encapsulation:2}),t})();var Y=a("CH4Q");function Z(t,e){1&t&&(b.Ub(0,"no-results-message"),b.Ub(1,"span",21),b.Kc(2,"Nothing To Display."),b.Tb(),b.Ub(3,"span",22),b.Kc(4,"Could not find any tickets matching this search query."),b.Tb(),b.Tb())}const W=function(t){return["/mailbox/users",t]};function tt(t,e){if(1&t&&(b.Ub(0,"a",23),b.Pb(1,"img",24),b.Ub(2,"div",25),b.Ub(3,"div",26),b.Kc(4),b.Tb(),b.Ub(5,"div",27),b.Kc(6),b.Tb(),b.Tb(),b.Tb()),2&t){const t=e.$implicit;b.nc("routerLink",b.sc(4,W,t.id)),b.Bb(1),b.oc("src",t.avatar,b.Cc),b.Bb(3),b.Lc(t.display_name),b.Bb(2),b.Lc(t.email)}}function et(t,e){if(1&t&&(b.Ub(0,"a",28),b.Pb(1,"mat-icon",29),b.Ub(2,"div",30),b.Ub(3,"div",26),b.Kc(4),b.Tb(),b.Ub(5,"div",27),b.Kc(6),b.Tb(),b.Tb(),b.Tb()),2&t){const t=e.$implicit,a=b.fc();b.nc("routerLink",a.urls.article(t)),b.Bb(4),b.Lc(t.title),b.Bb(2),b.Lc(t.body)}}let at=(()=>{class t{constructor(t,e,a,i,s){this.dialogRef=t,this.data=e,this.tickets=a,this.urls=i,this.datatable=s,this.results={},this.isSearching=!1,this.searchedOnce=!1,this.activeTab="tickets",this.searchQueryControl=new n.i,this.hydrate()}ngOnInit(){this.datatable.paginator.dontUpdateQueryParams=!0}ngOnDestroy(){this.datatable.destroy()}close(){this.dialogRef.close()}hydrate(){this.bindToSearchInput(),this.searchQueryControl.setValue(this.data.query)}setActiveTab(t){this.activeTab=t}activeTabIs(t){return this.activeTab===t}performSearch(t){this.isSearching=!0,this.tickets.search(t,this.getSearchQueryParams()).pipe(Object(T.a)(()=>{this.searchedOnce=!0,this.isSearching=!1})).subscribe(t=>{this.datatable.config?(this.datatable.paginator.response$.next({pagination:t.results.tickets}),this.datatable.config.staticParams=this.getSearchQueryParams()):this.datatable.init({uri:"search/tickets",staticParams:this.getSearchQueryParams(),initialData:t.results.tickets}),this.results=t.results})}bindToSearchInput(){this.searchQueryControl.valueChanges.pipe(Object(h.a)(400),Object(l.a)()).subscribe(t=>this.performSearch(t))}getSearchQueryParams(){return{query:this.searchQueryControl.value,perPage:20,detailed:!0}}}return t.\u0275fac=function(e){return new(e||t)(b.Ob(x.h),b.Ob(x.a),b.Ob(k.a),b.Ob(A.a),b.Ob(O.a))},t.\u0275cmp=b.Ib({type:t,selectors:[["agent-search-modal"]],viewQuery:function(t,e){var a;1&t&&b.Gc(j,!0),2&t&&b.vc(a=b.cc())&&(e.ticketsList=a.first)},features:[b.Ab([O.a])],decls:33,vars:24,consts:[[1,"modal-header"],["mat-dialog-title","","trans","",1,"modal-title"],["type","button","tabindex","-1",1,"close-button","no-style",3,"click"],["svgIcon","close"],[1,"input-container","search-input"],["type","text","placeholder","Find tickets, articles and users...","trans-placeholder","",3,"formControl"],[1,"search-results"],[1,"tab-menu"],[1,"tab-menu-item","tickets-menu-item",3,"click"],["trans",""],[1,"tab-menu-item","users-menu-item",3,"click"],[1,"tab-menu-item","articles-menu-item",3,"click"],[1,"tabs"],[1,"tab","tickets-tab"],[3,"openTicketInModal"],[4,"ngIf"],[1,"tab","users-tab"],["class","user",3,"routerLink",4,"ngFor","ngForOf"],[1,"tab","articles-tab"],[1,"articles-list"],["class","article",3,"routerLink",4,"ngFor","ngForOf"],["primary-text","","trans",""],["secondary-text","","trans",""],[1,"user",3,"routerLink"],["alt","customer avatar",1,"avatar",3,"src"],[1,"text"],[1,"title"],[1,"body"],[1,"article",3,"routerLink"],["svgIcon","description"],[1,"article-info"]],template:function(t,e){var a;1&t&&(b.Ub(0,"div",0),b.Ub(1,"h2",1),b.Kc(2,"Search"),b.Tb(),b.Ub(3,"button",2),b.bc("click",(function(){return e.close()})),b.Pb(4,"mat-icon",3),b.Tb(),b.Tb(),b.Ub(5,"mat-dialog-content"),b.Ub(6,"div",4),b.Pb(7,"input",5),b.Tb(),b.Ub(8,"div",6),b.Ub(9,"div",7),b.Ub(10,"div",8),b.bc("click",(function(){return e.setActiveTab("tickets")})),b.Kc(11),b.gc(12,"async"),b.Ub(13,"span",9),b.Kc(14,"Tickets"),b.Tb(),b.Tb(),b.Ub(15,"div",10),b.bc("click",(function(){return e.setActiveTab("users")})),b.Kc(16),b.Ub(17,"span",9),b.Kc(18,"Users"),b.Tb(),b.Tb(),b.Ub(19,"div",11),b.bc("click",(function(){return e.setActiveTab("articles")})),b.Kc(20),b.Ub(21,"span",9),b.Kc(22,"Articles"),b.Tb(),b.Tb(),b.Tb(),b.Ub(23,"div",12),b.Ub(24,"div",13),b.Ub(25,"tickets-list",14),b.Ic(26,Z,5,0,"no-results-message",15),b.Tb(),b.Pb(27,"ticket-floating-toolbar"),b.Tb(),b.Ub(28,"div",16),b.Ic(29,tt,7,6,"a",17),b.Tb(),b.Ub(30,"div",18),b.Ub(31,"div",19),b.Ic(32,et,7,3,"a",20),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb()),2&t&&(b.Bb(7),b.nc("formControl",e.searchQueryControl),b.Bb(2),b.Fb("visually-hidden",!e.searchedOnce),b.Bb(1),b.Fb("active",e.activeTabIs("tickets")),b.Bb(1),b.Mc("",null==(a=b.hc(12,22,e.datatable.paginator.response$))||null==a.pagination?null:a.pagination.total," "),b.Bb(4),b.Fb("active",e.activeTabIs("users")),b.Bb(1),b.Mc("",null==e.results.users?null:e.results.users.total," "),b.Bb(3),b.Fb("active",e.activeTabIs("articles")),b.Bb(1),b.Mc("",null==e.results.articles?null:e.results.articles.total," "),b.Bb(4),b.Fb("hidden",!e.activeTabIs("tickets")),b.Bb(1),b.nc("openTicketInModal",!0),b.Bb(1),b.nc("ngIf",!(null!=e.results.tickets&&null!=e.results.tickets.data&&e.results.tickets.data.length||e.isSearching)),b.Bb(2),b.Fb("hidden",!e.activeTabIs("users")),b.Bb(1),b.nc("ngForOf",null==e.results.users?null:e.results.users.data),b.Bb(1),b.Fb("hidden",!e.activeTabIs("articles")),b.Bb(2),b.nc("ngForOf",null==e.results.articles?null:e.results.articles.data))},directives:[x.i,w.a,z.a,x.f,n.d,n.u,n.j,j,i.t,X,i.s,Y.a,s.i],pipes:[i.b],styles:[".agent-search-modal-container{height:100%;width:100%;max-width:none!important}.agent-search-modal-container .mat-dialog-container{border-radius:0}.agent-search-modal-container .mat-dialog-content{max-height:none;min-height:100%}.agent-search-modal-container .modal-header{margin-bottom:5px}.agent-search-modal-container h2{font-size:2.4rem;font-weight:400}.agent-search-modal-container .search-results{border:1px solid var(--be-divider-default);border-radius:4px;background-color:var(--be-background);min-height:calc(100% - 75px)}.agent-search-modal-container .search-results .tab-menu{display:flex;border-bottom:1px solid var(--be-divider-default)}.agent-search-modal-container .search-results .tab-menu .tab-menu-item{padding:15px;border-bottom:2px solid transparent;cursor:pointer}.agent-search-modal-container .search-results .tab-menu .tab-menu-item.active{border-color:var(--be-accent-default)}.agent-search-modal-container .search-results .tabs{border:1px solid var(--be-divider-default);margin:15px}.agent-search-modal-container .search-results .tabs .tab{min-height:50px}.agent-search-modal-container .search-results .tabs .users-tab{padding:8px}.agent-search-modal-container .search-results .tabs .users-tab .user{display:inline-flex;width:300px;height:80px;border:1px solid var(--be-divider-default);padding:15px;margin:8px;color:var(--be-text)}.agent-search-modal-container .search-results .tabs .users-tab .user:hover{background-color:var(--be-accent-emphasis)}.agent-search-modal-container .search-results .tabs .users-tab .user img{margin-right:10px;width:50px;height:50px;-o-object-fit:cover;object-fit:cover}.agent-search-modal-container .search-results .tabs .users-tab .user .text{padding-top:6px}.agent-search-modal-container .search-results .tabs .users-tab .user .text .title{font-size:1.5rem}.agent-search-modal-container .search-results .tabs .users-tab .user .text .body{color:var(--be-secondary-text)}.agent-search-modal-container .search-results .tabs .articles-list .article{display:flex;padding:13px;border-bottom:1px solid var(--be-divider-default);color:var(--be-text)}.agent-search-modal-container .search-results .tabs .articles-list .article:last-of-type{border-bottom:none}.agent-search-modal-container .search-results .tabs .articles-list .article:hover{background-color:var(--be-accent-emphasis)}.agent-search-modal-container .search-results .tabs .articles-list .article .mat-icon{width:35px;height:35px;color:var(--be-secondary-text);margin-right:5px}.agent-search-modal-container .search-results .tabs .articles-list .article .article-info .title{font-size:1.6rem}.agent-search-modal-container .search-results .tabs .articles-list .article .article-info .body{word-wrap:break-word;color:var(--be-secondary-text)}.agent-search-modal-container .search-results .tabs tickets-list{background-color:transparent}.agent-search-modal-container .search-input{height:50px;margin-bottom:25px}.agent-search-modal-container .search-input input{height:100%;border-radius:4px}"],encapsulation:2}),t})();var it=a("LRne"),nt=a("/1cH"),st=a("bTqV"),rt=a("YdAL"),ot=a("FKr1");function ct(t,e){if(1&t){const t=b.Vb();b.Ub(0,"div",16),b.bc("click",(function(e){return b.zc(t),b.fc(2).setActiveCategory("tickets"),e.stopPropagation()})),b.Kc(1,"Conversations"),b.Tb()}if(2&t){const t=b.fc(2);b.Fb("active","tickets"===t.activeCategory)}}function lt(t,e){if(1&t){const t=b.Vb();b.Ub(0,"div",17),b.bc("click",(function(e){return b.zc(t),b.fc(2).setActiveCategory("users"),e.stopPropagation()})),b.Kc(1,"Users"),b.Tb()}if(2&t){const t=b.fc(2);b.Fb("active","users"===t.activeCategory)}}function bt(t,e){if(1&t){const t=b.Vb();b.Ub(0,"div",24),b.bc("click",(function(){b.zc(t);const e=b.fc().$implicit;return b.fc(3).navigateToUser(e.user.id)})),b.Kc(1),b.Tb()}if(2&t){const t=b.fc().$implicit;b.Bb(1),b.Lc(t.user.display_name)}}function dt(t,e){if(1&t){const t=b.Vb();b.Ub(0,"mat-option",20),b.bc("click",(function(){b.zc(t);const a=e.$implicit;return b.fc(3).navigateToTicket(a.id)})),b.Ub(1,"div",21),b.Kc(2),b.Tb(),b.Ub(3,"div",22),b.Kc(4),b.Tb(),b.Ic(5,bt,2,1,"div",23),b.Tb()}if(2&t){const t=e.$implicit;b.Bb(2),b.Lc(t.subject),b.Bb(2),b.Lc(t.latest_reply&&t.latest_reply.body),b.Bb(1),b.nc("ngIf",t.user)}}function ut(t,e){if(1&t&&(b.Ub(0,"div",18),b.Ic(1,dt,6,3,"mat-option",19),b.Tb()),2&t){const t=b.fc(2);b.Bb(1),b.nc("ngForOf",t.results.tickets.data)}}function pt(t,e){if(1&t){const t=b.Vb();b.Ub(0,"mat-option",27),b.bc("click",(function(){b.zc(t);const a=e.$implicit;return b.fc(3).navigateToUser(a.id)})),b.Pb(1,"img",28),b.Ub(2,"div",29),b.Ub(3,"div",21),b.Kc(4),b.Tb(),b.Ub(5,"div",22),b.Kc(6),b.Tb(),b.Tb(),b.Tb()}if(2&t){const t=e.$implicit;b.Bb(1),b.oc("src",t.avatar,b.Cc),b.Bb(3),b.Lc(t.email),b.Bb(2),b.Lc(t.display_name)}}function mt(t,e){if(1&t&&(b.Ub(0,"div",25),b.Ic(1,pt,7,3,"mat-option",26),b.Tb()),2&t){const t=b.fc(2);b.Bb(1),b.nc("ngForOf",t.results.users.data)}}function gt(t,e){if(1&t){const t=b.Vb();b.Ub(0,"div",30),b.bc("click",(function(){return b.zc(t),b.fc(2).openSearchModal()})),b.Ub(1,"span",31),b.Kc(2,"View All Results"),b.Tb(),b.Tb()}}function ht(t,e){if(1&t&&(b.Ub(0,"div",9),b.Ub(1,"div",10),b.Ic(2,ct,2,2,"div",11),b.Ic(3,lt,2,2,"div",12),b.Tb(),b.Ic(4,ut,2,1,"div",13),b.Ic(5,mt,2,1,"div",14),b.Ic(6,gt,3,0,"div",15),b.Tb()),2&t){const t=b.fc();b.Bb(2),b.nc("ngIf",t.results.tickets.data.length),b.Bb(1),b.nc("ngIf",t.results.users.data.length),b.Bb(1),b.nc("ngIf","tickets"===t.activeCategory),b.Bb(1),b.nc("ngIf","users"===t.activeCategory),b.Bb(1),b.nc("ngIf",t.searchQuery.value)}}function ft(t,e){1&t&&(b.Ub(0,"div",32),b.Kc(1," No tickets or users matching your search query were found. "),b.Tb())}const vt={data:{tickets:{},users:{},articles:{}}};let kt=(()=>{class t{constructor(t,e,a){this.tickets=t,this.router=e,this.modal=a,this.searchQuery=new n.i,this.activeCategory="tickets",this.hasResults=!1,this.loadedResultsAtLeastOnce=!1,this.isLoading=!1,this.results={tickets:{data:[]},users:{data:[]}}}ngOnInit(){this.bindToQueryChangeEvent()}setActiveCategory(t){this.activeCategory=t}navigateToTicket(t){this.reset(),this.router.navigate(["/mailbox/tickets",t])}navigateToUser(t){this.reset(),this.router.navigate(["/mailbox/users",t])}openSearchModal(){if(!this.searchQuery.value)return;const t=this.searchQuery.value;this.reset(),this.modal.open(at,{query:t},{panelClass:"agent-search-modal-container"})}search(t=null){return t?(this.isLoading=!0,this.tickets.search(t,{query:t}).pipe(Object(g.a)(t=>{this.hasResults=!(!t.results.tickets.total&&!t.results.users.total),this.loadedResultsAtLeastOnce=!0,this.results=t.results,this.isLoading=!1,this.setActiveCategory(t.results.tickets.total?"tickets":"users")}))):Object(it.a)(vt)}reset(){this.searchQuery.setValue(null),this.hasResults=!1,this.results=null,this.activeCategory="tickets",this.loadedResultsAtLeastOnce=!1}bindToQueryChangeEvent(){this.searchQuery.valueChanges.pipe(Object(h.a)(250),Object(l.a)(),Object(f.a)(t=>this.search(t)),Object(v.a)(()=>Object(it.a)(vt))).subscribe()}}return t.\u0275fac=function(e){return new(e||t)(b.Ob(k.a),b.Ob(s.f),b.Ob(U.a))},t.\u0275cmp=b.Ib({type:t,selectors:[["ticket-search-dropdown"]],features:[b.Ab([k.a])],decls:9,vars:4,consts:[[1,"input-container",3,"ngSubmit"],["type","text","placeholder","Search...","trans-placeholder","",1,"search-input",3,"matAutocomplete","formControl"],["input",""],["mat-icon-button","",1,"search-button"],["svgIcon","search"],["customScrollbar","",1,"agent-mailbox-autocomplete"],["auto","matAutocomplete"],["class","results-container",4,"ngIf"],["class","no-results","trans","",4,"ngIf"],[1,"results-container"],[1,"header"],["class","header-item tickets-item","trans","",3,"active","click",4,"ngIf"],["class","header-item users-item","trans","",3,"active","click",4,"ngIf"],["class","results-panel tickets-panel",4,"ngIf"],["class","results-panel users-panel",4,"ngIf"],["class","footer",3,"click",4,"ngIf"],["trans","",1,"header-item","tickets-item",3,"click"],["trans","",1,"header-item","users-item",3,"click"],[1,"results-panel","tickets-panel"],["class","result",3,"click",4,"ngFor","ngForOf"],[1,"result",3,"click"],[1,"title"],[1,"body"],["class","user",3,"click",4,"ngIf"],[1,"user",3,"click"],[1,"results-panel","users-panel"],["class","result media",3,"click",4,"ngFor","ngForOf"],[1,"result","media",3,"click"],["alt","customer avatar",1,"avatar",3,"src"],[1,"text"],[1,"footer",3,"click"],["trans",""],["trans","",1,"no-results"]],template:function(t,e){if(1&t&&(b.Ub(0,"form",0),b.bc("ngSubmit",(function(){return e.openSearchModal()})),b.Pb(1,"input",1,2),b.Ub(3,"button",3),b.Pb(4,"mat-icon",4),b.Tb(),b.Tb(),b.Ub(5,"mat-autocomplete",5,6),b.Ic(7,ht,7,5,"div",7),b.Ic(8,ft,2,0,"div",8),b.Tb()),2&t){const t=b.wc(6);b.Bb(1),b.nc("matAutocomplete",t)("formControl",e.searchQuery),b.Bb(6),b.nc("ngIf",e.results),b.Bb(1),b.nc("ngIf",e.searchQuery.value&&!e.isLoading&&!e.hasResults&&e.loadedResultsAtLeastOnce)}},directives:[n.K,n.v,n.w,nt.c,n.d,w.a,n.u,n.j,st.b,z.a,nt.a,rt.a,i.t,i.s,ot.l],styles:["ticket-search-dropdown{display:block;position:relative;max-width:700px;width:100%}ticket-search-dropdown .input-container{position:relative}ticket-search-dropdown .input-container .search-button{position:absolute;top:2px;left:0;z-index:1}ticket-search-dropdown .input-container input{padding-left:36px}ticket-search-dropdown .input-container input::-moz-placeholder{color:var(--be-accent-contrast)}ticket-search-dropdown .input-container input:-ms-input-placeholder{color:var(--be-accent-contrast)}ticket-search-dropdown .input-container input::-ms-input-placeholder{color:var(--be-accent-contrast)}ticket-search-dropdown .input-container input::placeholder{color:var(--be-accent-contrast)}.agent-mailbox-autocomplete.mat-autocomplete-panel{max-height:750px;background-color:var(--be-background)}.agent-mailbox-autocomplete.mat-autocomplete-panel .header{display:flex;background-color:var(--be-background-alternative)}.agent-mailbox-autocomplete.mat-autocomplete-panel .header .header-item{width:50%;flex:0 0 50%;padding:12px;border-bottom:2px solid var(--be-divider-default);cursor:pointer}.agent-mailbox-autocomplete.mat-autocomplete-panel .header .header-item.active{border-color:var(--be-accent-default)}.agent-mailbox-autocomplete.mat-autocomplete-panel .no-results{font-size:1.5rem;text-align:center;width:100%;padding:10px}.agent-mailbox-autocomplete.mat-autocomplete-panel .footer{background-color:var(--be-background-alternative);text-align:center;padding:10px;cursor:pointer}.agent-mailbox-autocomplete.mat-autocomplete-panel .result{border-bottom:1px solid var(--be-divider-default);padding:10px 15px;height:auto;line-height:normal;font-size:1.4rem}.agent-mailbox-autocomplete.mat-autocomplete-panel .result:hover{background-color:var(--be-background-alternative)}.agent-mailbox-autocomplete.mat-autocomplete-panel .title{font-weight:500;color:var(--be-text);overflow:hidden}.agent-mailbox-autocomplete.mat-autocomplete-panel .body{color:var(--be-secondary-text);font-size:1.3rem;word-wrap:break-word;white-space:-webkit-pre-wrap;word-break:break-all;white-space:normal}.agent-mailbox-autocomplete.mat-autocomplete-panel .user{margin-top:5px;font-size:1.25rem;font-weight:500;color:var(--be-secondary-text)}.agent-mailbox-autocomplete.mat-autocomplete-panel .media .mat-option-text{display:flex;align-items:center}.agent-mailbox-autocomplete.mat-autocomplete-panel .media .mat-option-text img{margin-right:10px;width:50px;height:50px;-o-object-fit:cover;object-fit:cover}"],encapsulation:2}),t})();var Tt=a("XhcP"),xt=a("JxJJ");const yt=function(){return["/mailbox/tickets"]},Ut=function(t){return{tagId:t}};function Ot(t,e){if(1&t&&(b.Ub(0,"div",18),b.Ub(1,"a",19),b.gc(2,"async"),b.Ub(3,"span",20),b.Kc(4),b.gc(5,"trans"),b.Tb(),b.Ub(6,"span",21),b.Kc(7),b.Tb(),b.Tb(),b.Tb()),2&t){const t=e.$implicit,a=b.fc();b.nc("@fadeIn",void 0),b.Bb(1),b.Fb("router-link-active",b.hc(2,10,a.mailboxTags.activeTagId$)==t.id),b.nc("routerLink",b.rc(14,yt))("queryParams",b.sc(15,Ut,t.id))("ngClass",t.name),b.Bb(3),b.Lc(b.hc(5,12,t.display_name)),b.Bb(2),b.Fb("hidden",!t.tickets_count),b.Bb(1),b.Lc(t.tickets_count)}}function It(t,e){1&t&&(b.Ub(0,"div",24),b.Pb(1,"skeleton"),b.Tb())}const Ct=function(){return[1,2,3,4]};function wt(t,e){1&t&&(b.Ub(0,"div",22),b.Ic(1,It,2,0,"div",23),b.Tb()),2&t&&(b.nc("@fadeOut",void 0),b.Bb(1),b.nc("ngForOf",b.rc(2,Ct)))}function Bt(t,e){if(1&t&&(b.Ub(0,"div",25),b.Ub(1,"a",26),b.gc(2,"async"),b.Ub(3,"span",20),b.Kc(4),b.Tb(),b.Ub(5,"span",21),b.Kc(6),b.Tb(),b.Tb(),b.Tb()),2&t){const t=e.$implicit,a=b.fc();b.nc("@fadeIn",void 0),b.Bb(1),b.Fb("router-link-active",b.hc(2,9,a.mailboxTags.activeTagId$)==t.id),b.nc("routerLink",b.rc(11,yt))("queryParams",b.sc(12,Ut,t.id)),b.Bb(3),b.Lc(t.display_name),b.Bb(1),b.Fb("hidden",!t.tickets_count),b.Bb(1),b.Lc(t.tickets_count)}}function Pt(t,e){1&t&&(b.Ub(0,"div",24),b.Pb(1,"skeleton"),b.Tb())}function _t(t,e){1&t&&(b.Ub(0,"div",22),b.Ic(1,Pt,2,0,"div",23),b.Tb()),2&t&&(b.nc("@fadeOut",void 0),b.Bb(1),b.nc("ngForOf",b.rc(2,Ct)))}let Mt=(()=>{class t{constructor(t,e,a,i){this.mailboxTags=t,this.route=e,this.i18n=a,this.breakpoints=i,this.leftColumnIsHidden=!1,this.trackByFn=(t,e)=>e.id}ngOnInit(){this.leftColumnIsHidden=this.breakpoints.isMobile$.value,this.route.queryParams.pipe(Object(c.a)(t=>t.tagId),Object(l.a)()).subscribe(t=>{this.mailboxTags.setActiveTag(t)})}toggleLeftSidebar(){this.leftColumnIsHidden=!this.leftColumnIsHidden}}return t.\u0275fac=function(e){return new(e||t)(b.Ob(d.a),b.Ob(s.a),b.Ob(u.a),b.Ob(p.a))},t.\u0275cmp=b.Ib({type:t,selectors:[["mailbox"]],decls:31,vars:25,consts:[["menuPosition","agent-mailbox","color","accent",1,"box-shadow",3,"showToggleButton","hideToggleBtnOnDesktop","toggleButtonClick"],[1,"nav-searchbar"],[1,"mailbox-container"],[1,"left-column",3,"opened","mode","fixedInViewport","fixedTopGap"],[1,"aside-container","status-tags"],[1,"aside-container-title"],["svgIcon","inbox-custom",1,"title-icon"],["trans","",1,"aside-container-name"],[1,"aside-container-body"],["class","status-tag",4,"ngFor","ngForOf","ngForTrackBy"],["class","skeletons-container",4,"ngIf"],[1,"aside-container","category-tags"],["svgIcon","box-filled-custom",1,"title-icon"],["class","category-tag",4,"ngFor","ngForOf","ngForTrackBy"],[1,"bottom-action-container"],["mat-icon-button","","routerLink","/mailbox/tickets/new",3,"matTooltip"],["svgIcon","new-ticket-custom"],[1,"right-column"],[1,"status-tag"],[1,"aside-nav-item",3,"routerLink","queryParams","ngClass"],[1,"tag-name"],[1,"label","tickets-count"],[1,"skeletons-container"],["class","aside-nav-item",4,"ngFor","ngForOf"],[1,"aside-nav-item"],[1,"category-tag"],[1,"aside-nav-item",3,"routerLink","queryParams"]],template:function(t,e){1&t&&(b.Ub(0,"material-navbar",0),b.bc("toggleButtonClick",(function(){return e.toggleLeftSidebar()})),b.Pb(1,"ticket-search-dropdown",1),b.Tb(),b.Ub(2,"mat-sidenav-container",2),b.Ub(3,"mat-sidenav",3),b.gc(4,"async"),b.Ub(5,"section",4),b.Ub(6,"div",5),b.Pb(7,"mat-icon",6),b.Ub(8,"span",7),b.Kc(9,"Inbox"),b.Tb(),b.Tb(),b.Ub(10,"div",8),b.Ic(11,Ot,8,17,"div",9),b.Ic(12,wt,2,3,"div",10),b.gc(13,"async"),b.gc(14,"async"),b.Tb(),b.Tb(),b.Ub(15,"section",11),b.Ub(16,"div",5),b.Pb(17,"mat-icon",12),b.Ub(18,"span",7),b.Kc(19,"Folders"),b.Tb(),b.Tb(),b.Ub(20,"div",8),b.Ic(21,Bt,7,14,"div",13),b.Ic(22,_t,2,3,"div",10),b.gc(23,"async"),b.gc(24,"async"),b.Tb(),b.Tb(),b.Ub(25,"div",14),b.Ub(26,"a",15),b.gc(27,"trans"),b.Pb(28,"mat-icon",16),b.Tb(),b.Tb(),b.Tb(),b.Ub(29,"mat-sidenav-content",17),b.Pb(30,"router-outlet"),b.Tb(),b.Tb()),2&t&&(b.nc("showToggleButton",!0)("hideToggleBtnOnDesktop",!0),b.Bb(3),b.nc("opened",!e.leftColumnIsHidden)("mode",b.hc(4,13,e.breakpoints.isMobile$)?"over":"side")("fixedInViewport",!0)("fixedTopGap",70),b.Bb(8),b.nc("ngForOf",e.mailboxTags.viewTags)("ngForTrackBy",e.trackByFn),b.Bb(1),b.nc("ngIf",!b.hc(13,15,e.mailboxTags.allTags$).length&&b.hc(14,17,e.mailboxTags.loading$)),b.Bb(9),b.nc("ngForOf",e.mailboxTags.categoryTags)("ngForTrackBy",e.trackByFn),b.Bb(1),b.nc("ngIf",!b.hc(23,19,e.mailboxTags.allTags$).length&&b.hc(24,21,e.mailboxTags.loading$)),b.Bb(4),b.nc("matTooltip",b.hc(27,23,"Create new ticket")))},directives:[m.a,kt,Tt.b,Tt.a,z.a,w.a,i.s,i.t,st.a,s.i,Q.a,Tt.c,s.k,i.q,xt.a],pipes:[i.b,N.a],styles:["[_nghost-%COMP%]{display:block;position:relative;max-height:100vh;overflow:hidden}material-navbar[_ngcontent-%COMP%]{height:70px}.left-column[_ngcontent-%COMP%]{width:225px;background-color:var(--be-background-alternative);border-right:1px solid var(--be-divider-default)}.aside-container[_ngcontent-%COMP%]{list-style:none;padding-left:0}skeleton[_ngcontent-%COMP%]{max-width:77%}.aside-container-body[_ngcontent-%COMP%]{position:relative;min-height:160px}.skeletons-container[_ngcontent-%COMP%]{position:absolute;top:0;width:100%}.aside-container-title[_ngcontent-%COMP%]{position:relative;padding:20px 15px 15px;text-transform:uppercase;letter-spacing:.03em;color:var(--be-secondary-text);font-weight:500;white-space:nowrap;overflow:hidden}.aside-container-title[_ngcontent-%COMP%]   .title-icon[_ngcontent-%COMP%]{position:absolute;top:17px}.aside-container-title[_ngcontent-%COMP%]   .aside-container-name[_ngcontent-%COMP%]{padding-left:30px}.aside-nav-item[_ngcontent-%COMP%]{display:block;position:relative;padding:10px 0 10px 41px;cursor:pointer;clear:both;text-transform:capitalize;color:#858b94;text-decoration:none;width:100%;border-left:3px solid transparent}.aside-nav-item[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{font-size:1.1rem;text-transform:none;position:absolute;top:12px;right:5px;border-radius:20px;padding:1px 10px;line-height:15px}.aside-nav-item[_ngcontent-%COMP%]   .tag-name[_ngcontent-%COMP%]{display:block;max-width:80%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.aside-nav-item.router-link-active[_ngcontent-%COMP%]{background-color:var(--be-accent-emphasis);border-left-color:var(--be-accent-default)}.aside-nav-item.router-link-active[_ngcontent-%COMP%]   .label[_ngcontent-%COMP%]{background-color:var(--be-accent-default);color:var(--be-accent-contrast)}.aside-nav-item[_ngcontent-%COMP%]:hover{background-color:var(--be-hover)}.be-dark-mode[_nghost-%COMP%]   .aside-nav-item[_ngcontent-%COMP%], .be-dark-mode   [_nghost-%COMP%]   .aside-nav-item[_ngcontent-%COMP%]{color:var(--be-secondary-text)}.right-column[_ngcontent-%COMP%]{background-color:var(--be-background)}conversation[_ngcontent-%COMP%]{margin-bottom:15px}.bottom-action-container[_ngcontent-%COMP%]{position:absolute;bottom:5px;left:5px;color:var(--be-secondary-text)}"],data:{animation:o}}),t})();var Ft=a("9C01");function Kt(t,e){1&t&&(b.Ub(0,"no-results-message",1),b.Ub(1,"span",2),b.Kc(2,"There are no tickets in this category yet."),b.Tb(),b.Tb())}let $t=(()=>{class t{constructor(t,e,a,i,n,s){this.mailboxTags=t,this.router=e,this.modal=a,this.route=i,this.backendEvents=n,this.datatable=s,this.datatable.paginator.perPageCacheKey="agent-ticket-list-per-page"}ngOnInit(){this.datatable.init({uri:"tickets",staticParams:{tagId:this.mailboxTags.activeTagId$.value}}),this.mailboxSub=this.mailboxTags.activeTagId$.pipe(Object(l.a)()).subscribe(t=>{this.datatable.reset({tagId:t})}),this.bindToBackendEvents()}ngOnDestroy(){this.datatable.destroy(),this.mailboxSub.unsubscribe()}bindToBackendEvents(){this.backendEvents.ticketCreated.subscribe(t=>{t.tags&&t.tags.find(t=>t.id===this.mailboxTags.activeTagId$.value)&&(this.datatable.data.find(e=>e.id===t.id)||(t.animated=!0,this.datatable.data=[t,...this.datatable.data],this.mailboxTags.refresh()))})}}return t.\u0275fac=function(e){return new(e||t)(b.Ob(d.a),b.Ob(s.f),b.Ob(U.a),b.Ob(s.a),b.Ob(Ft.a),b.Ob(O.a))},t.\u0275cmp=b.Ib({type:t,selectors:[["agent-mailbox-ticket-list"]],features:[b.Ab([O.a])],decls:4,vars:3,consts:[["svgImage","opened.svg",4,"ngIf"],["svgImage","opened.svg"],["primary-text","","trans",""]],template:function(t,e){1&t&&(b.Ub(0,"tickets-list"),b.Ic(1,Kt,3,0,"no-results-message",0),b.gc(2,"async"),b.Tb(),b.Pb(3,"ticket-floating-toolbar")),2&t&&(b.Bb(1),b.nc("ngIf",b.hc(2,1,e.datatable.paginator.noResults$)))},directives:[j,i.t,X,Y.a,w.a],pipes:[i.b],styles:["agent-mailbox-ticket-list{display:block;height:calc(100vh - 70px)}"],encapsulation:2}),t})();var Lt=a("9VjZ"),St=a("Dbf7"),jt=a("/33f");class At{constructor(t={}){for(let e in t)this[e]=t[e]}}var zt=a("mWN8");function Vt(t,e){if(1&t&&(b.Ub(0,"div",11),b.Kc(1),b.Tb()),2&t){const t=b.fc();b.Bb(1),b.Lc(t.errors["emails.0"])}}let Rt=(()=>{class t{constructor(t,e,a){this.dialogRef=t,this.data=e,this.users=a,this.errors={}}close(t){this.dialogRef.close(t)}confirm(){this.users.addEmail(this.data.userId,{emails:[this.emailAddress]}).subscribe(()=>{this.close(this.emailAddress)},t=>this.errors=t.errors)}}return t.\u0275fac=function(e){return new(e||t)(b.Ob(x.h),b.Ob(x.a),b.Ob(zt.a))},t.\u0275cmp=b.Ib({type:t,selectors:[["email-address-modal"]],decls:15,vars:2,consts:[[1,"modal-header"],["mat-dialog-title","","trans",""],["type","button","mat-icon-button","","tabindex","-1",1,"close-button",3,"click"],["svgIcon","close"],["ngNativeValidate","","mat-dialog-content","",3,"ngSubmit"],[1,"input-container"],["for","email"],["type","email","name","email","id","email","required","",3,"ngModel","ngModelChange"],["class","error",4,"ngIf"],["type","button","mat-button","","trans","",1,"cancel-button",3,"click"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button"],[1,"error"]],template:function(t,e){1&t&&(b.Ub(0,"div",0),b.Ub(1,"h2",1),b.Kc(2,"Enter Email Address"),b.Tb(),b.Ub(3,"button",2),b.bc("click",(function(){return e.close()})),b.Pb(4,"mat-icon",3),b.Tb(),b.Tb(),b.Ub(5,"form",4),b.bc("ngSubmit",(function(){return e.confirm()})),b.Ub(6,"div",5),b.Pb(7,"label",6),b.Ub(8,"input",7),b.bc("ngModelChange",(function(t){return e.emailAddress=t})),b.Tb(),b.Ic(9,Vt,2,1,"div",8),b.Tb(),b.Ub(10,"mat-dialog-actions"),b.Ub(11,"button",9),b.bc("click",(function(){return e.close()})),b.Kc(12,"Cancel"),b.Tb(),b.Ub(13,"button",10),b.Kc(14,"Confirm"),b.Tb(),b.Tb(),b.Tb()),2&t&&(b.Bb(8),b.nc("ngModel",e.emailAddress),b.Bb(1),b.nc("ngIf",e.errors["emails.0"]))},directives:[x.i,w.a,st.b,z.a,n.v,n.w,x.f,n.d,n.F,n.u,n.x,i.t,x.c],styles:[""],encapsulation:2}),t})();var Et=a("Lm4C"),Qt=a("QeDF"),qt=a("2Vo4"),Dt=a("3FDK"),Nt=a("IuoX"),Gt=a("kmQS"),Ht=a("xrwy"),Jt=a("wZkO"),Xt=a("0rE+"),Yt=a("vn70");function Zt(t,e){if(1&t&&b.Pb(0,"mat-icon",36),2&t){b.fc();const t=b.wc(12);b.nc("matMenuTriggerFor",t)}}function Wt(t,e){if(1&t&&(b.Ub(0,"div",19),b.Ub(1,"div",16),b.Kc(2,"Envato"),b.Tb(),b.Ub(3,"div",37),b.Kc(4),b.Tb(),b.Tb()),2&t){const t=b.fc();b.Bb(4),b.Lc(t.user.purchase_codes[0].envato_username)}}function te(t,e){if(1&t){const t=b.Vb();b.Ub(0,"button",40),b.bc("click",(function(){b.zc(t);const e=b.fc().$implicit;return b.fc().removeEmail(e.address)})),b.Pb(1,"mat-icon",41),b.Tb()}}function ee(t,e){if(1&t&&(b.Ub(0,"div",38),b.Ic(1,te,2,0,"button",39),b.Ub(2,"span"),b.Kc(3),b.Tb(),b.Tb()),2&t){const t=e.$implicit,a=b.fc();b.Bb(1),b.nc("ngIf",a.detailsEditable),b.Bb(2),b.Lc(t.address)}}function ae(t,e){if(1&t){const t=b.Vb();b.Ub(0,"div",19),b.Ub(1,"button",42),b.bc("click",(function(){return b.zc(t),b.fc().openAddEmailModal()})),b.Kc(2,"Add Email"),b.Tb(),b.Tb()}}let ie=(()=>{class t{constructor(t,e,a,i,s,r,o,c,l){this.users=t,this.route=e,this.toast=a,this.modal=i,this.avatarValidator=s,this.currentUser=r,this.settings=o,this.reports=c,this.datatable=l,this.user=new jt.a({purchase_codes:[]}),this.detailsEditable=!1,this.userSearches$=new qt.a(null),this.profile=new n.l({details:new n.i,notes:new n.i}),this.tagsControl=new n.i([])}ngOnInit(){this.route.data.subscribe(t=>{this.hydrateProfile(t.user),this.bindFormControls(),this.createDataSource()}),this.detailsEditable=this.currentUser.hasPermission("users.update")}openAddEmailModal(){this.modal.show(Rt,{userId:this.user.id}).afterClosed().subscribe(t=>{this.user.secondary_emails.push(new At({address:t}))})}removeEmail(t){this.users.removeEmail(this.user.id,{emails:[t]}).subscribe(()=>{const e=this.user.secondary_emails.findIndex(e=>e.address===t);this.user.secondary_emails.splice(e,1)})}openAvatarUploadDialog(){Object(Et.a)({types:[Qt.a.image]}).then(t=>{this.avatarValidator.validateWithToast(t[0]).failed||this.users.uploadAvatar(this.user.id,t).subscribe(t=>{this.user.avatar=t.user.avatar,this.currentUser.set("avatar",t.user.avatar),this.toast.open("Avatar updated")},t=>{const e=Object.keys(t.errors)[0];this.toast.open(t.errors[e])})})}deleteAvatar(){this.users.deleteAvatar(this.user.id).subscribe(t=>{this.user.avatar=t.avatar,this.toast.open("Avatar removed.")})}hydrateProfile(t){this.user=t,t.details&&this.profile.setValue({details:t.details.details,notes:t.details.notes}),this.tagsControl.setValue(t.tags.map(t=>t.name))}createDataSource(){this.datatable.paginator.dontUpdateQueryParams=!0,this.datatable.init({uri:"tickets",staticParams:{userId:this.user.id}})}bindFormControls(){this.profile.valueChanges.pipe(Object(h.a)(600),Object(l.a)()).subscribe(t=>{this.users.updateDetails(this.user.id,t).subscribe(()=>{this.toast.open("Updated user details.")})}),this.tagsControl.valueChanges.subscribe(t=>{this.users.syncTags(this.user.id,{tags:t}).subscribe()})}tabChanged(t){1!==t.index||this.userSearches$.value||this.reports.getUserSearchesReport(this.user.id).subscribe(t=>{this.userSearches$.next(t.report)})}}return t.\u0275fac=function(e){return new(e||t)(b.Ob(zt.a),b.Ob(s.a),b.Ob(V.b),b.Ob(U.a),b.Ob(Nt.a),b.Ob(R.a),b.Ob(Gt.a),b.Ob(Ht.a),b.Ob(O.a))},t.\u0275cmp=b.Ib({type:t,selectors:[["user-profile"]],viewQuery:function(t,e){var a;1&t&&b.Gc(Dt.a,!0),2&t&&b.vc(a=b.cc())&&(e.tagsManager=a.first)},features:[b.Ab([O.a])],decls:66,vars:28,consts:[["menuPosition","agent-mailbox"],[1,"nav-searchbar"],[1,"content"],["customScrollbar","lite",1,"sidebar"],[1,"panel"],[1,"panel-body"],[1,"user-info"],[1,"avatar-container"],["alt","user avatar",1,"user-avatar",3,"src"],[1,"hover-overlay"],["svgIcon","edit",3,"matMenuTriggerFor",4,"ngIf"],[1,"update-avatar-menu"],["updateAvatarMenu","matMenu"],["mat-menu-item","","trans","",1,"upload-avatar-item",3,"click"],["mat-menu-item","","trans","",1,"delete-avatar-item",3,"click"],[1,"names"],[1,"name"],[1,"email","primary-email"],[1,"user-details"],[1,"details-row"],["trans","",1,"name"],[1,"input-container","value"],["name","details","id","details",3,"formControl","readonly"],["name","notes","id","notes",3,"formControl","readonly"],["class","details-row",4,"ngIf"],[1,"emails","value"],["class","email secondary-email",4,"ngFor","ngForOf"],["trans","",1,"panel-header"],[3,"formControl","readonly"],["color","accent",3,"selectedTabChange"],[3,"label"],[1,"tickets"],[3,"openTicketInModal"],["primary-text","","trans",""],[3,"data"],["trans",""],["svgIcon","edit",3,"matMenuTriggerFor"],[1,"value"],[1,"email","secondary-email"],["class","remove-email-button","mat-icon-button","",3,"click",4,"ngIf"],["mat-icon-button","",1,"remove-email-button",3,"click"],["svgIcon","close"],["mat-flat-button","","color","accent","trans","",1,"add-email-button",3,"click"]],template:function(t,e){1&t&&(b.Ub(0,"material-navbar",0),b.Pb(1,"ticket-search-dropdown",1),b.Tb(),b.Ub(2,"div",2),b.Ub(3,"aside",3),b.Ub(4,"div",4),b.Ub(5,"div",5),b.Ub(6,"div",6),b.Ub(7,"div",7),b.Pb(8,"img",8),b.Ub(9,"div",9),b.Ic(10,Zt,1,1,"mat-icon",10),b.Tb(),b.Tb(),b.Ub(11,"mat-menu",11,12),b.Ub(13,"button",13),b.bc("click",(function(){return e.openAvatarUploadDialog()})),b.Kc(14,"Upload"),b.Tb(),b.Ub(15,"button",14),b.bc("click",(function(){return e.deleteAvatar()})),b.Kc(16,"Remove"),b.Tb(),b.Tb(),b.Ub(17,"div",15),b.Ub(18,"div",16),b.Kc(19),b.Tb(),b.Ub(20,"div",17),b.Kc(21),b.Tb(),b.Tb(),b.Tb(),b.Ub(22,"div",18),b.Ub(23,"div",19),b.Ub(24,"div",20),b.Kc(25,"Details"),b.Tb(),b.Ub(26,"div",21),b.Pb(27,"textarea",22),b.Tb(),b.Tb(),b.Ub(28,"div",19),b.Ub(29,"div",20),b.Kc(30,"Notes"),b.Tb(),b.Ub(31,"div",21),b.Pb(32,"textarea",23),b.Tb(),b.Tb(),b.Ic(33,Wt,5,1,"div",24),b.Ub(34,"div",19),b.Ub(35,"div",20),b.Kc(36,"Emails"),b.Tb(),b.Ub(37,"div",25),b.Ub(38,"div",17),b.Kc(39),b.Tb(),b.Ic(40,ee,4,2,"div",26),b.Tb(),b.Tb(),b.Ic(41,ae,3,0,"div",24),b.Tb(),b.Tb(),b.Tb(),b.Ub(42,"div",4),b.Ub(43,"div",27),b.Kc(44,"Tags"),b.Tb(),b.Ub(45,"div",5),b.Pb(46,"tags-manager",28),b.Tb(),b.Tb(),b.Tb(),b.Ub(47,"mat-tab-group",29),b.bc("selectedTabChange",(function(t){return e.tabChanged(t)})),b.Ub(48,"mat-tab",30),b.gc(49,"trans"),b.Ub(50,"div",31),b.Ub(51,"tickets-list",32),b.Ub(52,"no-results-message"),b.gc(53,"async"),b.Ub(54,"span",33),b.Kc(55,"This user did not create any tickets yet."),b.Tb(),b.Tb(),b.Tb(),b.Pb(56,"ticket-floating-toolbar"),b.Tb(),b.Tb(),b.Ub(57,"mat-tab",30),b.gc(58,"trans"),b.Ub(59,"search-report-table",34),b.gc(60,"async"),b.Ub(61,"span",35),b.Kc(62,"Search Term"),b.Tb(),b.Ub(63,"info-popover"),b.Ub(64,"span",35),b.Kc(65,"This report shows what this user searched for recently."),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb(),b.Tb()),2&t&&(b.Bb(8),b.oc("src",e.user.avatar,b.Cc),b.Bb(2),b.nc("ngIf",e.detailsEditable),b.Bb(9),b.Lc(e.user.display_name),b.Bb(2),b.Lc(e.user.email),b.Bb(6),b.nc("formControl",e.profile.controls.details)("readonly",!e.detailsEditable),b.Bb(5),b.nc("formControl",e.profile.controls.notes)("readonly",!e.detailsEditable),b.Bb(1),b.nc("ngIf",e.user.purchase_codes&&(null==e.user.purchase_codes[0]?null:e.user.purchase_codes[0].envato_username)),b.Bb(6),b.Lc(e.user.email),b.Bb(1),b.nc("ngForOf",e.user.secondary_emails),b.Bb(1),b.nc("ngIf",e.detailsEditable),b.Bb(5),b.nc("formControl",e.tagsControl)("readonly",!e.detailsEditable),b.Bb(2),b.nc("label",b.hc(49,20,"Tickets")),b.Bb(3),b.nc("openTicketInModal",!0),b.Bb(1),b.Fb("hidden",!b.hc(53,22,e.datatable.paginator.noResults$)),b.Bb(5),b.nc("label",b.hc(58,24,"Searches")),b.Bb(2),b.nc("data",b.hc(60,26,e.userSearches$)))},directives:[m.a,kt,rt.a,i.t,q.e,q.b,w.a,n.d,n.u,n.j,i.s,Dt.a,Jt.c,Jt.a,j,Y.a,X,Xt.a,Yt.a,z.a,q.d,st.b],pipes:[N.a,i.b],styles:["user-profile{display:block;width:100%;height:100%;background-color:var(--be-background-alternative)}user-profile .content{display:flex;padding:25px;width:100%;height:calc(100vh - 70px);overflow:hidden}user-profile .sidebar{flex:0 0 320px;width:320px;margin-right:15px;height:100%;overflow:auto}user-profile .sidebar .panel{margin-bottom:15px;background-color:var(--be-background);border:1px solid var(--be-divider-default);padding:10px}user-profile .sidebar .panel .panel-header{padding:5px}user-profile .sidebar .user-info{display:flex;align-items:center;border-bottom:1px solid var(--be-divider-default);margin-bottom:15px;padding-bottom:15px}user-profile .sidebar .user-info .avatar-container{width:65px;height:65px;position:relative}user-profile .sidebar .user-info .avatar-container:hover .hover-overlay{display:flex}user-profile .sidebar .user-info .avatar-container.disabled{cursor:default}user-profile .sidebar .user-info .avatar-container.disabled>.hover-overlay{display:none}user-profile .sidebar .user-info .avatar-container .hover-overlay{display:none;position:absolute;top:0;bottom:0;width:100%;height:100%;background-color:hsla(0,0%,100%,.5);justify-content:center;align-items:center;cursor:pointer}user-profile .sidebar .user-info .avatar-container .hover-overlay>mat-icon{width:34px;height:34px;color:var(--be-secondary-text)}user-profile .sidebar .user-info .avatar-container>img{width:100%;height:100%;-o-object-fit:cover;object-fit:cover}user-profile .sidebar .user-info>.names{margin-left:10px}user-profile .sidebar .user-info>.names>.name{font-size:1.5rem}user-profile .sidebar .user-info>.names>.email{color:var(--be-secondary-text)}user-profile .sidebar .user-details{margin-top:15px}user-profile .sidebar .user-details .details-row{display:flex;align-items:center;margin-bottom:15px}user-profile .sidebar .user-details .details-row .name{flex:0 0 30%;max-width:40px;margin-right:20px}user-profile .sidebar .user-details .details-row .value{flex:1 1 auto}user-profile .sidebar .user-details .details-row .value.input-container{height:auto}user-profile .sidebar .user-details .details-row .value.input-container>textarea{height:auto;padding:5px;border-radius:3px}user-profile .sidebar .user-details .emails .primary-email{font-weight:500}user-profile .sidebar .user-details .emails .secondary-email{margin-top:8px}user-profile .mat-tab-group{flex:1 1 auto;height:100%;border:1px solid var(--be-divider-default);min-width:0}user-profile .mat-tab-body-wrapper,user-profile .tickets,user-profile search-report-table{height:100%}user-profile search-report-table .material-panel{border:none}"],encapsulation:2}),t})(),ne=(()=>{class t{constructor(t,e,a){this.tickets=t,this.users=e,this.router=a}resolve(t,e){return this.users.get(t.params.id,{with:"tags,purchase_codes,secondary_emails,details"}).pipe(Object(c.a)(t=>{if(t.user)return t.user;this.router.navigate(["/mailbox"])}))}}return t.\u0275fac=function(e){return new(e||t)(b.Yb(k.a),b.Yb(zt.a),b.Yb(s.f))},t.\u0275prov=b.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var se=a("0QyJ"),re=a("h586"),oe=a("KKQg"),ce=a("rG4v"),le=a("83jf");function be(t,e){if(1&t&&(b.Ub(0,"div",26),b.Kc(1),b.Tb()),2&t){const t=b.fc().ngIf;b.Bb(1),b.Lc(t.user_id)}}function de(t,e){if(1&t&&(b.Ub(0,"mat-option",27),b.Ub(1,"div",28),b.Pb(2,"img",29),b.Ub(3,"div",30),b.Ub(4,"div",31),b.Kc(5),b.Tb(),b.Ub(6,"div",32),b.Kc(7),b.Tb(),b.Tb(),b.Tb(),b.Tb()),2&t){const t=e.$implicit;b.nc("value",t),b.Bb(2),b.nc("src",t.avatar,b.Cc),b.Bb(3),b.Lc(t.display_name),b.Bb(2),b.Lc(t.email)}}function ue(t,e){if(1&t&&(b.Ub(0,"div",33),b.Kc(1),b.Tb()),2&t){const t=b.fc().ngIf;b.Bb(1),b.Lc(t.subject)}}function pe(t,e){if(1&t&&(b.Ub(0,"option",34),b.Kc(1),b.Tb()),2&t){const t=e.$implicit;b.nc("ngValue",t.id),b.Bb(1),b.Lc(t.display_name)}}function me(t,e){if(1&t&&(b.Ub(0,"div",35),b.Kc(1),b.Tb()),2&t){const t=b.fc().ngIf;b.Bb(1),b.Lc(t.category)}}function ge(t,e){if(1&t&&(b.Ub(0,"option",36),b.Kc(1),b.Tb()),2&t){const t=e.$implicit;b.nc("ngValue",t.name),b.Bb(1),b.Lc(t.display_name)}}function he(t,e){if(1&t&&(b.Ub(0,"div",37),b.Kc(1),b.Tb()),2&t){const t=b.fc().ngIf;b.Bb(1),b.Lc(t.status)}}function fe(t,e){if(1&t&&(b.Ub(0,"div",38),b.Kc(1),b.Tb()),2&t){const t=b.fc().ngIf;b.Bb(1),b.Lc(t.body)}}function ve(t,e){if(1&t){const t=b.Vb();b.Ub(0,"form",1),b.bc("ngSubmit",(function(){return b.zc(t),b.fc().createTicket()})),b.Ub(1,"div",2),b.Ub(2,"label",3),b.Kc(3,"Customer"),b.Tb(),b.Pb(4,"input",4),b.Ic(5,be,2,1,"div",5),b.Tb(),b.Ub(6,"mat-autocomplete",6,7),b.Ic(8,de,8,4,"mat-option",8),b.gc(9,"async"),b.Tb(),b.Ub(10,"div",2),b.Ub(11,"label",9),b.Kc(12,"Subject"),b.Tb(),b.Pb(13,"input",10),b.Ic(14,ue,2,1,"div",11),b.Tb(),b.Ub(15,"div",2),b.Ub(16,"label",12),b.Kc(17,"Category"),b.Tb(),b.Ub(18,"select",13),b.Ic(19,pe,2,2,"option",14),b.Tb(),b.Ic(20,me,2,1,"div",15),b.Tb(),b.Ub(21,"div",2),b.Ub(22,"label",16),b.Kc(23,"Status"),b.Tb(),b.Ub(24,"select",17),b.Ic(25,ge,2,2,"option",18),b.Tb(),b.Ic(26,he,2,1,"div",19),b.Tb(),b.Ub(27,"div",20),b.Ub(28,"label",21),b.Kc(29,"Ticket Body"),b.Tb(),b.Ub(30,"text-editor",22),b.bc("onFileUpload",(function(e){return b.zc(t),b.fc().uploadFiles(e)}))("onChange",(function(e){return b.zc(t),b.fc().setBody(e)})),b.Tb(),b.Pb(31,"upload-progress-bar"),b.Ic(32,fe,2,1,"div",23),b.Tb(),b.Ub(33,"reply-attachment-list",24),b.bc("detached",(function(e){return b.zc(t),b.fc().removeAttachment(e)})),b.gc(34,"async"),b.Tb(),b.Ub(35,"button",25),b.gc(36,"async"),b.Kc(37,"Create"),b.Tb(),b.Tb()}if(2&t){const t=e.ngIf,a=b.wc(7),i=b.fc();b.nc("formGroup",i.ticketForm),b.Bb(4),b.nc("matAutocomplete",a),b.Bb(1),b.nc("ngIf",t.user_id),b.Bb(1),b.nc("displayWith",i.displayUserFn),b.Bb(2),b.nc("ngForOf",b.hc(9,14,i.users$)),b.Bb(6),b.nc("ngIf",t.subject),b.Bb(5),b.nc("ngForOf",i.ticketCategories),b.Bb(1),b.nc("ngIf",t.category),b.Bb(5),b.nc("ngForOf",i.mailboxTags.statusTags),b.Bb(1),b.nc("ngIf",t.status),b.Bb(4),b.nc("minHeight",230),b.Bb(2),b.nc("ngIf",t.body),b.Bb(1),b.nc("attachments",b.hc(34,16,i.attachments$)),b.Bb(2),b.nc("disabled",b.hc(36,18,i.loading$))}}let ke=(()=>{class t{constructor(t,e,a,i,n,s,r,o,c){this.fb=t,this.settings=e,this.uploadQueue=a,this.users=i,this.tickets=n,this.toast=s,this.router=r,this.route=o,this.mailboxTags=c,this.errors$=new qt.a({}),this.attachments$=new qt.a([]),this.users$=new qt.a([]),this.loading$=new qt.a(!1),this.ticketCategories=[],this.ticketForm=this.fb.group({customer:[""],subject:[""],category:[""],body:[""],status:[""]})}ngOnInit(){this.bindToCustomerControl(),this.ticketForm.patchValue({status:this.mailboxTags.statusTags[0].name}),this.route.data.subscribe(t=>{this.ticketCategories=t.categories,t.categories.length&&this.ticketForm.patchValue({category:this.ticketCategories[0].id})})}createTicket(){this.loading$.next(!0),this.tickets.create(this.getPayload()).pipe(Object(T.a)(()=>this.loading$.next(!1))).subscribe(()=>{this.toast.open("Ticket created"),this.mailboxTags.refresh(),this.router.navigateByUrl("/mailbox/tickets")},t=>this.errors$.next(t.errors))}getPayload(){const t=this.ticketForm.value;return t.user_id=t.customer.id,t.uploads=this.uploadQueue.getAllCompleted().map(t=>t.id),t}setBody(t){this.ticketForm.patchValue({body:t})}uploadFiles(t){this.uploadQueue.start(t).subscribe(t=>{this.attachments$.next([...this.attachments$.value,t.fileEntry])})}removeAttachment(t){const e=this.attachments$.value.slice();for(let a=0;a<e.length;a++)e[a].id===t.id&&e.splice(a,1);this.attachments$.next(e)}bindToCustomerControl(){this.ticketForm.get("customer").valueChanges.pipe(Object(h.a)(250),Object(l.a)(),Object(f.a)(t=>this.searchUsers(t)),Object(v.a)(()=>Object(it.a)([]))).subscribe(t=>{this.users$.next(t)})}searchUsers(t){return t&&"string"==typeof t?this.users.getAll({query:t}):Object(it.a)([])}displayUserFn(t){return t?t.email:void 0}}return t.\u0275fac=function(e){return new(e||t)(b.Ob(n.h),b.Ob(Gt.a),b.Ob(re.a),b.Ob(zt.a),b.Ob(k.a),b.Ob(V.b),b.Ob(s.f),b.Ob(s.a),b.Ob(d.a))},t.\u0275cmp=b.Ib({type:t,selectors:[["create-ticket"]],features:[b.Ab([k.a,re.a])],decls:2,vars:3,consts:[["class","many-inputs","ngNativeValidate","",3,"formGroup","ngSubmit",4,"ngIf"],["ngNativeValidate","",1,"many-inputs",3,"formGroup","ngSubmit"],[1,"input-container"],["for","user","trans",""],["type","text","id","user","formControlName","customer","required","",3,"matAutocomplete"],["class","error user-error",4,"ngIf"],[1,"create-ticket-user-autocomplete",3,"displayWith"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["for","subject","trans",""],["type","text","id","subject","formControlName","subject","required",""],["class","error subject-error",4,"ngIf"],["for","category-select","trans",""],["name","category","id","category-select","formControlName","category","required",""],[3,"ngValue",4,"ngFor","ngForOf"],["class","error category-error",4,"ngIf"],["for","status-select","trans",""],["name","status","id","status-select","formControlName","status","required",""],["class","status-tag-option",3,"ngValue",4,"ngFor","ngForOf"],["class","error status-error",4,"ngIf"],[1,"input-container","body-input-container"],["for","description","trans",""],["id","description","inlineUploadPrefix","ticket_images",3,"minHeight","onFileUpload","onChange"],["class","error body-error",4,"ngIf"],[3,"attachments","detached"],["mat-raised-button","","color","accent","type","submit","trans","",3,"disabled"],[1,"error","user-error"],[3,"value"],[1,"create-ticket-user-option"],[3,"src"],[1,"meta"],[1,"name"],[1,"email"],[1,"error","subject-error"],[3,"ngValue"],[1,"error","category-error"],[1,"status-tag-option",3,"ngValue"],[1,"error","status-error"],[1,"error","body-error"]],template:function(t,e){1&t&&(b.Ic(0,ve,38,20,"form",0),b.gc(1,"async")),2&t&&b.nc("ngIf",b.hc(1,1,e.errors$))},directives:[i.t,n.v,n.m,w.a,n.d,nt.c,n.u,n.k,n.F,nt.a,i.s,n.G,oe.a,ce.a,le.a,st.b,ot.l,n.z,n.J],pipes:[i.b],styles:["create-ticket{display:block;padding:25px;overflow:auto;height:calc(100vh - 70px)}create-ticket form{max-width:800px}create-ticket .error{margin-top:7px;color:#f44336}create-ticket option,create-ticket select{text-transform:capitalize}.create-ticket-user-autocomplete .mat-option{height:auto;line-height:normal}.create-ticket-user-option{display:flex;padding:8px 0}.create-ticket-user-option img{width:40px;height:40px;flex-shrink:0;margin-right:10px;border-radius:4px;overflow:hidden}.create-ticket-user-option .name{color:var(--be-text);font-size:1.5rem}.create-ticket-user-option .email{color:var(--be-secondary-text);font-size:1.4rem}"],encapsulation:2,changeDetection:0}),t})();var Te=a("i70M"),xe=a("vhtE");const ye=s.j.forChild([{path:"",canActivate:[se.a,xe.a],canActivateChild:[se.a,xe.a],data:{permissions:["tickets.view","tickets.create"]},children:[{path:"",redirectTo:"tickets",pathMatch:"full"},{path:"tickets/new",component:Mt,resolve:{categories:Te.a},data:{permissions:["tickets.create"]},children:[{path:"",component:ke}]},{path:"tickets",component:Mt,data:{permissions:["tickets.view"]},children:[{path:"",component:$t},{path:":ticket_id",component:Lt.a,resolve:{ticket:St.a}}]},{path:"users/:id",component:ie,resolve:{user:ne},data:{permissions:["users.view","tickets.view","tags.view"]}}]}]);var Ue=a("DldP"),Oe=a("YHvm"),Ie=a("gFpt"),Ce=a("6rvT"),we=a("Iysn"),Be=a("JZOH"),Pe=a("1ImS");let _e=(()=>{class t{}return t.\u0275mod=b.Mb({type:t}),t.\u0275inj=b.Lb({factory:function(e){return new(e||t)},imports:[[i.c,Pe.a,Ce.a,s.j,ot.r,P.b,M.g]]}),t})();var Me=a("GSRO"),Fe=a("hD7E"),Ke=a("y04r"),$e=a("/enU"),Le=a("09gM"),Se=a("losq");let je=(()=>{class t{}return t.\u0275mod=b.Mb({type:t}),t.\u0275inj=b.Lb({factory:function(e){return new(e||t)},providers:[k.a,ne],imports:[[i.c,n.o,n.E,s.j,Ue.a,Oe.a,Ie.a,Ce.a,we.a,Be.a,Le.a,_e,Me.a,Fe.a,Ke.a,$e.a,Se.a,ye,z.b,st.c,Q.b,nt.b,q.c,x.g,Tt.d,Jt.g]]}),t})()},CZpq:function(t,e,a){"use strict";a.d(e,"a",(function(){return s}));var i=a("fXoL"),n=a("LRXf");let s=(()=>{class t{constructor(t){this.http=t}index(e){return this.http.get(t.BASE_URI,e)}create(e){return this.http.post(t.BASE_URI,e)}update(e,a){return this.http.put(`${t.BASE_URI}/${e}`,a)}delete(e){return this.http.delete(`${t.BASE_URI}/${e}`)}}return t.BASE_URI="tags",t.\u0275fac=function(e){return new(e||t)(i.Yb(n.a))},t.\u0275prov=i.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()}}]);