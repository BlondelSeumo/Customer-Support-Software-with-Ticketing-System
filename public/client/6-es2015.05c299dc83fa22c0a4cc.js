(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"1V5l":function(t,e,i){"use strict";i.d(e,"a",(function(){return p}));class n{constructor(t={}){this.type="replies";for(const e in t)this[e]=t[e]}}var s=i("LRne"),a=i("Kqap"),o=i("NJ9Y"),r=i("JIr8"),c=i("w1tV"),l=i("fXoL"),d=i("apsj"),b=i("LsVx"),u=i("h586"),h=i("i2dy");let p=(()=>{class t{constructor(t,e,i,n){this.ticketUploads=t,this.tickets=e,this.uploadQueue=i,this.toast=n,this.reset()}get(){return this.model}set(t){this.model=t}setBody(t){this.model.body=t}setTicketId(t){this.ticketId=t}isEmpty(){return 0===this.model.body.length&&0===this.model.uploads.length}uploadFiles(t){this.uploadQueue.start(t).pipe(Object(a.a)((t,e)=>[...t,e.fileEntry],[]),Object(o.a)()).subscribe(t=>{this.model.uploads=[...this.model.uploads,...t],this.save()})}detachUpload(t){this.ticketUploads.detach(this.model.id,t.id).subscribe(()=>{const e=this.get().uploads.findIndex(e=>e.id===t.id);this.get().uploads.splice(e,1)})}save(t={}){if(this.isEmpty())return;const e=this.tickets.saveDraft(this.ticketId,this.getPayload(t),this.model.id).pipe(Object(r.a)(()=>Object(s.a)({data:this.get()})),Object(c.a)());return e.subscribe(t=>{this.set(t.data)}),e}delete(){this.model.id&&this.tickets.deleteDraft(this.model.id).subscribe(),this.reset()}getPayload(t={}){return Object.assign({},{body:this.model.body||null,uploads:this.model.uploads.map(t=>t.id)},t)}reset(){this.set(new n({uploads:[],body:""}))}}return t.\u0275fac=function(e){return new(e||t)(l.Yb(d.a),l.Yb(b.a),l.Yb(u.a),l.Yb(h.b))},t.\u0275prov=l.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},"2qZP":function(t,e,i){"use strict";i.d(e,"a",(function(){return g}));var n=i("fXoL"),s=i("tSQ/"),a=i("STbY"),o=i("IzEk"),r=i("mWN8"),c=i("twBr"),l=i("LsVx"),d=i("i2dy"),b=i("NFeN"),u=i("Rd8u"),h=i("ofXK");function p(t,e){if(1&t){const t=n.Vb();n.Ub(0,"button",7),n.bc("click",(function(){n.zc(t);const i=e.$implicit;return n.fc().assignTicketsTo(i.id)})),n.Kc(1),n.Tb()}if(2&t){const t=e.$implicit,i=n.fc();n.Fb("active",i.ticket&&i.ticket.assigned_to==t.id),n.Bb(1),n.Lc(t.email)}}let g=(()=>{class t{constructor(t,e,i,s){this.users=t,this.currentUser=e,this.tickets=i,this.toast=s,this.agents=[],this.assigned=new n.n}ngOnInit(){this.trigger.menuOpened.pipe(Object(o.a)(1)).subscribe(()=>{this.fetchAgents()})}open(){this.trigger.openMenu()}close(){this.trigger.closeMenu()}assignTicketsTo(t=null){this.tickets.assign(this.ticketIds?this.ticketIds:[this.ticket.id],t).subscribe(()=>{this.ticket&&(this.ticket.assigned_to=t),this.toast.open("Tickets assigned"),this.assigned.emit()})}fetchAgents(){this.users.getAll({permission:s.a,perPage:35}).subscribe(t=>{this.agents=t.filter(t=>t.id!==this.currentUser.get("id"))})}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(r.a),n.Ob(c.a),n.Ob(l.a),n.Ob(d.b))},t.\u0275cmp=n.Ib({type:t,selectors:[["assign-ticket-dropdown"]],viewQuery:function(t,e){var i;1&t&&n.Gc(a.d,!0),2&t&&n.vc(i=n.cc())&&(e.trigger=i.first)},inputs:{ticket:"ticket",ticketIds:"ticketIds"},outputs:{assigned:"assigned"},decls:9,vars:7,consts:[[1,"no-style","toolbar-item",3,"matMenuTriggerFor"],["svgIcon","user-custom"],[1,"assign-ticket-menu",3,"overlapTrigger"],["assignTicketMenu","matMenu"],["mat-menu-item","","trans","",1,"anyone-item",3,"click"],["mat-menu-item","","trans","",1,"me-item",3,"click"],["mat-menu-item","","class","agent-item",3,"active","click",4,"ngFor","ngForOf"],["mat-menu-item","",1,"agent-item",3,"click"]],template:function(t,e){if(1&t&&(n.Ub(0,"button",0),n.Pb(1,"mat-icon",1),n.Tb(),n.Ub(2,"mat-menu",2,3),n.Ub(4,"button",4),n.bc("click",(function(){return e.assignTicketsTo()})),n.Kc(5,"Anyone"),n.Tb(),n.Ub(6,"button",5),n.bc("click",(function(){return e.assignTicketsTo(e.currentUser.get("id"))})),n.Kc(7,"Me"),n.Tb(),n.Ic(8,p,2,3,"button",6),n.Tb()),2&t){const t=n.wc(3);n.nc("matMenuTriggerFor",t),n.Bb(2),n.nc("overlapTrigger",!1),n.Bb(2),n.Fb("active",e.ticket&&!e.ticket.assigned_to),n.Bb(2),n.Fb("active",e.ticket&&e.ticket.assigned_to===e.currentUser.get("id")),n.Bb(2),n.nc("ngForOf",e.agents)}},directives:[a.d,b.a,a.e,a.b,u.a,h.s],styles:["assign-ticket-dropdown{position:relative;display:inline-block}.assign-ticket-menu.mat-menu-panel{max-height:500px}.assign-ticket-menu.mat-menu-panel .mat-menu-item.active{background-color:var(--be-hover)}"],encapsulation:2}),t})()},"3H9V":function(t,e,i){"use strict";i.d(e,"a",(function(){return R}));var n=i("yS8O"),s=i("aV6R"),a=i("lxqa"),o=i("wZee"),r=(i("bPOv"),i("Yhcd"),i("jpss"),i("XIHC"),i("QWvX"),i("fXoL")),c=i("QGXG"),l=i("twBr"),d=i("LsVx"),b=i("wWhK"),u=i("9C01"),h=i("ofXK"),p=i("STbY"),g=i("Rd8u"),f=i("bTqV"),m=i("NFeN"),v=i("83jf");function y(t,e){if(1&t&&r.Pb(0,"img",22),2&t){const t=r.fc(2).$implicit;r.oc("src",t.user.avatar,r.Cc),r.oc("alt",t.user.email)}}function k(t,e){1&t&&(r.Ub(0,"span",23),r.Kc(1,"You"),r.Tb())}function T(t,e){if(1&t&&(r.Ub(0,"span"),r.Kc(1),r.Tb()),2&t){const t=r.fc(2).$implicit;r.Bb(1),r.Lc(t.user.display_name)}}function x(t,e){1&t&&(r.Ub(0,"span",24),r.Kc(1,"replied"),r.Tb())}function w(t,e){1&t&&(r.Ub(0,"span",24),r.Kc(1,"started the conversation"),r.Tb())}function I(t,e){1&t&&(r.Ub(0,"span",24),r.Kc(1,"left a note"),r.Tb())}function U(t,e){1&t&&(r.Ub(0,"span",24),r.Kc(1,"created a draft"),r.Tb())}function O(t,e){if(1&t){const t=r.Vb();r.Ub(0,"span",25),r.Ub(1,"button",26),r.bc("click",(function(){r.zc(t);const e=r.fc(2).$implicit;return r.fc().editDraft(e)})),r.Kc(2,"Edit"),r.Tb(),r.Ub(3,"button",27),r.bc("click",(function(){r.zc(t);const e=r.fc(2).$implicit;return r.fc().maybeDeleteReply(e)})),r.Kc(4,"Discard"),r.Tb(),r.Tb()}}function B(t,e){if(1&t&&(r.Sb(0),r.Ub(1,"button",28),r.Pb(2,"mat-icon",29),r.Tb(),r.Rb()),2&t){r.fc();const t=r.wc(19);r.Bb(1),r.nc("matMenuTriggerFor",t)}}function C(t,e){if(1&t){const t=r.Vb();r.Ub(0,"reply-attachment-list",30),r.bc("detached",(function(e){r.zc(t);const i=r.fc(2).$implicit;return r.fc().removeAttachment(i,e)})),r.Tb()}if(2&t){const t=r.fc(2).$implicit;r.nc("attachments",t.uploads)}}function K(t,e){if(1&t){const t=r.Vb();r.Ub(0,"div",3),r.Ic(1,y,1,2,"img",4),r.Ub(2,"div",5),r.Ub(3,"div",6),r.Ub(4,"div",7),r.Ub(5,"span",8),r.Ic(6,k,2,0,"span",9),r.Ic(7,T,2,1,"span",10),r.Tb(),r.Kc(8," "),r.Ic(9,x,2,0,"span",11),r.Ic(10,w,2,0,"span",11),r.Ic(11,I,2,0,"span",11),r.Ic(12,U,2,0,"span",11),r.Ic(13,O,5,0,"span",12),r.Tb(),r.Ub(14,"div",13),r.Ub(15,"span",14),r.Kc(16),r.Tb(),r.Ic(17,B,3,1,"ng-container",10),r.Ub(18,"mat-menu",15,16),r.Ub(20,"div",17),r.bc("click",(function(){r.zc(t);const e=r.fc().$implicit;return r.fc().update(e)})),r.Kc(21,"Edit"),r.Tb(),r.Ub(22,"div",18),r.bc("click",(function(){r.zc(t);const e=r.fc().$implicit;return r.fc().maybeDeleteReply(e)})),r.Kc(23,"Delete"),r.Tb(),r.Ub(24,"div",19),r.bc("click",(function(){r.zc(t);const e=r.fc().$implicit;return r.fc().showOriginalEmail(e)})),r.Kc(25,"Show Original"),r.Tb(),r.Tb(),r.Tb(),r.Tb(),r.Pb(26,"div",20),r.Ic(27,C,1,1,"reply-attachment-list",21),r.Tb(),r.Tb()}if(2&t){const t=r.fc(),e=t.$implicit,i=t.last,n=r.fc();r.Fb("bounce",e.animated)("my-reply",e.user_id==n.currentUser.get("id")),r.oc("ngClass",e.type),r.Bb(1),r.nc("ngIf",e.user.avatar),r.Bb(5),r.nc("ngIf",n.currentUser.get("id")==e.user.id),r.Bb(1),r.nc("ngIf",n.currentUser.get("id")!=e.user.id),r.Bb(2),r.nc("ngIf",!i&&"replies"===e.type),r.Bb(1),r.nc("ngIf",i&&"replies"===e.type),r.Bb(1),r.nc("ngIf","notes"==e.type),r.Bb(1),r.nc("ngIf","drafts"==e.type),r.Bb(1),r.nc("ngIf","drafts"===e.type),r.Bb(3),r.Lc(e.created_at_formatted),r.Bb(1),r.nc("ngIf",n.currentUser.hasPermission("replies.update")&&"drafts"!==e.type),r.Bb(9),r.nc("innerHTML",e.body,r.Ac),r.Bb(1),r.nc("ngIf",e.uploads.length)}}function L(t,e){if(1&t&&r.Ic(0,K,28,17,"div",2),2&t){const t=e.$implicit,i=r.fc();r.nc("ngIf",i.currentUser.hasPermission("replies.view")||"notes"!==t.type)}}let R=(()=>{class t{constructor(t,e,i,n,s){this.modal=t,this.currentUser=e,this.tickets=i,this.conversation=n,this.backendEvents=s}ngOnInit(){this.subscription=this.backendEvents.ticketReplyCreated.subscribe(t=>{this.conversation.get().id===t.ticket_id&&(t.animated=!0,this.conversation.replies.add(t))})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}ngAfterViewInit(){o&&o.highlightAll()}update(t){this.modal.open(s.a,{reply:t},{panelClass:"update-reply-modal-container"}).afterClosed().subscribe(t=>{t&&this.conversation.replies.replace(t)})}maybeDeleteReply(t){this.modal.show(a.a,{reply:t}).afterClosed().subscribe(e=>{e&&this.conversation.replies.delete(t)})}editDraft(t){this.conversation.setDraft(t),this.conversation.openEditor(),this.conversation.replies.remove(t.id)}showOriginalEmail(t){const e="show-original-reply-modal-container";this.tickets.getOriginalEmailForReply(t.id).subscribe(t=>{this.modal.open(n.a,{original:t.data},{panelClass:e})},()=>{this.modal.open(n.a,null,{panelClass:e})})}removeAttachment(t,e){t.uploads=t.uploads.filter(t=>t.id!==e.id),this.tickets.updateReply(t.id,{uploads:t.uploads.map(t=>t.id)}).subscribe(()=>{},()=>{})}}return t.\u0275fac=function(e){return new(e||t)(r.Ob(c.a),r.Ob(l.a),r.Ob(d.a),r.Ob(b.a),r.Ob(u.a))},t.\u0275cmp=r.Ib({type:t,selectors:[["conversation-replies"]],inputs:{textEditor:"textEditor"},decls:2,vars:1,consts:[[1,"thread"],["ngFor","",3,"ngForOf"],["class","reply animated",3,"bounce","ngClass","my-reply",4,"ngIf"],[1,"reply","animated",3,"ngClass"],["class","user-avatar",3,"src","alt",4,"ngIf"],[1,"reply-body"],[1,"message-header"],[1,"customer"],[1,"customer-name"],["trans","",4,"ngIf"],[4,"ngIf"],["class","text-gray action-text","trans","",4,"ngIf"],["class","draft-actions",4,"ngIf"],[1,"meta"],[1,"date"],[1,"reply-actions-menu"],["replyActionsMenu","matMenu"],["mat-menu-item","","trans","",1,"update-reply-button",3,"click"],["mat-menu-item","","trans","",1,"delete-reply-button",3,"click"],["mat-menu-item","","trans","",1,"show-original-reply-button",3,"click"],[1,"message-body",3,"innerHTML"],[3,"attachments","detached",4,"ngIf"],[1,"user-avatar",3,"src","alt"],["trans",""],["trans","",1,"text-gray","action-text"],[1,"draft-actions"],["type","button","trans","",1,"no-style","edit-draft-button",3,"click"],["type","button","trans","",1,"no-style","delete-draft-button",3,"click"],["mat-icon-button","",3,"matMenuTriggerFor"],["svgIcon","more-vert"],[3,"attachments","detached"]],template:function(t,e){1&t&&(r.Ub(0,"div",0),r.Ic(1,L,1,1,"ng-template",1),r.Tb()),2&t&&(r.Bb(1),r.nc("ngForOf",e.conversation.replies.get()))},directives:[h.s,h.t,h.q,p.e,p.b,g.a,f.b,p.d,m.a,v.a],styles:["conversation-replies{display:block;width:100%}conversation-replies .reply{display:flex;padding:25px;border-top:1px solid var(--be-divider-default)}conversation-replies .reply.notes{background-color:#fffcea;color:#836f60;border-left:3px solid #c8bcb4}conversation-replies .reply.drafts{border-left:3px solid var(--be-accent-default)}conversation-replies .reply.drafts .customer .text-gray{color:var(--be-accent-default)}conversation-replies .reply:last-of-type{border-bottom:1px solid var(--be-divider-default)}conversation-replies .reply .user-avatar{flex:0 0 50px;display:block;width:50px;height:50px;margin-right:20px;-o-object-fit:cover;object-fit:cover;border-radius:4px}conversation-replies .reply .reply-body{flex:1 1 auto;max-width:calc(100% - 70px)}conversation-replies .reply reply-attachment-list{border-top:1px dotted var(--be-divider-default);margin:20px 0 0;padding-top:20px;display:inline-flex}conversation-replies .reply reply-attachment-list>.attachments-list-item:last-of-type{margin-right:0}conversation-replies .message-header{font-size:1.65rem;margin-bottom:15px;display:flex}conversation-replies .message-header .customer{flex:1 1 auto}conversation-replies .message-header .customer .draft-actions{margin-left:10px;vertical-align:text-bottom}conversation-replies .message-header .customer .draft-actions button{border:1px solid var(--be-divider-default);padding:5px 8px;font-size:1.2rem;border-radius:3px;margin-right:6px}conversation-replies .message-header .customer .draft-actions button:hover{background-color:#f7f7f7}conversation-replies .message-header .meta{flex:0 0 100px;color:var(--be-secondary-text);font-size:1.2rem;font-weight:500;margin-right:5px;text-align:right;white-space:nowrap;line-height:23px}conversation-replies .message-header .customer-name{text-transform:capitalize;font-weight:500;color:var(--be-help-center-title-text)}conversation-replies .message-header .text-gray{color:var(--be-secondary-text)}conversation-replies .message-body{max-width:90%;word-wrap:break-word;overflow-x:hidden}conversation-replies .message-body a:hover{text-decoration:underline}conversation-replies .message-body img{max-width:100%}"],encapsulation:2}),t})()},"45UC":function(t,e,i){"use strict";i.d(e,"a",(function(){return g}));var n=i("wWhK"),s=i("LsVx"),a=i("1V5l"),o=i("KHpT"),r=i("ehXJ"),c=i("/RwR"),l=i("0IaG"),d=i("fXoL"),b=i("QGXG"),u=i("wfim"),h=i("tyNb");function p(t,e){if(1&t){const t=d.Vb();d.Ub(0,"button",4),d.bc("click",(function(){return d.zc(t),d.fc().mergeTickets()})),d.Kc(1,"Merge"),d.Tb()}}let g=(()=>{class t{constructor(t,e,i,n,s,a,o){this.dialogRef=t,this.data=e,this.tickets=i,this.modal=n,this.conversation=s,this.tags=a,this.router=o,this.hydrate()}close(t){this.dialogRef.close(t)}openTicket(){this.modal.closeAll(),this.router.navigate(["/mailbox/tickets",this.conversation.get().id],{queryParams:{tagId:this.conversation.getStatus().id}})}mergeTickets(){this.modal.show(c.a,{title:"Merge Tickets",body:"Are you sure you want merge this ticket with the original one behind the pop-ups?",bodyBold:"Merged tickets can not be unmerged.",ok:"Merge"}).afterClosed().subscribe(t=>{t&&this.tickets.merge(this.activeTicketId,this.conversation.get().id).subscribe(t=>{this.close(t),this.tags.refresh()})})}hydrate(){this.activeTicketId=this.data.activeTicketId,this.tickets.get(this.data.ticketId).subscribe(t=>{this.conversation.init(t.ticket)})}}return t.\u0275fac=function(e){return new(e||t)(d.Ob(l.h),d.Ob(l.a),d.Ob(s.a),d.Ob(b.a),d.Ob(n.a),d.Ob(u.a),d.Ob(h.f))},t.\u0275cmp=d.Ib({type:t,selectors:[["conversation-modal"]],features:[d.Ab([s.a,n.a,a.a,o.a,r.a])],decls:5,vars:3,consts:[[3,"hideSidebar","hideBackButton"],["toolbar-content","",1,"no-style","icon-button","action",3,"click"],["svgIcon","open-in-browser-custom"],["class","merge-button","mat-raised-button","","color","accent","trans","",3,"click",4,"ngIf"],["mat-raised-button","","color","accent","trans","",1,"merge-button",3,"click"]],template:function(t,e){1&t&&(d.Ub(0,"mat-dialog-content"),d.Ub(1,"conversation",0),d.Ub(2,"button",1),d.bc("click",(function(){return e.openTicket()})),d.Pb(3,"mat-icon",2),d.Tb(),d.Tb(),d.Ic(4,p,2,0,"button",3),d.Tb()),2&t&&(d.Bb(1),d.nc("hideSidebar",!0)("hideBackButton",!0),d.Bb(3),d.nc("ngIf",e.activeTicketId))},styles:[".conversation-modal-container{width:80%;height:calc(100% - 50px)}.conversation-modal-container .mat-dialog-container,.conversation-modal-container .mat-dialog-content,.conversation-modal-container conversation-modal{height:100%;max-height:100%;margin:0;padding:0}.conversation-modal-container .merge-button{position:absolute;top:10px;left:300px}"],encapsulation:2}),t})()},"9VjZ":function(t,e,i){"use strict";i.d(e,"a",(function(){return k}));var n=i("fXoL"),s=i("tyNb"),a=i("oVOl"),o=i("twBr"),r=i("wWhK"),c=i("j/pe"),l=i("pfRy"),d=i("b7Mq"),b=i("qH/R"),u=i("3H9V"),h=i("ofXK"),p=i("FBzJ"),g=i("H4ap");const f=["scrollContainer"];function m(t,e){1&t&&n.Pb(0,"conversation-sidebar")}const v=[[["","toolbar-content",""]]],y=["[toolbar-content]"];let k=(()=>{class t{constructor(t,e,i,n,s){this.route=t,this.uploads=e,this.currentUser=i,this.conversation=n,this.el=s,this.hideBackButton=!1,this.hideSidebar=!1}ngAfterViewInit(){this.conversation.scrollContainer=this.scrollContainer.nativeElement}ngOnInit(){this.route.data.subscribe(t=>{this.conversation.init(t.ticket),this.el.nativeElement.focus()})}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(s.a),n.Ob(a.a),n.Ob(o.a),n.Ob(r.a),n.Ob(n.l))},t.\u0275cmp=n.Ib({type:t,selectors:[["conversation"]],viewQuery:function(t,e){var i;1&t&&n.Rc(f,!0),2&t&&n.vc(i=n.cc())&&(e.scrollContainer=i.first)},inputs:{hideBackButton:"hideBackButton",hideSidebar:"hideSidebar"},ngContentSelectors:y,decls:11,vars:3,consts:[[1,"conversation-container"],[3,"hideBackButton"],["conversationInfiniteScroll","",1,"ticket-container"],["scrollContainer",""],[4,"ngIf"],[1,"overlay",3,"isVisible"]],template:function(t,e){1&t&&(n.mc(v),n.Sb(0),n.Ub(1,"div",0),n.Ub(2,"conversation-toolbar",1),n.lc(3),n.Tb(),n.Ub(4,"div",2,3),n.Pb(6,"conversation-header"),n.Pb(7,"conversation-text-editor"),n.Pb(8,"conversation-replies"),n.Tb(),n.Tb(),n.Ic(9,m,1,0,"conversation-sidebar",4),n.Rb(),n.Pb(10,"loading-indicator",5)),2&t&&(n.Bb(2),n.nc("hideBackButton",e.hideBackButton),n.Bb(7),n.nc("ngIf",!e.hideSidebar),n.Bb(1),n.nc("isVisible",e.conversation.replies.isLoading||e.conversation.isLoading))},directives:[c.a,l.a,d.a,b.a,u.a,h.t,p.a,g.a],styles:["conversation{display:flex;position:relative}conversation .conversation-container{flex:1 1 auto;min-width:0;height:calc(100vh - 70px);overflow:auto}conversation .conversation-container.invisible{visibility:hidden}conversation .ticket-container{display:flex;flex-direction:column;height:calc(100% - 60px);overflow:auto}"],encapsulation:2}),t})()},Dbf7:function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var n=i("EY2u"),s=i("LRne"),a=i("JIr8"),o=i("5+tZ"),r=i("fXoL"),c=i("LsVx"),l=i("tyNb");let d=(()=>{class t{constructor(t,e){this.tickets=t,this.router=e}resolve(t,e){return this.tickets.get(+(t.params.ticket_id||t.params.id)).pipe(Object(a.a)(()=>(this.router.navigate(["/help-center/tickets"]),n.a)),Object(o.a)(t=>t.ticket?Object(s.a)(t.ticket):(this.router.navigate(["/help-center/tickets"]),n.a)))}}return t.\u0275fac=function(e){return new(e||t)(r.Yb(c.a),r.Yb(l.f))},t.\u0275prov=r.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},DldP:function(t,e,i){"use strict";i.d(e,"a",(function(){return mt}));var n=i("ofXK"),s=i("3Pt+"),a=i("tyNb"),o=i("j/pe"),r=i("b7Mq"),c=i("3H9V"),l=i("qH/R"),d=i("H4ap"),b=i("qaug"),u=i("45UC"),h=i("9VjZ"),p=i("aV6R"),g=i("PPfr"),f=i("lxqa"),m=i("yS8O"),v=i("X3Ra"),y=i("wWhK"),k=i("Dbf7"),T=i("2qZP"),x=i("EzZJ"),w=i("LsVx"),I=i("IgbF"),U=i("7T94"),O=i("1V5l"),B=i("KHpT"),C=i("ehXJ"),K=i("apsj"),L=i("YHvm"),R=i("Bf/s"),S=i("0IaG"),P=i("MK/P"),F=i("gFpt"),E=i("NFeN"),D=i("STbY"),z=i("bTqV"),M=i("6rvT"),A=i("k3xQ"),_=i("Qu3c"),V=i("X3pI"),j=i("JZOH"),N=i("GSRO"),X=i("pfRy"),q=i("A5z7"),Q=i("fXoL"),Y=i("KKQg"),$=i("ovFL"),G=i("N2vX"),H=i("/zh3"),J=i("nQeM"),W=i("Rd8u"),Z=i("FBzJ"),tt=i("DB1O"),et=i("83jf"),it=i("mrSG"),nt=i("Lm4C"),st=i("sgCb");function at(t,e=[]){return Object(it.a)(this,void 0,void 0,(function*(){const i=yield(n=t,new Promise(t=>{n.createReader().readEntries(e=>t(e))}));var n;for(const t in i){const n=i[t];n.isDirectory?yield at(n,e):e.push(yield ot(n))}return e}))}function ot(t){return new Promise(e=>{t.file(i=>{e(new st.a(i,t.fullPath))})})}let rt=(()=>{class t{constructor(t){this.el=t,this.disableDropzoneClick=!1,this.disableDropzone=!1,this.uploadConfig={},this.filesDropped=new Q.n}ngOnInit(){const t=this.el.nativeElement;t.addEventListener("dragenter",t=>this.handleDragEnter(t)),t.addEventListener("dragover",t=>this.handleDragOver(t)),t.addEventListener("dragleave",t=>this.handleDragLeave(t)),t.addEventListener("drop",t=>this.handleDrop(t)),this.disableDropzoneClick||(this.clickButton?this.clickButton.nativeElement:t).addEventListener("click",()=>this.handleClick())}ngOnDestroy(){this.removeClassesFromDropzone()}handleClick(){this.disableDropzone||Object(nt.a)(this.uploadConfig).then(t=>{this.emitUploadEvent(t)})}handleDragEnter(t){this.dropzoneDisabled(t)||this.el.nativeElement.classList.add("file-over-dropzone")}handleDragOver(t){return t.preventDefault&&t.preventDefault(),t.dataTransfer.dropEffect=this.dropzoneDisabled(t)?"none":"move",!1}handleDragLeave(t){const e=document.elementFromPoint(t.clientX,t.clientY);this.el.nativeElement.contains(e)||this.removeClassesFromDropzone()}handleDrop(t){return Object(it.a)(this,void 0,void 0,(function*(){if(t.stopPropagation(),t.preventDefault(),this.removeClassesFromDropzone(),this.dropzoneDisabled(t)||!t.dataTransfer.items)return;const e=Array.from(t.dataTransfer.items).filter(t=>"file"===t.kind).map(t=>t.webkitGetAsEntry());e.length&&this.emitUploadEvent(yield function(t){return Object(it.a)(this,void 0,void 0,(function*(){let e=[];for(const i in t){const n=t[i];n.isDirectory?e=e.concat(yield at(n)):e.push(yield ot(n))}return e}))}(e))}))}emitUploadEvent(t){this.filesDropped.emit(t)}removeClassesFromDropzone(){this.el.nativeElement.classList.remove("file-over-dropzone")}dropzoneDisabled(t){const e=t.dataTransfer.types.find(t=>"files"===t.toLowerCase());return this.disableDropzone||!e}}return t.\u0275fac=function(e){return new(e||t)(Q.Ob(Q.l))},t.\u0275dir=Q.Jb({type:t,selectors:[["","fileDropzone",""]],inputs:{disableDropzoneClick:"disableDropzoneClick",disableDropzone:"disableDropzone",clickButton:"clickButton",uploadConfig:["fileDropzone","uploadConfig"]},outputs:{filesDropped:"filesDropped"}}),t})();var ct=i("DzUk"),lt=i("rG4v"),dt=i("XRKU"),bt=i("cH1L"),ut=i("vxfF"),ht=i("zW5C"),pt=i("iB19"),gt=i("6SKC"),ft=i("sTxL");let mt=(()=>{class t{}return t.\u0275mod=Q.Mb({type:t}),t.\u0275inj=Q.Lb({factory:function(e){return new(e||t)},providers:[v.a,y.a,B.a,w.a,K.a,k.a,I.a,O.a,C.a],imports:[[n.c,s.o,s.E,a.j,L.a,R.a,F.a,M.a,A.a,V.a,j.a,N.a,P.a,_.b,S.g,E.b,D.c,z.c,q.g]]}),t})();Q.Dc(u.a,[n.q,n.r,n.s,n.t,n.A,n.w,n.x,n.y,n.z,n.u,n.v,s.K,s.z,s.J,s.d,s.A,s.D,s.a,s.G,s.H,s.C,s.u,s.v,s.F,s.q,s.p,s.B,s.b,s.e,s.x,s.y,s.w,s.j,s.m,s.k,s.n,s.g,a.k,a.g,a.i,a.h,a.l,Y.a,$.a,G.a,H.a,J.a,W.a,Z.a,tt.a,et.a,rt,ct.a,lt.a,dt.a,_.a,_.c,bt.b,ut.a,S.e,S.d,S.i,S.f,S.c,E.a,D.e,D.b,D.d,D.a,z.b,z.a,q.d,q.a,q.c,q.e,q.b,q.f,o.a,r.a,c.a,l.a,d.a,b.a,u.a,h.a,p.a,U.a,g.a,f.a,m.a,T.a,x.a,X.a],[n.b,n.G,n.p,n.k,n.E,n.g,n.C,n.F,n.d,n.f,n.i,n.j,n.l,ht.a,pt.a,gt.a,ft.a])},EzZJ:function(t,e,i){"use strict";i.d(e,"a",(function(){return p}));var n=i("fXoL"),s=i("3Pt+"),a=i("Kj3r"),o=i("/uUt"),r=i("STbY"),c=i("LsVx"),l=i("IgbF"),d=i("i2dy"),b=i("NFeN"),u=i("ofXK");function h(t,e){if(1&t){const t=n.Vb();n.Ub(0,"button",7),n.bc("click",(function(){n.zc(t);const i=e.$implicit;return n.fc().addTag(i.name)})),n.Kc(1),n.Tb()}if(2&t){const t=e.$implicit;n.Bb(1),n.Lc(t.name)}}let p=(()=>{class t{constructor(t,e,i){this.tickets=t,this.tagService=e,this.toast=i,this.ticketIds=[],this.tagAdded=new n.n,this.tagQuery=new s.i,this.searchedOnce=!1,this.trackByFn=(t,e)=>e.id}ngOnInit(){this.bindTagQueryInput(),this.trigger.menuOpened.subscribe(()=>{this.searchedOnce||this.searchForTags(null,{perPage:5})}),this.trigger.menuClosed.subscribe(()=>{this.clearSearchField()})}open(){this.trigger.openMenu()}close(){this.trigger.closeMenu()}addTag(t){this.tickets.addTag(t,this.ticketIds).subscribe(t=>{this.clearSearchField(),this.toast.open("Tag added"),this.tagAdded.emit(t.data),this.close()})}clearSearchField(){this.tagQuery.value&&this.tagQuery.setValue(null)}bindTagQueryInput(){this.tagQuery.valueChanges.pipe(Object(a.a)(300),Object(o.a)()).subscribe(t=>{this.searchForTags(t)})}searchForTags(t,e={}){this.tagService.search(t,e).subscribe(t=>this.tags=t.pagination.data)}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(c.a),n.Ob(l.a),n.Ob(d.b))},t.\u0275cmp=n.Ib({type:t,selectors:[["add-tag-dropdown"]],viewQuery:function(t,e){var i;1&t&&n.Gc(r.d,!0),2&t&&n.vc(i=n.cc())&&(e.trigger=i.first)},inputs:{ticketIds:"ticketIds"},outputs:{tagAdded:"tagAdded"},decls:7,vars:5,consts:[[1,"no-style","add-tag-button","toolbar-item",3,"matMenuTriggerFor"],["svgIcon","add-tag-custom"],[1,"add-tag-menu",3,"overlapTrigger"],["addTagMenu","matMenu"],[1,"input-container",3,"ngSubmit","click"],["type","text","mat-menu-item","",1,"tag-search-input",3,"formControl"],["mat-menu-item","","class","tag-item",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],["mat-menu-item","",1,"tag-item",3,"click"]],template:function(t,e){if(1&t&&(n.Ub(0,"button",0),n.Pb(1,"mat-icon",1),n.Tb(),n.Ub(2,"mat-menu",2,3),n.Ub(4,"form",4),n.bc("ngSubmit",(function(){return e.addTag(e.tagQuery.value)}))("click",(function(t){return t.stopPropagation()})),n.Pb(5,"input",5),n.Tb(),n.Ic(6,h,2,1,"button",6),n.Tb()),2&t){const t=n.wc(3);n.nc("matMenuTriggerFor",t),n.Bb(2),n.nc("overlapTrigger",!1),n.Bb(3),n.nc("formControl",e.tagQuery),n.Bb(1),n.nc("ngForOf",e.tags)("ngForTrackBy",e.trackByFn)}},directives:[r.d,b.a,r.e,s.K,s.v,s.w,s.d,r.b,s.u,s.j,u.s],styles:["[_nghost-%COMP%]{position:relative;display:inline-block}.input-container[_ngcontent-%COMP%]{padding:2px 10px 10px}.mat-menu-item[_ngcontent-%COMP%]:first-of-type{border-top:1px solid var(--be-divider-default)}"]}),t})()},H4ap:function(t,e,i){"use strict";i.d(e,"a",(function(){return L}));var n=i("45UC"),s=i("8RV8"),a=i("fXoL"),o=i("QGXG"),r=i("LsVx"),c=i("wWhK"),l=i("tyNb"),d=i("i2dy"),b=i("ofXK"),u=i("Rd8u"),h=i("NFeN"),p=i("bTqV"),g=i("STbY"),f=i("A5z7"),m=i("Qu3c"),v=i("zW5C"),y=i("iB19");function k(t,e){if(1&t&&(a.Ub(0,"mat-chip",26),a.Kc(1),a.Tb()),2&t){const t=e.$implicit;a.Bb(1),a.Lc(t.display_name)}}function T(t,e){if(1&t&&(a.Ub(0,"div",23),a.Ub(1,"mat-chip-list",24),a.Ic(2,k,2,1,"mat-chip",25),a.Tb(),a.Tb()),2&t){const t=a.fc(2);a.Bb(1),a.nc("selectable",!1),a.Bb(1),a.nc("ngForOf",t.requester.tags)}}function x(t,e){if(1&t&&(a.Ub(0,"div",15),a.Pb(1,"mat-icon",34),a.Ub(2,"a",35),a.Kc(3),a.Tb(),a.Tb()),2&t){const t=a.fc(3);a.Bb(2),a.nc("href","https://codecanyon.net/user/"+t.envatoPurchase.envato_username,a.Cc)("title",t.envatoPurchase.envato_username),a.Bb(1),a.Lc(t.envatoPurchase.envato_username)}}function w(t,e){if(1&t&&(a.Ub(0,"div",36),a.gc(1,"trans"),a.Pb(2,"mat-icon",37),a.Ub(3,"span"),a.Kc(4),a.gc(5,"formattedDate"),a.Tb(),a.Tb()),2&t){const t=a.fc(3);a.nc("matTooltip",a.hc(1,2,"Supported until")),a.Bb(4),a.Lc(a.hc(5,4,t.envatoPurchase.supported_until))}}function I(t,e){if(1&t&&(a.Ub(0,"div",38),a.Pb(1,"img",39),a.Ub(2,"div",40),a.Kc(3),a.Tb(),a.Tb()),2&t){const t=e.$implicit;a.Bb(1),a.nc("src",t.image,a.Cc),a.Bb(2),a.Lc(t.item_name)}}function U(t,e){if(1&t&&(a.Ub(0,"div",27),a.Ub(1,"div",28),a.Ub(2,"span",29),a.Kc(3,"Envato"),a.Tb(),a.Tb(),a.Ic(4,x,4,3,"div",30),a.Ic(5,w,6,6,"div",31),a.Ub(6,"div",32),a.Ic(7,I,4,2,"div",33),a.gc(8,"slice"),a.Tb(),a.Tb()),2&t){const t=a.fc(2);a.Bb(4),a.nc("ngIf",t.envatoPurchase.envato_username),a.Bb(1),a.nc("ngIf",t.envatoPurchase.supported_until),a.Bb(2),a.nc("ngForOf",a.jc(8,3,t.requester.purchase_codes,0,5))}}const O=function(t){return["/mailbox/users",t]};function B(t,e){if(1&t){const t=a.Vb();a.Ub(0,"div",7),a.Ub(1,"a",8),a.Pb(2,"img",9),a.Tb(),a.Ub(3,"div",10),a.Ub(4,"div",11),a.Ub(5,"div",12),a.Kc(6),a.Tb(),a.Ub(7,"button",13),a.Pb(8,"mat-icon",14),a.Tb(),a.Tb(),a.Ub(9,"div",15),a.Pb(10,"mat-icon",16),a.Ub(11,"span",17),a.Kc(12),a.Tb(),a.Tb(),a.Ub(13,"mat-menu",null,18),a.Ub(15,"a",19),a.Kc(16,"Edit Profile"),a.Tb(),a.Ub(17,"button",20),a.bc("click",(function(){return a.zc(t),a.fc().changeCustomer()})),a.Kc(18,"Change Customer"),a.Tb(),a.Tb(),a.Ic(19,T,3,2,"div",21),a.Ic(20,U,9,7,"div",22),a.Tb(),a.Tb()}if(2&t){const t=a.wc(14),e=a.fc();a.Bb(1),a.nc("routerLink",a.sc(10,O,e.requester.id)),a.Bb(1),a.nc("src",e.requester.avatar,a.Cc),a.Bb(3),a.nc("title",e.requester.display_name),a.Bb(1),a.Lc(e.requester.display_name),a.Bb(1),a.nc("matMenuTriggerFor",t),a.Bb(4),a.nc("title",e.requester.email),a.Bb(1),a.Lc(e.requester.email),a.Bb(3),a.nc("routerLink",a.sc(12,O,e.requester.id)),a.Bb(4),a.nc("ngIf",e.requester.tags.length),a.Bb(1),a.nc("ngIf",e.envatoPurchase)}}function C(t,e){if(1&t){const t=a.Vb();a.Ub(0,"div",43),a.bc("click",(function(){a.zc(t);const i=e.$implicit;return a.fc(2).openTicketModal(i.id)})),a.Pb(1,"mat-icon",16),a.Ub(2,"span"),a.Kc(3),a.Tb(),a.Tb()}if(2&t){const t=e.$implicit;a.Fb("open",!t.closed_at),a.Bb(3),a.Lc(t.subject)}}function K(t,e){if(1&t&&(a.Ub(0,"div",41),a.Ic(1,C,4,3,"div",42),a.Tb()),2&t){const t=a.fc();a.Bb(1),a.nc("ngForOf",t.otherTickets)}}let L=(()=>{class t{constructor(t,e,i,n,s){this.modal=t,this.tickets=e,this.conversation=i,this.route=n,this.toast=s,this.previousTicketsVisible=!0}ngOnInit(){this.route.data.subscribe(t=>{this.activeTicket=t.ticket,this.loadUserData()})}openTicketModal(t){const e={ticketId:t,activeTicketId:this.conversation.get().id};this.modal.open(n.a,e,{panelClass:"conversation-modal-container"}).afterClosed().subscribe(e=>{e&&(this.otherTickets=this.otherTickets.filter(e=>e.id!==t),this.conversation.init(e))})}getUserTicketsExceptCurrent(){this.requester&&this.tickets.getTickets({userId:this.requester.id,perPage:6}).subscribe(t=>{this.otherTickets=t.pagination.data.filter(t=>t.id!==this.activeTicket.id)})}setEnvatoPurchase(){const t=this.conversation.getCategory();if(this.requester.purchase_codes.length){if(t){const i=t.name.toLowerCase();var e=this.requester.purchase_codes.find(t=>t.item_name.toLowerCase().indexOf(i)>-1)}this.envatoPurchase=e||this.requester.purchase_codes[0]}}changeCustomer(){this.modal.open(s.a).beforeClosed().subscribe(t=>{t&&this.tickets.update(this.activeTicket.id,{user_id:t.id}).subscribe(()=>{this.requester=t,this.loadUserData(),this.toast.open("Customer changed.")})})}loadUserData(){this.requester=this.activeTicket.user,this.getUserTicketsExceptCurrent(),this.setEnvatoPurchase()}}return t.\u0275fac=function(e){return new(e||t)(a.Ob(o.a),a.Ob(r.a),a.Ob(c.a),a.Ob(l.a),a.Ob(d.b))},t.\u0275cmp=a.Ib({type:t,selectors:[["conversation-sidebar"]],decls:8,vars:4,consts:[["class","user-info",4,"ngIf"],[1,"tickets-list-container"],[1,"title",3,"click"],["trans","",1,"text"],[1,"no-style","toggle-button"],["svgIcon","keyboard-arrow-down"],["class","tickets-list toggle-container",4,"ngIf"],[1,"user-info"],[1,"avatar",3,"routerLink"],["alt","Avatar",3,"src"],[1,"user-details"],[1,"name"],[1,"text",3,"title"],["mat-icon-button","",3,"matMenuTriggerFor"],["svgIcon","settings"],[1,"info-line"],["svgIcon","mail"],[3,"title"],["editCustomerMenu","matMenu"],["mat-menu-item","","trans","",3,"routerLink"],["mat-menu-item","","trans","",3,"click"],["class","user-tags",4,"ngIf"],["class","info-container",4,"ngIf"],[1,"user-tags"],[3,"selectable"],["class","mat-compact-chip",4,"ngFor","ngForOf"],[1,"mat-compact-chip"],[1,"info-container"],[1,"info-title"],["trans",""],["class","info-line",4,"ngIf"],["class","info-line",3,"matTooltip",4,"ngIf"],[1,"envato-purchases"],["class","purchase-item",4,"ngFor","ngForOf"],["svgIcon","person"],["target","_blank",3,"href","title"],[1,"info-line",3,"matTooltip"],["svgIcon","access-time"],[1,"purchase-item"],["alt","Purchase image",3,"src"],[1,"purchase-name"],[1,"tickets-list","toggle-container"],["class","ticket",3,"open","click",4,"ngFor","ngForOf"],[1,"ticket",3,"click"]],template:function(t,e){1&t&&(a.Ic(0,B,21,14,"div",0),a.Ub(1,"div",1),a.Ub(2,"div",2),a.bc("click",(function(){return e.previousTicketsVisible=!e.previousTicketsVisible})),a.Ub(3,"span",3),a.Kc(4,"Other Conversations"),a.Tb(),a.Ub(5,"button",4),a.Pb(6,"mat-icon",5),a.Tb(),a.Tb(),a.Ic(7,K,2,1,"div",6),a.Tb()),2&t&&(a.nc("ngIf",e.requester),a.Bb(1),a.Fb("tickets-visible",e.previousTicketsVisible),a.Bb(6),a.nc("ngIf",e.otherTickets))},directives:[b.t,u.a,h.a,l.i,p.b,g.d,g.e,g.b,f.d,b.s,f.a,m.a],pipes:[b.E,v.a,y.a],styles:["conversation-sidebar{display:block;flex:0 0 240px;width:240px;background-color:var(--be-background-alternative);border-left:1px solid var(--be-divider-default)}@media screen and (max-width:768px){conversation-sidebar{display:none}}conversation-sidebar .user-tags{margin-top:10px}conversation-sidebar .user-info{margin:15px 15px 10px;border-bottom:1px solid var(--be-divider-default);padding-bottom:10px}conversation-sidebar .user-info .avatar{display:block;width:100%;text-align:center;margin-bottom:10px}conversation-sidebar .user-info .avatar img{max-width:55px;max-height:65px;margin:0 auto;border-radius:4px}conversation-sidebar .user-info .user-details{color:var(--be-secondary-text)}conversation-sidebar .user-info .user-details a{color:inherit}conversation-sidebar .user-info .user-details .name{display:flex;align-items:center;font-size:1.7rem;max-height:24px}conversation-sidebar .user-info .user-details .name .text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}conversation-sidebar .user-info .user-details .name .mat-icon-button{margin-left:auto;color:var(--be-secondary-text);flex-shrink:0}conversation-sidebar .user-info .user-details .info-container{margin-top:10px;padding-top:10px;border-top:1px solid var(--be-divider-default)}conversation-sidebar .user-info .user-details .envato-purchases{margin-top:15px}conversation-sidebar .user-info .user-details .purchase-item{display:flex;align-items:center;white-space:nowrap;margin-bottom:8px}conversation-sidebar .user-info .user-details .purchase-item img{width:25px;height:25px;margin-right:8px;border-radius:4px}conversation-sidebar .user-info .user-details .purchase-item .purchase-name{max-width:calc(100% - 30px);overflow:hidden;text-overflow:ellipsis}conversation-sidebar .user-info .user-details .info-title{margin-bottom:4px;font-weight:500}conversation-sidebar .user-info .user-details .info-line{padding:3px 0;overflow:hidden;text-overflow:ellipsis}conversation-sidebar .user-info .user-details .mat-icon{vertical-align:middle;width:18px;height:18px;margin-right:2px}conversation-sidebar .tickets-list-container{padding:0 15px}conversation-sidebar .tickets-list-container .title{position:relative;cursor:pointer}conversation-sidebar .tickets-list-container .title .toggle-button{position:absolute;right:0;top:-2px;color:var(--be-secondary-text)}conversation-sidebar .tickets-list-container .title .toggle-button .mat-icon{transition:all .3s ease}conversation-sidebar .tickets-list-container .tickets-list{margin-top:15px;display:none}conversation-sidebar .tickets-list-container .tickets-list .ticket{color:var(--be-secondary-text);margin-bottom:15px;cursor:pointer}conversation-sidebar .tickets-list-container .tickets-list .ticket .mat-icon{color:var(--be-secondary-text);width:17px;height:17px;vertical-align:middle;margin-right:3px}conversation-sidebar .tickets-list-container .tickets-list .ticket:hover{text-decoration:underline;color:var(--be-text)}conversation-sidebar .tickets-list-container .tickets-list .ticket.open{color:var(--be-text)}conversation-sidebar .tickets-list-container.tickets-visible .tickets-list{display:block}conversation-sidebar .tickets-list-container.tickets-visible .toggle-button .mat-icon{display:inline-block;transform:rotate(180deg)}"],encapsulation:2}),t})()},KHpT:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i("fXoL"),s=i("LsVx"),a=i("i2dy");let o=(()=>{class t{constructor(t,e){this.tickets=t,this.toast=e,this.replies=[],this.currentPage=1,this.lastPage=2,this.isLoading=!1}get(){return this.replies}add(t){t&&t.id&&(this.replies.find(e=>e.id===t.id)||this.replies.unshift(t))}replace(t){const e=this.replies.findIndex(e=>e.id===t.id);this.replies[e]=t}remove(t){this.replies=this.replies.filter(e=>e.id!==t)}delete(t){this.tickets["drafts"===t.type?"deleteDraft":"deleteReply"](t.id).subscribe(()=>{this.remove(t.id),this.toast.open("Deleted successfully")})}loadMore(){this.isLoading||(this.isLoading=!0,this.tickets.getTicketReplies(this.ticketId,this.currentPage+1).subscribe(t=>{this.replies=this.replies.concat(t.pagination.data),this.currentPage=t.pagination.current_page,this.lastPage=t.pagination.last_page,this.isLoading=!1},()=>{this.isLoading=!1}))}canLoadMore(){return this.currentPage<this.lastPage}init(t,e){this.replies=t.slice(),this.currentPage=1,this.lastPage=2,this.ticketId=e}}return t.\u0275fac=function(e){return new(e||t)(n.Yb(s.a),n.Yb(a.b))},t.\u0275prov=n.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},PPfr:function(t,e,i){"use strict";i.d(e,"a",(function(){return K}));var n=i("fXoL"),s=i("3Pt+"),a=i("cuTO"),o=i("7T94"),r=i("Kj3r"),c=i("/uUt"),l=i("eIep"),d=i("JIr8"),b=i("vkgz"),u=i("STbY"),h=i("hLX6"),p=i("LRne"),g=i("U9CY"),f=i("X3Ra"),m=i("twBr"),v=i("QGXG"),y=i("wWhK"),k=i("i2dy"),T=i("bTqV"),x=i("NFeN"),w=i("ofXK"),I=i("Rd8u");const U=["input"];function O(t,e){if(1&t){const t=n.Vb();n.Ub(0,"button",10),n.bc("click",(function(){return n.zc(t),n.fc().showNewCannedReplyModal()})),n.Ub(1,"strong",11),n.Kc(2,"Create new canned reply"),n.Tb(),n.Tb()}}function B(t,e){if(1&t){const t=n.Vb();n.Ub(0,"button",12),n.bc("click",(function(){n.zc(t);const i=e.$implicit;return n.fc().selectCannedReply(i)})),n.Kc(1),n.Tb()}if(2&t){const t=e.$implicit;n.Bb(1),n.Mc(" ",t.name," ")}}function C(t,e){if(1&t){const t=n.Vb();n.Ub(0,"div",13),n.bc("click",(function(e){return n.zc(t),e.stopPropagation()})),n.Ub(1,"div"),n.Ub(2,"span",11),n.Kc(3,"No results found for"),n.Tb(),n.Ub(4,"strong"),n.Kc(5),n.Tb(),n.Tb(),n.Tb()}if(2&t){const t=n.fc();n.Bb(5),n.Lc(t.searchQuery.value)}}let K=(()=>{class t{constructor(t,e,i,a,o){this.cannedRepliesService=t,this.currentUser=e,this.modal=i,this.conversation=a,this.toast=o,this.searchQuery=new s.i,this.onReplySelect=new n.n,this.loadedResultsAtLeastOnce=!1,this.cannedReplies=[]}ngOnInit(){this.searchQuery.valueChanges.pipe(Object(r.a)(250),Object(c.a)(),Object(l.a)(t=>this.getCannedReplies(t)),Object(d.a)(()=>Object(p.a)(g.a))).subscribe(),this.trigger.menuOpened.subscribe(()=>{this.loadedResultsAtLeastOnce||this.getCannedReplies(null,!0).subscribe()})}selectCannedReply(t){const e=t.body.replace(/{{([\w.\-]+?)}}/,(t,e)=>h.pick(e.toLowerCase(),{ticket:this.conversation.get()})||t);this.onReplySelect.emit(Object.assign(Object.assign({},t),{body:e}))}showNewCannedReplyModal(){const t=new a.a({body:this.conversation.draft.get().body,uploads:this.conversation.draft.get().uploads});this.modal.open(o.a,{cannedReply:t},{panelClass:"crupdate-canned-reply-modal-container"}).afterClosed().subscribe(t=>{t&&(this.toast.open("Canned reply created."),this.cannedReplies.unshift(t))})}getCannedReplies(t,e){if(!t&&!e)return Object(p.a)(g.a);const i={query:t,user_id:this.currentUser.get("id"),perPage:20,shared:!0};return this.cannedRepliesService.getReplies(i).pipe(Object(b.a)(t=>{this.loadedResultsAtLeastOnce=!0,this.cannedReplies=t.pagination.data}))}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(f.a),n.Ob(m.a),n.Ob(v.a),n.Ob(y.a),n.Ob(k.b))},t.\u0275cmp=n.Ib({type:t,selectors:[["canned-replies-dropdown"]],viewQuery:function(t,e){var i;1&t&&(n.Gc(u.d,!0),n.Gc(U,!0)),2&t&&(n.vc(i=n.cc())&&(e.trigger=i.first),n.vc(i=n.cc())&&(e.input=i.first))},inputs:{searchQuery:"searchQuery"},outputs:{onReplySelect:"onReplySelect"},decls:10,vars:6,consts:[["mat-icon-button","",1,"no-style","editor-button",3,"matMenuTriggerFor"],["svgIcon","comment",1,"dropdown-icon"],[1,"canned-reply-menu",3,"overlapTrigger"],["cannedReplyMenu","matMenu"],[1,"input-container",3,"click"],["type","text","mat-menu-item","",1,"canned-reply-search-input",3,"formControl"],["input",""],["class","new-canned-reply","mat-menu-item","","trans","",3,"click",4,"ngIf"],["class","canned-reply","mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["class","no-results",3,"click",4,"ngIf"],["mat-menu-item","","trans","",1,"new-canned-reply",3,"click"],["trans",""],["mat-menu-item","",1,"canned-reply",3,"click"],[1,"no-results",3,"click"]],template:function(t,e){if(1&t&&(n.Ub(0,"button",0),n.Pb(1,"mat-icon",1),n.Tb(),n.Ub(2,"mat-menu",2,3),n.Ub(4,"div",4),n.bc("click",(function(t){return t.stopPropagation()})),n.Pb(5,"input",5,6),n.Tb(),n.Ic(7,O,3,0,"button",7),n.Ic(8,B,2,1,"button",8),n.Ic(9,C,6,1,"div",9),n.Tb()),2&t){const t=n.wc(3);n.nc("matMenuTriggerFor",t),n.Bb(2),n.nc("overlapTrigger",!1),n.Bb(3),n.nc("formControl",e.searchQuery),n.Bb(2),n.nc("ngIf",!e.searchQuery.value),n.Bb(1),n.nc("ngForOf",e.cannedReplies),n.Bb(1),n.nc("ngIf",!e.cannedReplies.length&&e.loadedResultsAtLeastOnce&&e.searchQuery.value)}},directives:[T.b,u.d,x.a,u.e,s.d,u.b,s.u,s.j,w.t,w.s,I.a],styles:["canned-replies-dropdown{display:block}.canned-reply-menu{width:300px}.canned-reply-menu strong{font-weight:500}.canned-reply-menu .input-container{padding:0 10px 10px;border-bottom:1px solid var(--be-divider-default)}.canned-reply-menu .no-results{padding:10px 10px 0;font-size:1.6rem;text-align:center}"],encapsulation:2}),t})()},aV6R:function(t,e,i){"use strict";i.d(e,"a",(function(){return m}));var n=i("KKQg"),s=i("0IaG"),a=i("h586"),o=i("fXoL"),r=i("LsVx"),c=i("Rd8u"),l=i("bTqV"),d=i("NFeN"),b=i("rG4v"),u=i("ofXK"),h=i("83jf");function p(t,e){if(1&t&&(o.Ub(0,"div",11),o.Kc(1),o.Tb()),2&t){const t=o.fc();o.Bb(1),o.Lc(t.errors.body)}}function g(t,e){if(1&t&&(o.Ub(0,"div",11),o.Kc(1),o.Tb()),2&t){const t=o.fc();o.Bb(1),o.Lc(t.errors.attachments)}}function f(t,e){if(1&t){const t=o.Vb();o.Ub(0,"reply-attachment-list",12),o.bc("detached",(function(e){return o.zc(t),o.fc().removeAttachment(e)})),o.Tb()}if(2&t){const t=o.fc();o.nc("attachments",t.attachments)}}let m=(()=>{class t{constructor(t,e,i,n){this.dialogRef=t,this.data=e,this.tickets=i,this.uploadQueue=n,this.attachments=[],this.errors={},this.hydrate()}ngAfterViewInit(){this.textEditor.focus(),this.textEditor.setContents(this.reply.body)}hydrate(){this.reply=Object.assign({},this.data.reply),this.attachments=this.reply.uploads.slice()}close(t){this.dialogRef.close(t),this.textEditor.destroyEditor()}confirm(){const t={body:this.textEditor.getContents(),uploads:this.attachments.map(t=>t.id)};this.tickets.updateReply(this.reply.id,t).subscribe(t=>{this.close(t.data)},t=>this.errors=t.errors)}uploadFiles(t){this.uploadQueue.start(t).subscribe(t=>{this.attachments=[...this.attachments,t.fileEntry]})}removeAttachment(t){for(let e=0;e<this.attachments.length;e++)this.attachments[e].id===t.id&&this.attachments.splice(e,1)}}return t.\u0275fac=function(e){return new(e||t)(o.Ob(s.h),o.Ob(s.a),o.Ob(r.a),o.Ob(a.a))},t.\u0275cmp=o.Ib({type:t,selectors:[["update-reply-modal"]],viewQuery:function(t,e){var i;1&t&&o.Gc(n.a,!0),2&t&&o.vc(i=o.cc())&&(e.textEditor=i.first)},features:[o.Ab([a.a])],decls:17,vars:4,consts:[[1,"modal-header"],["mat-dialog-title","","trans",""],["type","button","mat-icon-button","","tabindex","-1",1,"close-button",3,"click"],["svgIcon","close"],[1,"many-inputs"],[1,"input-container"],["inlineUploadPrefix","ticket_images",3,"minHeight","onFileUpload"],["class","error",4,"ngIf"],[3,"attachments","detached",4,"ngIf"],["type","button","mat-button","","trans","",1,"cancel-button",3,"click"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button",3,"click"],[1,"error"],[3,"attachments","detached"]],template:function(t,e){1&t&&(o.Ub(0,"div",0),o.Ub(1,"h2",1),o.Kc(2,"Update Reply"),o.Tb(),o.Ub(3,"button",2),o.bc("click",(function(){return e.close()})),o.Pb(4,"mat-icon",3),o.Tb(),o.Tb(),o.Ub(5,"mat-dialog-content",4),o.Ub(6,"div",5),o.Ub(7,"text-editor",6),o.bc("onFileUpload",(function(t){return e.uploadFiles(t)})),o.Tb(),o.Pb(8,"upload-progress-bar"),o.Ic(9,p,2,1,"div",7),o.Ic(10,g,2,1,"div",7),o.Ic(11,f,1,1,"reply-attachment-list",8),o.Tb(),o.Tb(),o.Ub(12,"mat-dialog-actions"),o.Ub(13,"button",9),o.bc("click",(function(){return e.close()})),o.Kc(14,"Cancel"),o.Tb(),o.Ub(15,"button",10),o.bc("click",(function(){return e.confirm()})),o.Kc(16,"Update"),o.Tb(),o.Tb()),2&t&&(o.Bb(7),o.nc("minHeight",300),o.Bb(2),o.nc("ngIf",e.errors.body),o.Bb(1),o.nc("ngIf",e.errors.attachments),o.Bb(1),o.nc("ngIf",e.attachments.length))},directives:[s.i,c.a,l.b,d.a,s.f,n.a,b.a,u.t,s.c,h.a],styles:[".update-reply-modal-container{width:600px}.update-reply-modal-container reply-attachment-list{margin-top:15px}"],encapsulation:2}),t})()},apsj:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i("fXoL"),s=i("LRXf");let a=(()=>{class t{constructor(t){this.httpClient=t}attach(t,e=[],i=null){const n={ids:[]};return n.ids=e.map(t=>t.id),i&&(n.body=i),this.httpClient.post("tickets/"+t+"/attachments",n)}detach(t,e){return this.httpClient.post("drafts/"+t+"/uploads/"+e+"/detach")}}return t.\u0275fac=function(e){return new(e||t)(n.Yb(s.a))},t.\u0275prov=n.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},b7Mq:function(t,e,i){"use strict";i.d(e,"a",(function(){return f}));var n=i("fXoL"),s=i("LsVx"),a=i("twBr"),o=i("wfim"),r=i("wWhK"),c=i("A5z7"),l=i("ofXK"),d=i("Qu3c"),b=i("NFeN"),u=i("zW5C");function h(t,e){1&t&&(n.Ub(0,"mat-icon",13),n.Kc(1,"cancel"),n.Tb())}function p(t,e){if(1&t){const t=n.Vb();n.Ub(0,"mat-chip",11),n.bc("removed",(function(){n.zc(t);const e=n.fc().$implicit;return n.fc().removeTag(e)})),n.Kc(1),n.Ic(2,h,2,0,"mat-icon",12),n.Tb()}if(2&t){const t=n.fc().$implicit,e=n.fc();n.nc("removable",e.currentUser.hasPermission("tickets.update")),n.Bb(1),n.Mc(" ",t.display_name," "),n.Bb(1),n.nc("ngIf",e.currentUser.hasPermission("tickets.update"))}}function g(t,e){if(1&t&&(n.Sb(0),n.Ic(1,p,3,3,"mat-chip",10),n.Rb()),2&t){const t=e.$implicit;n.Bb(1),n.nc("ngIf","status"!==t.type)}}let f=(()=>{class t{constructor(t,e,i,n){this.tickets=t,this.currentUser=e,this.mailboxTags=i,this.conversation=n}removeTag(t){this.tickets.removeTag(t,[this.conversation.get().id]).subscribe(()=>{this.conversation.get().tags=this.conversation.get().tags.filter(e=>e.id!==t.id),this.mailboxTags.refresh()})}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(s.a),n.Ob(a.a),n.Ob(o.a),n.Ob(r.a))},t.\u0275cmp=n.Ib({type:t,selectors:[["conversation-header"]],decls:13,vars:8,consts:[[1,"title-container"],[1,"ticket-subject"],[1,"tags"],[3,"selectable"],[4,"ngFor","ngForOf"],[1,"title-meta"],[1,"ticket-created-at-date"],[1,"actions"],[1,"button","reply-button",3,"matTooltip","click"],["svgIcon","reply"],["class","mat-compact-chip",3,"removable","removed",4,"ngIf"],[1,"mat-compact-chip",3,"removable","removed"],["matChipRemove","","svgIcon","cancel",4,"ngIf"],["matChipRemove","","svgIcon","cancel"]],template:function(t,e){1&t&&(n.Ub(0,"div",0),n.Ub(1,"h2",1),n.Kc(2),n.Tb(),n.Ub(3,"div",2),n.Ub(4,"mat-chip-list",3),n.Ic(5,g,2,1,"ng-container",4),n.Tb(),n.Tb(),n.Tb(),n.Ub(6,"div",5),n.Ub(7,"div",6),n.Kc(8),n.Tb(),n.Ub(9,"div",7),n.Ub(10,"button",8),n.bc("click",(function(){return e.conversation.openEditor()})),n.gc(11,"trans"),n.Pb(12,"mat-icon",9),n.Tb(),n.Tb(),n.Tb()),2&t&&(n.Bb(2),n.Lc(e.conversation.get().subject),n.Bb(2),n.nc("selectable",!1),n.Bb(1),n.nc("ngForOf",e.conversation.model.tags),n.Bb(3),n.Nc("",e.conversation.get().created_at_formatted," (",e.conversation.get().created_at_month,")"),n.Bb(2),n.nc("matTooltip",n.hc(11,6,"Reply (r)")))},directives:[c.d,l.s,d.a,b.a,l.t,c.a,c.e],pipes:[u.a],styles:["conversation-header{display:flex;align-items:center;flex:none;width:100%}conversation-header .title-container{flex:1 1 auto;display:flex;flex-wrap:wrap;align-items:center;padding:5px 10px 5px 25px;margin:15px 0}conversation-header .title-container h2{color:var(--be-help-center-title-text);font-weight:400;font-size:2.5rem;margin:0 15px 0 0}conversation-header .title-container .tags{display:inline-block}conversation-header .title-container .tags .tag-name{display:inline-block;max-width:50px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;vertical-align:sub}conversation-header .title-meta{flex:0 0 100px;white-space:nowrap;font-size:1.6rem;color:var(--be-secondary-text);text-align:right;padding-right:26px}conversation-header .title-meta .actions,conversation-header .title-meta .ticket-created-at-date{display:inline-block;vertical-align:middle}conversation-header .title-meta .reply-button{min-width:0;border:1px solid var(--be-divider-default);border-radius:4px;color:var(--be-secondary-text);margin-left:10px;padding:5px 12px 6px;background-color:var(--be-background-alternative);cursor:pointer}conversation-header .title-meta .reply-button mat-icon{width:19px;height:19px}@media only screen and (max-width:768px){conversation-header{margin-bottom:15px}conversation-header .title-meta .ticket-created-at-date{display:none}}"],encapsulation:2}),t})()},ehXJ:function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var n=i("fXoL"),s=i("tyNb"),a=i("i2dy"),o=i("LsVx"),r=i("kmQS"),c=i("wfim"),l=i("ahrr");let d=(()=>{class t{constructor(t,e,i,n,s,a){this.router=t,this.toast=e,this.tickets=i,this.settings=n,this.mailboxTags=s,this.localStorage=a,this.defaultAction=this.settings.get("replies.after_reply_action","next_active_ticket")}perform(){if(this.router.url.indexOf("help-center")>-1)this.navigateToCustomerTicketsList();else{switch(this.get()){case"next_active_ticket":this.navigateToNextActiveTicket();break;case"back_to_folder":this.navigateToAgentTicketsList()}this.mailboxTags.refresh()}}get(){return this.localStorage.get("after_reply_action",this.defaultAction)}set(t=null){this.defaultAction=t,this.localStorage.set("after_reply_action",t)}setTicketId(t){this.activeTicketId=t}navigateToNextActiveTicket(){const t=this.mailboxTags.activeTagId$.value;this.tickets.nextActiveTicket(t).subscribe(e=>{e.ticket&&e.ticket.id!==this.activeTicketId?this.router.navigate(["/mailbox/tickets/",e.ticket.id],{queryParams:{tagId:t}}):this.navigateToAgentTicketsList()})}navigateToAgentTicketsList(){this.router.navigate(["/mailbox/tickets"],{queryParams:{tagId:this.mailboxTags.activeTagId$.value}})}navigateToCustomerTicketsList(t){this.router.navigate(["/help-center/tickets"]),this.toast.open(t||"Your reply was submitted successfully.")}}return t.\u0275fac=function(e){return new(e||t)(n.Yb(s.f),n.Yb(a.b),n.Yb(o.a),n.Yb(r.a),n.Yb(c.a),n.Yb(l.a))},t.\u0275prov=n.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},i70M:function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var n=i("JIr8"),s=i("5+tZ"),a=i("EY2u"),o=i("LRne"),r=i("fXoL"),c=i("tyNb"),l=i("sPnx");let d=(()=>{class t{constructor(t,e){this.router=t,this.http=e}resolve(t){return this.http.get("new-ticket/categories").pipe(Object(n.a)(()=>(this.router.navigateByUrl("/"),a.a)),Object(s.a)(t=>Object(o.a)(t.tags)))}}return t.\u0275fac=function(e){return new(e||t)(r.Yb(c.f),r.Yb(l.a))},t.\u0275prov=r.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},"j/pe":function(t,e,i){"use strict";i.d(e,"a",(function(){return K}));var n=i("qaug"),s=i("2qZP"),a=i("EzZJ"),o=i("g6kq"),r=i("STbY"),c=i("FtGj"),l=i("fXoL"),d=i("tyNb"),b=i("QGXG"),u=i("twBr"),h=i("LsVx"),p=i("wWhK"),g=i("wfim"),f=i("pLZG");let m=(()=>{class t{constructor(t){this.router=t,this.history=[],this.limit=15}get(t=0){return this.history[t]||null}getPrevious(){return this.get(1)}back(){const t=this.getPrevious();return t?this.router.navigate([t.url],{queryParams:t.queryParams}):new Promise(t=>t(!1))}addHistoryItem(t){const e=t.split("?");let i={};e[1]&&(i=this.parseQueryParams(e[1])),this.history.length>=this.limit&&this.history.splice(1,this.history.length-1),this.history.unshift({url:e[0],queryParams:i})}parseQueryParams(t){const e=new URLSearchParams(t);return console.log(e),{}}init(){this.router.events.pipe(Object(f.a)(t=>t instanceof d.b)).subscribe(t=>{this.addHistoryItem(t.urlAfterRedirects)})}}return t.\u0275fac=function(e){return new(e||t)(l.Yb(d.f))},t.\u0275prov=l.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var v=i("ofXK"),y=i("Qu3c"),k=i("NFeN"),T=i("zW5C");const x=["ticketStatusMenuTrigger"];function w(t,e){1&t&&(l.Ub(0,"a",16),l.gc(1,"trans"),l.Pb(2,"mat-icon",17),l.Tb()),2&t&&l.nc("matTooltip",l.hc(1,1,"Back (b)"))}function I(t,e){if(1&t){const t=l.Vb();l.Ub(0,"button",18),l.bc("click",(function(){l.zc(t);const i=e.$implicit;return l.fc(2).changeTicketStatus(i)})),l.Kc(1),l.Tb()}if(2&t){const t=e.$implicit,i=l.fc(2);l.Fb("active",(null==i.conversation.status?null:i.conversation.status.name)===t.name),l.nc("ngClass",t.name),l.Bb(1),l.Mc(" ",t.display_name||t.name," ")}}const U=function(t){return[t]};function O(t,e){if(1&t){const t=l.Vb();l.Sb(0),l.Ic(1,w,3,3,"a",5),l.Ub(2,"assign-ticket-dropdown",6),l.bc("assigned",(function(){return l.zc(t),l.fc().refreshMailboxTags()})),l.gc(3,"trans"),l.Tb(),l.Ub(4,"button",7),l.bc("click",(function(){return l.zc(t),l.fc().showNoteModal()})),l.gc(5,"trans"),l.Pb(6,"mat-icon",8),l.Tb(),l.Ub(7,"add-tag-dropdown",9),l.bc("tagAdded",(function(e){return l.zc(t),l.fc().addTag(e)})),l.gc(8,"trans"),l.Tb(),l.Ub(9,"button",10,11),l.gc(11,"trans"),l.Pb(12,"mat-icon",12),l.Tb(),l.Ub(13,"mat-menu",13,14),l.Ic(15,I,2,4,"button",15),l.Tb(),l.lc(16),l.Rb()}if(2&t){const t=l.wc(14),e=l.fc();l.Bb(1),l.nc("ngIf",!e.hideBackButton),l.Bb(1),l.nc("ticket",e.conversation.get())("matTooltip",l.hc(3,10,"Assign (a)")),l.Bb(2),l.nc("matTooltip",l.hc(5,12,"Note (n)")),l.Bb(3),l.nc("ticketIds",l.sc(18,U,e.conversation.get().id))("matTooltip",l.hc(8,14,"Tag (t)")),l.Bb(2),l.nc("matMenuTriggerFor",t)("matTooltip",l.hc(11,16,"Status (s)")),l.Bb(4),l.nc("overlapTrigger",!1),l.Bb(2),l.nc("ngForOf",e.mailboxTags.statusTags)}}const B=function(){return["tickets.update","replies.create"]},C=["*"];let K=(()=>{class t{constructor(t,e,i,n,s,a,o,r,c,l){this.router=t,this.injector=e,this.modals=i,this.route=n,this.currentUser=s,this.tickets=a,this.conversation=o,this.browserEvents=r,this.mailboxTags=c,this.routerHistory=l,this.hideBackButton=!1,this.subscriptions=[]}ngOnInit(){this.initKeybinds()}changeTicketStatus(t){t&&this.tickets.changeTicketStatus(this.conversation.get().id,t.name).subscribe(()=>{this.conversation.performAfterReplyAction(),this.conversation.setStatus(t)})}showNoteModal(){this.modals.open(n.a,{ticketId:this.conversation.get().id},{panelClass:"add-note-modal-container"}).afterClosed().subscribe(t=>{t&&this.addNewNote(t)})}addTag(t){this.conversation.addTag(t),this.refreshMailboxTags()}addNewNote(t){t&&this.conversation.replies.add(t)}refreshMailboxTags(){this.mailboxTags.refresh()}initKeybinds(){const t=this.browserEvents.globalKeyDown$.subscribe(t=>{let e=!0;if(!(this.modals.anyDialogOpen()||o.a.userIsTyping()||t.ctrlKey)){switch(t.keyCode){case c.b:this.closeAllMenus(),this.router.navigate(["../"],{relativeTo:this.route});break;case c.a:this.assignTicketDropdown.open();break;case c.l:this.closeAllMenus(),this.showNoteModal();break;case c.w:this.addTagDropdown.open();break;case c.t:this.ticketStatusTrigger.menuOpen?this.handleTicketStatusChangeKeybind("spam"):this.ticketStatusTrigger.openMenu();break;case c.n:this.handleTicketStatusChangeKeybind("open");break;case c.d:this.handleTicketStatusChangeKeybind("closed");break;case c.o:this.handleTicketStatusChangeKeybind("pending");break;default:e=!1}e&&(t.preventDefault(),t.stopPropagation())}});this.subscriptions.push(t)}closeAllMenus(){this.addTagDropdown.close(),this.assignTicketDropdown.close(),this.ticketStatusTrigger.closeMenu()}handleTicketStatusChangeKeybind(t){this.ticketStatusTrigger.menuOpen&&(this.changeTicketStatus(this.mailboxTags.getTagByIdOrName(t)),this.ticketStatusTrigger.closeMenu())}ngOnDestroy(){this.subscriptions.forEach(t=>{t&&t.unsubscribe()})}}return t.\u0275fac=function(e){return new(e||t)(l.Ob(d.f),l.Ob(l.s),l.Ob(b.a),l.Ob(d.a),l.Ob(u.a),l.Ob(h.a),l.Ob(p.a),l.Ob(o.a),l.Ob(g.a),l.Ob(m))},t.\u0275cmp=l.Ib({type:t,selectors:[["conversation-toolbar"]],viewQuery:function(t,e){var i;1&t&&(l.Rc(s.a,!0),l.Rc(a.a,!0),l.Rc(x,!0,r.d)),2&t&&(l.vc(i=l.cc())&&(e.assignTicketDropdown=i.first),l.vc(i=l.cc())&&(e.addTagDropdown=i.first),l.vc(i=l.cc())&&(e.ticketStatusTrigger=i.first))},inputs:{hideBackButton:"hideBackButton"},ngContentSelectors:C,decls:7,vars:5,consts:[[1,"left","toolbar-actions"],[4,"ngIf"],[1,"right","ticket-info"],[1,"ticket-number"],[1,"ticket-status",3,"ngClass"],["class","no-style action back-button","routerLink","../","queryParamsHandling","preserve",3,"matTooltip",4,"ngIf"],[1,"action",3,"ticket","matTooltip","assigned"],[1,"action","no-style","add-note-button",3,"matTooltip","click"],["svgIcon","note-custom"],[1,"action",3,"ticketIds","matTooltip","tagAdded"],[1,"no-style","change-ticket-status-button","action",3,"matMenuTriggerFor","matTooltip"],["ticketStatusMenuTrigger",""],["svgIcon","flag-custom"],[1,"ticket-status-menu",3,"overlapTrigger"],["ticketStatusMenu","matMenu"],["mat-menu-item","",3,"active","ngClass","click",4,"ngFor","ngForOf"],["routerLink","../","queryParamsHandling","preserve",1,"no-style","action","back-button",3,"matTooltip"],["svgIcon","return-custom"],["mat-menu-item","",3,"ngClass","click"]],template:function(t,e){1&t&&(l.mc(),l.Ub(0,"div",0),l.Ic(1,O,17,20,"ng-container",1),l.Tb(),l.Ub(2,"div",2),l.Ub(3,"div",3),l.Kc(4),l.Tb(),l.Ub(5,"div",4),l.Kc(6),l.Tb(),l.Tb()),2&t&&(l.Bb(1),l.nc("ngIf",e.currentUser.hasPermissions(l.rc(4,B))),l.Bb(3),l.Mc("#",e.conversation.get().id,""),l.Bb(1),l.nc("ngClass",e.conversation.getStatus().name),l.Bb(1),l.Lc(e.conversation.getStatus().display_name))},directives:[v.t,v.q,s.a,y.a,k.a,a.a,r.d,r.e,v.s,d.i,r.b],pipes:[T.a],styles:["conversation-toolbar{display:block;width:100%;border-bottom:1px solid var(--be-divider-default);height:57px;padding:0 35px 0 10px;white-space:nowrap;color:var(--be-help-center-title-text)}conversation-toolbar .left,conversation-toolbar .right{width:50%;height:100%;display:inline-flex;align-items:center;padding:15px 0}conversation-toolbar .toolbar-actions .action{margin:0 15px;height:26px;width:26px;position:relative;transition:color .2s ease-in-out;color:inherit}conversation-toolbar .toolbar-actions .action:hover{color:var(--be-text)}conversation-toolbar .toolbar-actions .action mat-icon{height:26px;width:26px}conversation-toolbar .ticket-info{justify-content:flex-end;vertical-align:top}conversation-toolbar .ticket-info .ticket-number{font-size:3rem}conversation-toolbar .ticket-info .ticket-status{border:1px solid var(--be-divider-default);border-radius:2px;background-color:var(--be-background-alternative);padding:4px 12px;margin-left:10px;text-transform:uppercase;font-weight:500;font-size:1.1rem;letter-spacing:.02em}conversation-toolbar .ticket-info .ticket-status.open{background-color:var(--be-accent-default);color:var(--be-accent-contrast);border-color:transparent}.ticket-status-menu .mat-menu-item{text-transform:capitalize}.ticket-status-menu .mat-menu-item.active{background-color:var(--be-accent-emphasis)}"],encapsulation:2}),t})()},lxqa:function(t,e,i){"use strict";i.d(e,"a",(function(){return d}));var n=i("0IaG"),s=i("fXoL"),a=i("kmQS"),o=i("Rd8u"),r=i("bTqV"),c=i("NFeN"),l=i("zW5C");let d=(()=>{class t{constructor(t,e,i){this.dialogRef=t,this.data=e,this.settings=i,this.type=this.getDisplayType(e.reply.type)}close(t=!1){this.dialogRef.close(t)}confirm(){this.close(!0)}getDisplayType(t){switch(t){case"replies":return"reply";case"notes":return"note";case"drafts":return"draft"}}}return t.\u0275fac=function(e){return new(e||t)(s.Ob(n.h),s.Ob(n.a),s.Ob(a.a))},t.\u0275cmp=s.Ib({type:t,selectors:[["confirm-reply-delete-modal"]],decls:18,vars:5,consts:[[1,"modal-header",2,"margin","0"],["mat-dialog-title","","trans",""],["type","button","mat-icon-button","","tabindex","-1",1,"close-button",3,"click"],["svgIcon","close"],["trans",""],["mat-button","","type","button","trans","",1,"cancel-button",3,"click"],["type","submit","mat-raised-button","","trans","",1,"submit-button",3,"color","click"]],template:function(t,e){1&t&&(s.Ub(0,"div",0),s.Ub(1,"h2",1),s.Kc(2),s.Tb(),s.Ub(3,"button",2),s.bc("click",(function(){return e.close()})),s.Pb(4,"mat-icon",3),s.Tb(),s.Tb(),s.Ub(5,"mat-dialog-content"),s.Ub(6,"p"),s.Ub(7,"span",4),s.Kc(8,"Are you sure you want to delete this"),s.Tb(),s.Kc(9," "),s.Ub(10,"span"),s.Kc(11),s.gc(12,"trans"),s.Tb(),s.Tb(),s.Tb(),s.Ub(13,"mat-dialog-actions"),s.Ub(14,"button",5),s.bc("click",(function(){return e.close()})),s.Kc(15,"Close"),s.Tb(),s.Ub(16,"button",6),s.bc("click",(function(){return e.confirm()})),s.Kc(17,"Delete"),s.Tb(),s.Tb()),2&t&&(s.Bb(2),s.Mc("Delete ",e.type,""),s.Bb(9),s.Mc("",s.hc(12,3,e.type),"?"),s.Bb(5),s.nc("color",e.settings.get("vebto.auth.color")))},directives:[n.i,o.a,r.b,c.a,n.f,n.c],pipes:[l.a],encapsulation:2}),t})()},pfRy:function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var n=i("fXoL"),s=i("3Nhn"),a=i("wWhK");let o=(()=>{class t extends s.a{constructor(t,e,i){super(),this.el=t,this.conversation=e,this.zone=i,this.scrollTargetIsDocument=!1}ngOnInit(){this.scrollTargetIsDocument&&(this.el=new n.l(document)),super.ngOnInit()}getScrollContainer(){return document}loadMoreItems(){this.conversation.replies.loadMore()}isLoading(){return this.conversation.replies.isLoading}canLoadMore(){return this.conversation.replies.canLoadMore()}}return t.\u0275fac=function(e){return new(e||t)(n.Ob(n.l),n.Ob(a.a),n.Ob(n.A))},t.\u0275dir=n.Jb({type:t,selectors:[["","conversationInfiniteScroll",""]],inputs:{scrollTargetIsDocument:"scrollTargetIsDocument"},features:[n.yb]}),t})()},"qH/R":function(t,e,i){"use strict";i.d(e,"a",(function(){return z}));var n=i("lxqa"),s=i("g6kq"),a=i("XRKU"),o=i("FtGj"),r=i("703J"),c=i("pLZG"),l=i("IzEk"),d=i("fXoL"),b=i("QGXG"),u=i("twBr"),h=i("wWhK"),p=i("wfim"),g=i("74SX"),f=i("kmQS"),m=i("ahrr"),v=i("ofXK"),y=i("83jf"),k=i("rG4v"),T=i("KKQg"),x=i("Qu3c"),w=i("NFeN"),I=i("bTqV"),U=i("PPfr"),O=i("STbY"),B=i("Rd8u"),C=i("zW5C");const K=["textEditor"];function L(t,e){if(1&t){const t=d.Vb();d.Ub(0,"suggested-articles-dropdown",16),d.bc("articleSelected",(function(e){return d.zc(t),d.fc().insertArticleLink(e)})),d.Tb()}if(2&t){const t=d.fc();d.nc("category",t.conversation.getCategory())}}function R(t,e){if(1&t){const t=d.Vb();d.Ub(0,"div",17),d.Ub(1,"canned-replies-dropdown",18),d.bc("onReplySelect",(function(e){return d.zc(t),d.fc().applyCannedReply(e)})),d.Tb(),d.Tb()}}function S(t,e){if(1&t){const t=d.Vb();d.Ub(0,"button",24),d.bc("click",(function(){d.zc(t);const i=e.$implicit;return d.fc(2).setSelectedStatus(i)})),d.Kc(1),d.Tb()}if(2&t){const t=e.$implicit;d.nc("ngClass",t.name),d.Bb(1),d.Lc(t.display_name)}}function P(t,e){if(1&t&&(d.Sb(0),d.Ub(1,"button",19),d.Ub(2,"span"),d.Kc(3),d.gc(4,"trans"),d.Tb(),d.Pb(5,"mat-icon",20),d.Tb(),d.Ub(6,"mat-menu",21,22),d.Ic(8,S,2,2,"button",23),d.Tb(),d.Rb()),2&t){const t=d.wc(7),e=d.fc();d.Bb(1),d.nc("matMenuTriggerFor",t),d.Bb(2),d.Lc(d.hc(4,4,null==e.selectedStatus?null:e.selectedStatus.display_name)),d.Bb(3),d.nc("overlapTrigger",!1),d.Bb(2),d.nc("ngForOf",e.mailboxTags.statusTags)}}function F(t,e){1&t&&(d.Ub(0,"span",25),d.Kc(1,"Send Reply"),d.Tb())}function E(t,e){1&t&&(d.Ub(0,"span",25),d.Kc(1,"Sending..."),d.Tb())}function D(t,e){if(1&t){const t=d.Vb();d.Sb(0),d.Ub(1,"button",26),d.Pb(2,"mat-icon",27),d.Tb(),d.Ub(3,"mat-menu",28,29),d.Ub(5,"button",30),d.bc("click",(function(){return d.zc(t),d.fc().conversation.afterReplyAction.set("stay_on_page")})),d.Kc(6,"Send and stay on page"),d.Tb(),d.Ub(7,"button",31),d.bc("click",(function(){return d.zc(t),d.fc().conversation.afterReplyAction.set("next_active_ticket")})),d.Kc(8,"Send and next ticket"),d.Tb(),d.Ub(9,"button",32),d.bc("click",(function(){return d.zc(t),d.fc().conversation.afterReplyAction.set("back_to_folder")})),d.Kc(10,"Send and back to folder"),d.Tb(),d.Tb(),d.Rb()}if(2&t){const t=d.wc(4),e=d.fc();d.Bb(1),d.nc("disabled",e.conversation.replySaving)("matMenuTriggerFor",t),d.Bb(2),d.nc("overlapTrigger",!1),d.Bb(2),d.Fb("selected","stay_on_page"===e.conversation.afterReplyAction.get()),d.Bb(2),d.Fb("selected","next_active_ticket"===e.conversation.afterReplyAction.get()),d.Bb(2),d.Fb("selected","back_to_folder"===e.conversation.afterReplyAction.get())}}let z=(()=>{class t{constructor(t,e,i,n,s,a,o,c){this.modal=t,this.currentUser=e,this.conversation=i,this.browserEvents=n,this.mailboxTags=s,this.hcUrls=a,this.settings=o,this.localStorage=c,this.selectedStatus=new r.a,this.subscriptions=[]}ngOnInit(){this.mailboxTags.allTags$.pipe(Object(c.a)(t=>!!t.length),Object(l.a)(1)).subscribe(()=>{this.setSelectedStatus()}),this.initKeybinds(),this.conversation.setEditor(this.textEditor)}submitReply(){const t={body:this.textEditor.getContents(),status:this.selectedStatus};this.conversation.submitReply(t).subscribe(()=>{this.closeEditor()},()=>{})}saveDraft(t={}){return this.conversation.draft.save(t)}closeEditor(){this.conversation.closeEditor(),this.conversation.draft.reset(),this.textEditor.reset()}saveDraftAndAddToReplies(){this.conversation.draft.isEmpty()?this.closeEditor():this.saveDraft().subscribe(t=>{this.conversation.replies.add(t.data),this.closeEditor()})}maybeDeleteDraft(){const t=this.conversation.draft.get();t.id?this.modal.show(n.a,{reply:t}).afterClosed().subscribe(t=>{t&&(this.conversation.draft.delete(),this.closeEditor())}):this.closeEditor()}applyCannedReply(t){this.textEditor.insertContents(t.body),setTimeout(()=>{this.saveDraft({uploads:t.uploads.map(t=>t.id)})})}setSelectedStatus(t){if(t)this.localStorage.set("default_status_tag",t.name);else{const e=this.localStorage.get("default_status_tag");t=e?this.mailboxTags.getTagByIdOrName(e):this.currentUser.hasPermission("tickets.update")?this.mailboxTags.getTagByIdOrName("closed"):this.mailboxTags.getTagByIdOrName("open")}this.selectedStatus=t}initKeybinds(){const t=this.browserEvents.globalKeyDown$.subscribe(t=>{this.modal.anyDialogOpen()||s.a.userIsTyping()||(t.keyCode===o.r&&(this.conversation.openEditor(),this.conversation.scrollContainer.scrollTo({top:0,behavior:"smooth"})),t.keyCode===o.u&&t.ctrlKey&&(this.articleDropdown.focus(),this.conversation.scrollContainer.scrollTo({top:0,behavior:"smooth"})))});this.subscriptions.push(t),this.textEditor.editor.waitForEditor().then(t=>{t.shortcuts.add("ctrl+191","Search docs",()=>{this.articleDropdown.focus(),this.conversation.scrollContainer.scrollTo({top:0,behavior:"smooth"})})})}ngOnDestroy(){this.saveDraft(),this.closeEditor(),this.subscriptions.forEach(t=>{t&&t.unsubscribe()})}insertArticleLink(t){const e=this.hcUrls.article(t).join("/");this.textEditor.insertLink({target:"blank",href:this.settings.getBaseUrl()+e,text:t.title})}}return t.\u0275fac=function(e){return new(e||t)(d.Ob(b.a),d.Ob(u.a),d.Ob(h.a),d.Ob(s.a),d.Ob(p.a),d.Ob(g.a),d.Ob(f.a),d.Ob(m.a))},t.\u0275cmp=d.Ib({type:t,selectors:[["conversation-text-editor"]],viewQuery:function(t,e){var i;1&t&&(d.Gc(K,!0),d.Rc(a.a,!0)),2&t&&(d.vc(i=d.cc())&&(e.textEditor=i.first),d.vc(i=d.cc())&&(e.articleDropdown=i.first))},decls:21,vars:18,consts:[[1,"text-editor-container"],["placeholder","Search docs... (ctrl + /)",3,"category","articleSelected",4,"ngIf"],[3,"attachments","detached"],["inlineUploadPrefix","ticket_images",3,"onChange","onFileUpload","onCtrlEnter"],["textEditor",""],["class","header-actions","customButtons","",4,"ngIf"],["header","",1,"header-actions","last","right"],["type","button",1,"no-style","editor-button","save-draft-button",3,"matTooltip","click"],["svgIcon","check-circle"],["type","button",1,"no-style","editor-button","delete-draft-button",3,"matTooltip","click"],["svgIcon","delete"],["footer","",1,"editor-footer"],[1,"right"],[4,"ngIf"],["type","button","mat-flat-button","","color","accent",1,"submit-button",3,"disabled","click"],["trans","",4,"ngIf"],["placeholder","Search docs... (ctrl + /)",3,"category","articleSelected"],["customButtons","",1,"header-actions"],[3,"onReplySelect"],["type","button","mat-button","",1,"change-status-button",3,"matMenuTriggerFor"],["svgIcon","keyboard-arrow-down",1,"dropdown-icon"],[1,"status-menu",3,"overlapTrigger"],["statusMenu","matMenu"],["mat-menu-item","","trans","",3,"ngClass","click",4,"ngFor","ngForOf"],["mat-menu-item","","trans","",3,"ngClass","click"],["trans",""],["mat-flat-button","","color","accent",1,"dropdown-left","submit-button-addon",3,"disabled","matMenuTriggerFor"],["svgIcon","arrow-drop-down",1,"caret","align-middle"],[1,"default-redirect-menu",3,"overlapTrigger"],["defaultRedirectMenu","matMenu"],["mat-menu-item","","trans","",1,"stay-on-page",3,"click"],["mat-menu-item","","trans","",1,"next-active-ticket",3,"click"],["mat-menu-item","","trans","",1,"back_to_folder",3,"click"]],template:function(t,e){1&t&&(d.Ub(0,"section",0),d.Ic(1,L,1,1,"suggested-articles-dropdown",1),d.Ub(2,"reply-attachment-list",2),d.bc("detached",(function(t){return e.conversation.draft.detachUpload(t)})),d.Tb(),d.Pb(3,"upload-progress-bar"),d.Ub(4,"text-editor",3,4),d.bc("onChange",(function(t){return e.conversation.draft.setBody(t)}))("onFileUpload",(function(t){return e.conversation.draft.uploadFiles(t)}))("onCtrlEnter",(function(){return e.submitReply()})),d.Ic(6,R,2,0,"div",5),d.Ub(7,"div",6),d.Ub(8,"button",7),d.bc("click",(function(){return e.saveDraftAndAddToReplies()})),d.gc(9,"trans"),d.Pb(10,"mat-icon",8),d.Tb(),d.Ub(11,"button",9),d.bc("click",(function(){return e.maybeDeleteDraft()})),d.gc(12,"trans"),d.Pb(13,"mat-icon",10),d.Tb(),d.Tb(),d.Ub(14,"div",11),d.Ub(15,"div",12),d.Ic(16,P,9,6,"ng-container",13),d.Ub(17,"button",14),d.bc("click",(function(){return e.submitReply()})),d.Ic(18,F,2,0,"span",15),d.Ic(19,E,2,0,"span",15),d.Tb(),d.Ic(20,D,11,9,"ng-container",13),d.Tb(),d.Tb(),d.Tb(),d.Tb()),2&t&&(d.Fb("hidden",!e.conversation.isEditorOpen()),d.Bb(1),d.nc("ngIf",e.currentUser.hasPermission("tickets.update")),d.Bb(1),d.nc("attachments",e.conversation.draft.get().uploads),d.Bb(4),d.nc("ngIf",e.currentUser.hasPermission("canned_replies.view")),d.Bb(2),d.Fb("success",e.conversation.draft.get().id),d.nc("matTooltip",d.hc(9,14,"Save Draft")),d.Bb(3),d.nc("matTooltip",d.hc(12,16,"Discard (Esc)")),d.Bb(5),d.nc("ngIf",e.currentUser.hasPermission("tickets.update")),d.Bb(1),d.nc("disabled",e.conversation.replySaving),d.Bb(1),d.nc("ngIf",!e.conversation.replySaving),d.Bb(1),d.nc("ngIf",e.conversation.replySaving),d.Bb(1),d.nc("ngIf",e.currentUser.hasPermission("settings.update")))},directives:[v.t,y.a,k.a,T.a,x.a,w.a,I.b,a.a,U.a,O.d,O.e,v.s,O.b,B.a,v.q],pipes:[C.a],styles:["conversation-text-editor{display:block;width:100%}conversation-text-editor suggested-articles-dropdown .input-container{position:relative;margin-bottom:10px}conversation-text-editor suggested-articles-dropdown .input-container .search-icon{position:absolute;right:0;top:3px;color:var(--be-secondary-text)}conversation-text-editor .text-editor-container{margin:0 25px 25px}conversation-text-editor .attachments-list{border-bottom:1px dotted var(--be-divider-default);padding-bottom:10px}conversation-text-editor .attachments-list .attachments-list-item{background-color:var(--be-background-alternative)}conversation-text-editor .editor-footer .right{height:100%;display:flex;position:absolute;right:0;top:0}conversation-text-editor .editor-footer .right .change-status-button{height:100%;color:var(--be-secondary-text);font-weight:500;text-transform:capitalize}conversation-text-editor .editor-footer .right .change-status-button .mat-icon{width:20px;height:20px;vertical-align:text-bottom}conversation-text-editor .editor-footer .right .submit-button,conversation-text-editor .editor-footer .right .submit-button-addon{height:38px;border-radius:0;font-weight:400;position:relative;top:-1px}conversation-text-editor .editor-footer .right .submit-button-addon{border-left:1px solid var(--be-accent-emphasis);padding:0 7px;min-width:45px}.default-redirect-menu .selected{background-color:var(--be-accent-emphasis)}.status-menu .mat-menu-item{text-transform:capitalize}"],encapsulation:2}),t})()},qaug:function(t,e,i){"use strict";i.d(e,"a",(function(){return w}));var n=i("wWhK"),s=i("0IaG"),a=i("h586"),o=i("nYR2"),r=i("fXoL"),c=i("LsVx"),l=i("oVOl"),d=i("Rd8u"),b=i("bTqV"),u=i("NFeN"),h=i("3Pt+"),p=i("KKQg"),g=i("rG4v"),f=i("ofXK"),m=i("83jf");const v=["textEditor"];function y(t,e){if(1&t&&(r.Ub(0,"div",13),r.Kc(1),r.Tb()),2&t){const t=r.fc();r.Bb(1),r.Lc(t.errors.body)}}function k(t,e){if(1&t&&(r.Ub(0,"div",13),r.Kc(1),r.Tb()),2&t){const t=r.fc();r.Bb(1),r.Lc(t.errors.file)}}function T(t,e){if(1&t&&(r.Ub(0,"div",13),r.Kc(1),r.Tb()),2&t){const t=r.fc();r.Bb(1),r.Lc(t.errors.attachments)}}function x(t,e){if(1&t){const t=r.Vb();r.Ub(0,"reply-attachment-list",14),r.bc("detached",(function(e){return r.zc(t),r.fc().removeAttachment(e)})),r.Tb()}if(2&t){const t=r.fc();r.nc("attachments",t.attachments)}}let w=(()=>{class t{constructor(t,e,i,n,s){this.dialogRef=t,this.data=e,this.ticketService=i,this.uploads=n,this.uploadQueue=s,this.errors={},this.attachments=[],this.loading=!1}ngOnInit(){this.textEditor.focus()}close(t){this.textEditor.destroyEditor(),this.dialogRef.close(t)}confirm(){this.loading=!0;const t={body:this.textEditor.getContents(),uploads:this.attachments.map(t=>t.id)};this.ticketService.addNote(this.data.ticketId,t).pipe(Object(o.a)(()=>this.loading=!1)).subscribe(t=>{this.close(t.data)},t=>this.errors=t.errors)}uploadFiles(t){this.uploadQueue.start(t).subscribe(t=>{this.attachments=[...this.attachments,t.fileEntry]})}removeAttachment(t){for(let e=0;e<this.attachments.length;e++)this.attachments[e].id===t.id&&this.attachments.splice(e,1)}}return t.\u0275fac=function(e){return new(e||t)(r.Ob(s.h),r.Ob(s.a),r.Ob(c.a),r.Ob(l.a),r.Ob(a.a))},t.\u0275cmp=r.Ib({type:t,selectors:[["add-note-modal"]],viewQuery:function(t,e){var i;1&t&&r.Gc(v,!0),2&t&&r.vc(i=r.cc())&&(e.textEditor=i.first)},features:[r.Ab([n.a,a.a])],decls:20,vars:6,consts:[[1,"modal-header"],["mat-dialog-title","","trans",""],["type","button","mat-icon-button","","tabindex","-1",1,"close-button",3,"click"],["svgIcon","close"],["ngNativeValidate","",3,"ngSubmit"],[1,"many-inputs"],[1,"input-container"],["inlineUploadPrefix","ticket_images",1,"text-editor",3,"minHeight","onFileUpload"],["textEditor",""],["class","error",4,"ngIf"],[3,"attachments","detached",4,"ngIf"],["type","button","mat-button","","trans","",1,"cancel-button",3,"click"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button",3,"disabled"],[1,"error"],[3,"attachments","detached"]],template:function(t,e){1&t&&(r.Ub(0,"div",0),r.Ub(1,"h2",1),r.Kc(2,"Add Note"),r.Tb(),r.Ub(3,"button",2),r.bc("click",(function(){return e.close()})),r.Pb(4,"mat-icon",3),r.Tb(),r.Tb(),r.Ub(5,"form",4),r.bc("ngSubmit",(function(){return e.confirm()})),r.Ub(6,"mat-dialog-content",5),r.Ub(7,"div",6),r.Ub(8,"text-editor",7,8),r.bc("onFileUpload",(function(t){return e.uploadFiles(t)})),r.Tb(),r.Pb(10,"upload-progress-bar"),r.Ic(11,y,2,1,"div",9),r.Ic(12,k,2,1,"div",9),r.Ic(13,T,2,1,"div",9),r.Ic(14,x,1,1,"reply-attachment-list",10),r.Tb(),r.Tb(),r.Ub(15,"mat-dialog-actions"),r.Ub(16,"button",11),r.bc("click",(function(){return e.close()})),r.Kc(17,"Cancel"),r.Tb(),r.Ub(18,"button",12),r.Kc(19,"Add Note"),r.Tb(),r.Tb(),r.Tb()),2&t&&(r.Bb(8),r.nc("minHeight",300),r.Bb(3),r.nc("ngIf",e.errors.body),r.Bb(1),r.nc("ngIf",e.errors.file),r.Bb(1),r.nc("ngIf",e.errors.attachments),r.Bb(1),r.nc("ngIf",e.attachments.length),r.Bb(4),r.nc("disabled",e.loading))},directives:[s.i,d.a,b.b,u.a,h.v,h.w,s.f,p.a,g.a,f.t,s.c,m.a],styles:[".add-note-modal-container{width:600px}.add-note-modal-container reply-attachment-list{margin-top:15px}"],encapsulation:2}),t})()},sTxL:function(t,e,i){"use strict";i.d(e,"a",(function(){return a}));var n=i("XFMS"),s=i("fXoL");let a=(()=>{class t{transform(t){return t?t.includes("youtube")?"https://www.youtube.com/s/desktop/ca54e1bd/img/favicon.ico":function(t){return t?(Object(n.a)(t)||(t=window.location.protocol+"//"+window.location.host),"https://www.google.com/s2/favicons?domain="+new URL(t).origin):null}(t):null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=s.Nb({name:"favicon",type:t,pure:!0}),t})()},"tSQ/":function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"b",(function(){return s}));const n="tickets.update";class s{constructor(t={}){for(const e in t)this[e]=t[e]}}},wWhK:function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var n=i("fXoL"),s=i("tSQ/"),a=i("703J"),o=i("vkgz"),r=i("1V5l"),c=i("i2dy"),l=i("LsVx"),d=i("KHpT"),b=i("ehXJ");let u=(()=>{class t{constructor(t,e,i,o,r){this.draft=t,this.toast=e,this.tickets=i,this.replies=o,this.afterReplyAction=r,this.isLoading=!1,this.model=new s.b({tags:[]}),this.status=new a.a,this.replySaving=!1,this.editorIsOpen=!1,this.afterInit=new n.n}get(){return this.model}getStatus(){return this.status||new a.a}getCategory(){const t=this.model.tags.find(t=>"status"!==t.type);return t&&t.categories?t.categories[0]:null}setStatus(t){t&&(this.status=t)}openEditor(){this.editorIsOpen=!0,setTimeout(()=>this.editor&&this.editor.focus())}closeEditor(){this.editorIsOpen=!1}isEditorOpen(){return this.editorIsOpen}setEditor(t){this.editor=t}setDraft(t){this.draft.set(t),this.editor.setContents(t.body)}addTag(t){this.model.tags.find(e=>e.id===t.id)||this.model.tags.unshift(t)}submitReply(t={}){return this.replySaving=!0,this.tickets.saveReply(this.model.id,this.draft.getPayload(t)).pipe(Object(o.a)(e=>{this.replySaving=!1,this.draft.delete(),this.performAfterReplyAction(),this.setStatus(t.status),this.replies.add(e.data)},()=>{this.toast.open("There was an issue submitting this reply."),this.replySaving=!1,this.isLoading=!1}))}performAfterReplyAction(){this.afterReplyAction.get()&&"stay_on_page"!==this.afterReplyAction.get()&&(this.isLoading=!0),this.afterReplyAction.perform()}init(t){t&&(this.model=t,this.status=t.tags.find(t=>"status"===t.type),this.replies.init(this.model.replies,this.model.id),this.draft.setTicketId(this.model.id),this.afterReplyAction.setTicketId(this.model.id),this.isLoading=!1,this.afterInit.emit())}}return t.\u0275fac=function(e){return new(e||t)(n.Yb(r.a),n.Yb(c.b),n.Yb(l.a),n.Yb(d.a),n.Yb(b.a))},t.\u0275prov=n.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},wfim:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var n=i("2Vo4"),s=i("nYR2"),a=i("fXoL"),o=i("LRXf");let r=(()=>{class t{constructor(t){this.httpClient=t,this.allTags$=new n.a([]),this.categoryTags=[],this.statusTags=[],this.activeTagId$=new n.a(null),this.loading$=new n.a(!1),this.allTags$.value.length||this.refresh()}setTags(t){t&&(this.allTags$.next(t),this.statusTags=t.filter(t=>"status"===t.type),this.categoryTags=t.filter(t=>"category"===t.type),this.viewTags=t.filter(t=>"view"===t.type))}refresh(){this.loading$.next(!0),this.httpClient.get("tags/agent-mailbox").pipe(Object(s.a)(()=>this.loading$.next(!1))).subscribe(t=>{this.setTags(t)})}setActiveTag(t){this.activeTagId$.next(t||"unassigned")}getTagByIdOrName(t){return this.allTags$.value.find(e=>e.id===+t||e.name===t)}}return t.\u0275fac=function(e){return new(e||t)(a.Yb(o.a))},t.\u0275prov=a.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},yS8O:function(t,e,i){"use strict";i.d(e,"a",(function(){return h}));var n=i("0IaG"),s=i("fXoL"),a=i("Rd8u"),o=i("bTqV"),r=i("NFeN"),c=i("ofXK");function l(t,e){if(1&t&&(s.Ub(0,"div",11),s.Ub(1,"div",12),s.Kc(2),s.Tb(),s.Ub(3,"div",13),s.Kc(4),s.Tb(),s.Tb()),2&t){const t=e.$implicit,i=s.fc();s.Bb(2),s.Lc(t),s.Bb(2),s.Lc(i.originalEmail.headers[t])}}function d(t,e){1&t&&(s.Ub(0,"span",14),s.Kc(1,"Could not find original email for this reply."),s.Tb())}function b(t,e){if(1&t&&(s.Ub(0,"pre",15),s.Kc(1),s.Tb()),2&t){const t=s.fc();s.Bb(1),s.Lc(t.originalEmail.body.plain)}}function u(t,e){if(1&t&&(s.Ub(0,"pre",16),s.Kc(1),s.Tb()),2&t){const t=s.fc();s.Bb(1),s.Lc(t.originalEmail.body.html)}}let h=(()=>{class t{constructor(t,e){this.dialogRef=t,this.data=e,this.headerNames=[],this.hydrate()}close(){this.dialogRef.close()}hydrate(){this.originalEmail=this.data.original,this.originalEmail&&this.originalEmail.headers&&(this.headerNames=Object.keys(this.originalEmail.headers))}}return t.\u0275fac=function(e){return new(e||t)(s.Ob(n.h),s.Ob(n.a))},t.\u0275cmp=s.Ib({type:t,selectors:[["show-original-reply-modal"]],decls:15,vars:4,consts:[[1,"modal-header"],["mat-dialog-title","","trans",""],["type","button","mat-icon-button","","tabindex","-1",1,"close-button",3,"click"],["svgIcon","close"],[1,"headers"],["class","header",4,"ngFor","ngForOf"],[1,"email-content"],["trans","",4,"ngIf"],["class","body-plain",4,"ngIf"],["class","body-html",4,"ngIf"],["type","submit","mat-raised-button","","color","accent","trans","",1,"submit-button",3,"click"],[1,"header"],[1,"name"],[1,"value"],["trans",""],[1,"body-plain"],[1,"body-html"]],template:function(t,e){1&t&&(s.Ub(0,"div",0),s.Ub(1,"h2",1),s.Kc(2,"Original Message"),s.Tb(),s.Ub(3,"button",2),s.bc("click",(function(){return e.close()})),s.Pb(4,"mat-icon",3),s.Tb(),s.Tb(),s.Ub(5,"mat-dialog-content"),s.Ub(6,"div",4),s.Ic(7,l,5,2,"div",5),s.Tb(),s.Ub(8,"div",6),s.Ic(9,d,2,0,"span",7),s.Ic(10,b,2,1,"pre",8),s.Ic(11,u,2,1,"pre",9),s.Tb(),s.Tb(),s.Ub(12,"mat-dialog-actions"),s.Ub(13,"button",10),s.bc("click",(function(){return e.close()})),s.Kc(14,"Done"),s.Tb(),s.Tb()),2&t&&(s.Bb(7),s.nc("ngForOf",e.headerNames),s.Bb(2),s.nc("ngIf",!e.originalEmail),s.Bb(1),s.nc("ngIf",e.originalEmail&&e.originalEmail.body.plain),s.Bb(1),s.nc("ngIf",e.originalEmail&&e.originalEmail.body.html))},directives:[n.i,a.a,o.b,r.a,n.f,c.s,c.t,n.c],styles:[".show-original-reply-modal-container{width:90%;height:90%}.show-original-reply-modal-container .mat-dialog-title{margin-bottom:25px}.show-original-reply-modal-container .mat-dialog-content{max-height:none}.show-original-reply-modal-container .headers{border:1px solid var(--be-divider-default)}.show-original-reply-modal-container .headers>.header{display:flex;padding:10px;border-bottom:1px solid var(--be-divider-default)}.show-original-reply-modal-container .headers>.header>.name{flex:1 1 30%;font-weight:500;max-width:200px}.show-original-reply-modal-container .headers>.header>.value{flex:1 1 65%;margin-left:auto}.show-original-reply-modal-container .email-content{margin-top:40px}.show-original-reply-modal-container .email-content>pre{font-size:1.4rem;font-family:Roboto,Helvetica Neue,sans-serif;word-wrap:break-word;white-space:pre-wrap}.show-original-reply-modal-container .email-content>.body-plain{margin-bottom:20px;padding-bottom:20px;border-bottom:1px solid var(--be-divider-default)}"],encapsulation:2,changeDetection:0}),t})()}}]);